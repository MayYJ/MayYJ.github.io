<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Spring IOCSpring IOC&amp;#x6982;&amp;#x8FF0; &amp;#x4F9D;&amp;#x8D56;&amp;#x53CD;&amp;#x8F6C;&amp;#xFF1A;&amp;#x628A;&amp;#x63A7;&amp;#x5236;&amp;#x6743;&amp;#x4ECE;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x4E1A;&amp;#x52A1;&amp;#x5BF9;&amp;#x8C61;&amp;#x624B;&amp;#x4E2D;&amp;#x8F6C;&amp;#x">
<meta property="og:type" content="article">
<meta property="og:title" content="May&#39;s Blog">
<meta property="og:url" content="https://github.com/MayYJ/hexo/2018/07/23/javaweb/Spring 源码详解/index.html">
<meta property="og:site_name" content="May&#39;s Blog">
<meta property="og:description" content="Spring IOCSpring IOC&amp;#x6982;&amp;#x8FF0; &amp;#x4F9D;&amp;#x8D56;&amp;#x53CD;&amp;#x8F6C;&amp;#xFF1A;&amp;#x628A;&amp;#x63A7;&amp;#x5236;&amp;#x6743;&amp;#x4ECE;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x4E1A;&amp;#x52A1;&amp;#x5BF9;&amp;#x8C61;&amp;#x624B;&amp;#x4E2D;&amp;#x8F6C;&amp;#x">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1ftluvkk5idj210j0bh765.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1ftlwn5l3cij20db0lywfp.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fts57tjs3uj20op0dz0t2.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fts84yqduyj20x50gvwfd.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fu63tj7rxyj20ob0do74r.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1ftwlh8jmi0j20h90brq3m.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1ftwlcws80xj20es09wt90.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1ftxkshzdpvj21fc14wgmw.jpg">
<meta property="og:updated_time" content="2018-09-20T14:03:46.311Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="May&#39;s Blog">
<meta name="twitter:description" content="Spring IOCSpring IOC&amp;#x6982;&amp;#x8FF0; &amp;#x4F9D;&amp;#x8D56;&amp;#x53CD;&amp;#x8F6C;&amp;#xFF1A;&amp;#x628A;&amp;#x63A7;&amp;#x5236;&amp;#x6743;&amp;#x4ECE;&amp;#x5177;&amp;#x4F53;&amp;#x7684;&amp;#x4E1A;&amp;#x52A1;&amp;#x5BF9;&amp;#x8C61;&amp;#x624B;&amp;#x4E2D;&amp;#x8F6C;&amp;#x">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1ftluvkk5idj210j0bh765.jpg">






  <link rel="canonical" href="https://github.com/MayYJ/hexo/2018/07/23/javaweb/Spring 源码详解/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title> | May's Blog</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">May's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">既然选择了远方，便只顾风雨兼程。</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/MayYJ/hexo/2018/07/23/javaweb/Spring 源码详解/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="May">
      <meta itemprop="description" content="既然选择了远方，便只顾风雨兼程。">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="May's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-23 21:10:53" itemprop="dateCreated datePublished" datetime="2018-07-23T21:10:53+08:00">2018-07-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-09-20 22:03:46" itemprop="dateModified" datetime="2018-09-20T22:03:46+08:00">2018-09-20</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="Spring-IOC"><a href="#Spring-IOC" class="headerlink" title="Spring IOC"></a>Spring IOC</h3><h4 id="Spring-IOC&#x6982;&#x8FF0;"><a href="#Spring-IOC&#x6982;&#x8FF0;" class="headerlink" title="Spring IOC&#x6982;&#x8FF0;"></a>Spring IOC&#x6982;&#x8FF0;</h4><ol>
<li><p>&#x4F9D;&#x8D56;&#x53CD;&#x8F6C;&#xFF1A;&#x628A;&#x63A7;&#x5236;&#x6743;&#x4ECE;&#x5177;&#x4F53;&#x7684;&#x4E1A;&#x52A1;&#x5BF9;&#x8C61;&#x624B;&#x4E2D;&#x8F6C;&#x4EA4;&#x5230;&#x5E73;&#x53F0;&#x6216;&#x8005;&#x6846;&#x67B6;&#x4E2D;&#xFF0C;Spring IOC&#x5C31;&#x662F;&#x5B9E;&#x73B0;&#x8FD9;&#x4E2A;&#x6A21;&#x5F0F;&#x7684;&#x8F7D;&#x4F53;</p>
</li>
<li><p>&#x4E3A;&#x4EC0;&#x4E48;&#x8981;&#x4F7F;&#x7528;Spring IOC</p>
<p>&#x56E0;&#x4E3A;&#x5728;&#x9762;&#x5411;&#x5BF9;&#x8C61;&#x7A0B;&#x5E8F;&#x8BBE;&#x8BA1;&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x4F1A;&#x5305;&#x542B;&#x5176;&#x5B83;&#x7684;&#x5BF9;&#x8C61;&#xFF0C;&#x5982;&#x679C;&#x5408;&#x4F19;&#x5BF9;&#x8C61;&#x7684;&#x5F15;&#x7528;&#x6216;&#x4F9D;&#x8D56;&#x5173;&#x7CFB;&#x7684;&#x7BA1;&#x7406;&#x6709;&#x5177;&#x4F53;&#x5BF9;&#x8C61;&#x6765;&#x5B8C;&#x6210;&#xFF0C;&#x4F1A;&#x5BFC;&#x81F4;&#x4EE3;&#x7801;&#x7684;&#x9AD8;&#x5EA6;&#x8026;&#x5408;&#x548C;&#x53EF;&#x6D4B;&#x8BD5;&#x6027;&#x964D;&#x4F4E;&#xFF1B;&#x5982;&#x679C;&#x628A;&#x5BF9;&#x8C61;&#x7684;&#x7BA1;&#x7406;&#x548C;&#x5BF9;&#x8C61;&#x7684;&#x6CE8;&#x5165;&#x90FD;    &#x4EA4;&#x7ED9;Spring IOC&#x6765;&#x5904;&#x7406;&#xFF0C;&#x90A3;&#x4E48;&#x89E3;&#x8026;&#x4EE3;&#x7801;&#x7684;&#x540C;&#x65F6;&#x8FD8;&#x63D0;&#x9AD8;&#x4E86;&#x53EF;&#x6D4B;&#x8BD5;&#x6027;</p>
</li>
</ol>
<h4 id="GenericApplicationContext&#x7684;&#x7C7B;&#x56FE;"><a href="#GenericApplicationContext&#x7684;&#x7C7B;&#x56FE;" class="headerlink" title="GenericApplicationContext&#x7684;&#x7C7B;&#x56FE;"></a>GenericApplicationContext&#x7684;&#x7C7B;&#x56FE;</h4><p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1ftluvkk5idj210j0bh765.jpg" alt=""></p>
<h4 id="IOC&#x5BB9;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;"><a href="#IOC&#x5BB9;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;" class="headerlink" title="IOC&#x5BB9;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;"></a>IOC&#x5BB9;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;</h4><ul>
<li><p>&#x8FD9;&#x91CC;&#x5C31;&#x4F1A;&#x6D89;&#x53CA;&#x5230;&#x4E00;&#x4E2A;&#x65B9;&#x6CD5;refresh&#xFF0C;&#x4E0B;&#x9762;&#x662F;&#x5B83;&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException </span>{</span><br><span class="line">    Object var1 = <span class="keyword">this</span>.startupShutdownMonitor;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="keyword">this</span>.startupShutdownMonitor) {</span><br><span class="line">        <span class="comment">//&#x521D;&#x59CB;&#x5316;IOC&#x5BB9;&#x5668;&#x4E4B;&#x524D;&#x7684;&#x51C6;&#x5907;&#x5DE5;&#x4F5C;</span></span><br><span class="line">        <span class="keyword">this</span>.prepareRefresh();</span><br><span class="line">        <span class="comment">//&#x5F97;&#x5230;&#x4E00;&#x4E2A;BeanFactory,&#x5E76;&#x4E14;&#x8C03;&#x7528;refreshBeanFactory(),&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x8FDB;&#x884C;Bean&#x7684;&#x5B9A;&#x4F4D; &#x3001;&#x8F7D;&#x5165;&#x548C;</span></span><br><span class="line">        <span class="comment">//&#x6CE8;&#x518C;&#xFF1B;&#x4F46;&#x662F;&#x5728;&#x6211;&#x770B;AnnotationConfigApplicationContext&#x6E90;&#x7801;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x5B83;&#x7684;&#x8F7D;&#x5165;&#x548C;&#x6CE8;</span></span><br><span class="line">        <span class="comment">//&#x518C;</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = <span class="keyword">this</span>.obtainFreshBeanFactory();</span><br><span class="line">        <span class="comment">//&#x7ED9;BeanFactory&#x8BBE;&#x7F6E;&#x4E00;&#x4E9B;&#x5C5E;&#x6027;</span></span><br><span class="line">        <span class="keyword">this</span>.prepareBeanFactory(beanFactory);</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//&#x8BBE;&#x7F6E;BeanFactory&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;</span></span><br><span class="line">            <span class="keyword">this</span>.postProcessBeanFactory(beanFactory);</span><br><span class="line">            <span class="comment">//&#x8C03;&#x7528;BeanFactory&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x8FD9;&#x4E9B;&#x5904;&#x7406;&#x5668;&#x662F;&#x5728;IOC&#x5BB9;&#x5668;&#x4E2D;&#x901A;&#x8FC7;Bean&#x6CE8;&#x518C;&#x7684;</span></span><br><span class="line">            <span class="keyword">this</span>.invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">            <span class="comment">//&#x6CE8;&#x518C;Bean&#x7684;&#x540E;&#x5904;&#x7406;&#x5668;&#xFF0C;&#x5728;Bena&#x7684;&#x521B;&#x5EFA;&#x8FC7;&#x7A0B;&#x4E2D;&#x8C03;&#x7528;</span></span><br><span class="line">            <span class="keyword">this</span>.registerBeanPostProcessors(beanFactory);</span><br><span class="line">            <span class="comment">//&#x5BF9;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;&#x6D88;&#x606F;&#x6E90;&#x8FDB;&#x884C;&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">            <span class="keyword">this</span>.initMessageSource();</span><br><span class="line">            <span class="comment">//&#x521D;&#x59CB;&#x5316;&#x4E0A;&#x4E0B;&#x6587;&#x4E2D;&#x7684;&#x4E8B;&#x4EF6;&#x673A;&#x5236;</span></span><br><span class="line">            <span class="keyword">this</span>.initApplicationEventMulticaster();</span><br><span class="line">            <span class="comment">//&#x521D;&#x59CB;&#x5316;&#x5176;&#x5B83;&#x7279;&#x6B8A;&#x7684;Bean</span></span><br><span class="line">            <span class="keyword">this</span>.onRefresh();</span><br><span class="line">            <span class="comment">//&#x68C0;&#x67E5;&#x76D1;&#x542C;Bean&#x5E76;&#x4E14;&#x5C06;&#x8FD9;&#x4E9B;Bean&#x5411;&#x5BB9;&#x5668;&#x6CE8;&#x518C;</span></span><br><span class="line">            <span class="keyword">this</span>.registerListeners();</span><br><span class="line">            <span class="comment">//&#x5B9E;&#x4F8B;&#x5316;&#x6240;&#x6709;&#x7684;&#x5355;&#x4EF6;</span></span><br><span class="line">            <span class="keyword">this</span>.finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">            <span class="comment">//&#x53D1;&#x5E03;&#x5BB9;&#x5668;&#x4E8B;&#x4EF6;&#xFF0C;&#x7ED3;&#x675F;refresh&#x8FC7;&#x7A0B;</span></span><br><span class="line">            <span class="keyword">this</span>.finishRefresh();</span><br><span class="line">        } <span class="keyword">catch</span> (BeansException var9) {</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isWarnEnabled()) {</span><br><span class="line">                <span class="keyword">this</span>.logger.warn(<span class="string">&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot;</span> + var9);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">//&#x4E3A;&#x9632;&#x6B62;Bean&#x8D44;&#x6E90;&#x5360;&#x7528;&#xFF0C;&#x5728;&#x5F02;&#x5E38;&#x5904;&#x7406;&#x4E2D;&#x9500;&#x6BC1;&#x5DF2;&#x7ECF;&#x521B;&#x5EFA;&#x7684;&#x5355;&#x4EF6;Bean</span></span><br><span class="line">            <span class="keyword">this</span>.destroyBeans();</span><br><span class="line">            <span class="comment">//&#x91CD;&#x7F6E;&apos;active&apos;&#x6807;&#x5FD7;</span></span><br><span class="line">            <span class="keyword">this</span>.cancelRefresh(var9);</span><br><span class="line">            <span class="keyword">throw</span> var9;</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="keyword">this</span>.resetCommonCaches();</span><br><span class="line">        }</span><br><span class="line">  </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6D89;&#x53CA;&#x5230;&#x4E86;BeanDefinition&#x7684;&#x5B9A;&#x4F4D;&#x3001;&#x8F7D;&#x5165;&#x548C;&#x6CE8;&#x518C;&#x4E09;&#x4E2A;&#x57FA;&#x672C;&#x8FC7;&#x7A0B;</p>
<p>&#x4E00;&#x4E0B;&#x662F;&#x6211;&#x770B;&#x5B8C;&#x6E90;&#x7801;&#x540E;&#x7684;&#x4E00;&#x4E9B;&#x611F;&#x53D7;</p>
<ol>
<li>context&#x4E0A;&#x4E0B;&#x6587;&#x7684;&#x610F;&#x4E49;&#x8981;&#x4E86;&#x89E3;&#xFF0C;&#x4EC0;&#x4E48;&#x53EB;&#x505A;&#x4E0A;&#x4E0B;&#x6587;&#xFF0C;&#x5176;&#x5B9E;&#x6240;&#x6709;&#x7684;&#x4E0D;&#x7BA1;FilesystemXmlApplicationContext&#x8FD8;&#x662F;AnnotationConfigApplicationContext&#x5B83;&#x4EEC;&#x90FD;&#x4E0D;&#x53EB;&#x505A;&#x771F;&#x6B63;&#x7684;IOC&#x5BB9;&#x5668;&#xFF0C;&#x5B83;&#x4EEC;&#x90FD;&#x62E5;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x540C;&#x7684;&#x5C5E;&#x6027;DefaultListableBeanFactory&#xFF0C;&#x8FD9;&#x4E2A;&#x624D;&#x662F;&#x771F;&#x6B63;&#x7684;IOC&#x5BB9;&#x5668;&#xFF0C;&#x5B9E;&#x73B0;&#x4E86;IOC&#x5BB9;&#x5668;&#x7684;&#x6240;&#x6709;&#x529F;&#x80FD;&#xFF1B;&#x4F46;&#x662F;&#x5B83;&#x4EEC;&#x5374;&#x628A;&#x8FD9;&#x4E2A;IOC&#x5BB9;&#x5668;&#x653E;&#x5728;&#x4E86;&#x4E0D;&#x540C;&#x7684;&#x73AF;&#x5883;&#x4E0B;&#xFF0C;&#x8FD9;&#x4E2A;&#x73AF;&#x5883;&#x5C31;&#x53EB;&#x505A;&#x4E0A;&#x4E0B;&#x6587;&#xFF1B;&#x5C31;&#x6BD4;&#x5982;&#x8BF4;FileSystemXmlApplicationContext&#xFF0C;&#x5B83;&#x7684;&#x73AF;&#x5883;&#x5C31;&#x662F;Xml&#x6587;&#x4EF6;&#x800C;AnnotationConfigApplicationContext&#x7684;&#x73AF;&#x5883;&#x662F;&#x6CE8;&#x89E3;&#xFF1B;&#x6240;&#x4EE5;&#x8FD9;&#x4E2A;&#x9020;&#x6210;&#x4E86;&#x5B83;&#x4EEC;&#x4E0D;&#x540C;&#x7684;&#x884C;&#x4E3A;&#x65B9;&#x5F0F;&#xFF0C;&#x4E00;&#x4E2A;&#x901A;&#x8FC7;&#x89E3;&#x6790;xml&#x6587;&#x4EF6;&#xFF0C;&#x5B9A;&#x4F4D;&#x3001;&#x8F7D;&#x5165;&#x548C;&#x6CE8;&#x518C;Bean&#x800C;&#x53E6;&#x5916;&#x4E00;&#x4E2A;&#x662F;&#x901A;&#x8FC7;&#x89E3;&#x6790;&#x6CE8;&#x89E3;&#x5B9A;&#x4F4D;&#x3001;&#x8F7D;&#x5165;&#x548C;&#x6CE8;&#x518C;Bean</li>
<li>BeanDefinition&#x7684;&#x5B9A;&#x4F4D;&#x548C;&#x8F7D;&#x5165;&#x662F;&#x901A;&#x8FC7;AnnotationConfigApplicationContext&#x7684;AnnotatedBeanDefinitionReader&#x548C;ClassPathBeanDefinitionScanner&#xFF0C;&#x6240;&#x4EE5;&#x5B9A;&#x4F4D;&#x548C;&#x8F7D;&#x5165;&#x90FD;&#x662F;&#x901A;&#x8FC7;Context&#x6765;&#x5B8C;&#x6210;&#x7684;&#xFF1B;&#x6CE8;&#x518C;&#x662F;IOC&#x5BB9;&#x5668;&#x7684;registerDefinition&#x65B9;&#x6CD5;&#x6765;&#x5B8C;&#x6210;&#x7684;</li>
</ol>
</li>
</ul>
<h4 id="IOC&#x5BB9;&#x5668;&#x7684;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;"><a href="#IOC&#x5BB9;&#x5668;&#x7684;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;" class="headerlink" title="IOC&#x5BB9;&#x5668;&#x7684;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;"></a>IOC&#x5BB9;&#x5668;&#x7684;&#x4F9D;&#x8D56;&#x6CE8;&#x5165;</h4><ul>
<li><p>&#x6D89;&#x53CA;&#x5230;&#x7684;&#x6E90;&#x7801;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String name, @Nullable Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException </span>{</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.doGetBean(name, requiredType, (Object[])<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">}</span><br><span class="line">  </span><br><span class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">doGetBean</span><span class="params">(String name, @Nullable Class&lt;T&gt; requiredType, @Nullable Object[] args, <span class="keyword">boolean</span> typeCheckOnly)</span> <span class="keyword">throws</span> BeansException </span>{</span><br><span class="line">    String beanName = <span class="keyword">this</span>.transformedBeanName(name);</span><br><span class="line">    <span class="comment">//&#x4ECE;&#x7F13;&#x5B58;&#x4E2D;&#x5F97;&#x5230;&#x5BF9;&#x8C61;&#xFF0C;&#x907F;&#x514D;&#x91CD;&#x590D;&#x521B;&#x5EFA;</span></span><br><span class="line">    Object sharedInstance = <span class="keyword">this</span>.getSingleton(beanName);</span><br><span class="line">    Object bean;</span><br><span class="line">    <span class="keyword">if</span> (sharedInstance != <span class="keyword">null</span> &amp;&amp; args == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) {</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isSingletonCurrentlyInCreation(beanName)) {</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Returning eagerly cached instance of singleton bean &apos;&quot;</span> + beanName + <span class="string">&quot;&apos; that is not fully initialized yet - a consequence of a circular reference&quot;</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Returning cached instance of singleton bean &apos;&quot;</span> + beanName + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x56E0;&#x4E3A;IOC&#x4E2D;&#x6709;FactoryBean&#x548C;&#x666E;&#x901A;Bean&#x4E24;&#x79CD;&#xFF0C;&#x6240;&#x4EE5;&#x8FD9;&#x91CC;&#x5C31;&#x662F;&#x5982;&#x679C;&#x8FD9;&#x4E2A;Bean&#x662F;FactoryBean&#xFF0C;</span></span><br><span class="line">        <span class="comment">//&#x5C31;&#x53D6;&#x5F97;&#x5B83;&#x7684;&#x771F;&#x5B9E;&#x5BF9;&#x8C61;</span></span><br><span class="line">        bean = <span class="keyword">this</span>.getObjectForBeanInstance(sharedInstance, name, beanName, (RootBeanDefinition)<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//&#x4E0B;&#x9762;&#x5C31;&#x662F;&#x4ECE;&#x7236;&#x7EA7;&#x5BB9;&#x5668;&#x91CC;&#x9762;&#x5F97;&#x5230;Bean</span></span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isPrototypeCurrentlyInCreation(beanName)) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BeanCurrentlyInCreationException(beanName);</span><br><span class="line">        }</span><br><span class="line">  </span><br><span class="line">        BeanFactory parentBeanFactory = <span class="keyword">this</span>.getParentBeanFactory();</span><br><span class="line">        <span class="keyword">if</span> (parentBeanFactory != <span class="keyword">null</span> &amp;&amp; !<span class="keyword">this</span>.containsBeanDefinition(beanName)) {</span><br><span class="line">            String nameToLookup = <span class="keyword">this</span>.originalBeanName(name);</span><br><span class="line">            <span class="keyword">if</span> (parentBeanFactory <span class="keyword">instanceof</span> AbstractBeanFactory) {</span><br><span class="line">                <span class="keyword">return</span> ((AbstractBeanFactory)parentBeanFactory).doGetBean(nameToLookup, requiredType, args, typeCheckOnly);</span><br><span class="line">            }</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (args != <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">            }</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">        }</span><br><span class="line">  </span><br><span class="line">        <span class="keyword">if</span> (!typeCheckOnly) {</span><br><span class="line">            <span class="keyword">this</span>.markBeanAsCreated(beanName);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x5904;&#x7406;&#x4F9D;&#x8D56;&#xFF0C;&#x521B;&#x5EFA;Bean</span></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            RootBeanDefinition mbd = <span class="keyword">this</span>.getMergedLocalBeanDefinition(beanName);</span><br><span class="line">            <span class="keyword">this</span>.checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line">            String[] dependsOn = mbd.getDependsOn();</span><br><span class="line">            String[] var11;</span><br><span class="line">            <span class="keyword">if</span> (dependsOn != <span class="keyword">null</span>) {</span><br><span class="line">                var11 = dependsOn;</span><br><span class="line">                <span class="keyword">int</span> var12 = dependsOn.length;</span><br><span class="line">  </span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> var13 = <span class="number">0</span>; var13 &lt; var12; ++var13) {</span><br><span class="line">                    String dep = var11[var13];</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.isDependent(beanName, dep)) {</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName, <span class="string">&quot;Circular depends-on relationship between &apos;&quot;</span> + beanName + <span class="string">&quot;&apos; and &apos;&quot;</span> + dep + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">                    }</span><br><span class="line">  </span><br><span class="line">                    <span class="keyword">this</span>.registerDependentBean(dep, beanName);</span><br><span class="line">  </span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        <span class="keyword">this</span>.getBean(dep);</span><br><span class="line">                    } <span class="keyword">catch</span> (NoSuchBeanDefinitionException var24) {</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName, <span class="string">&quot;&apos;&quot;</span> + beanName + <span class="string">&quot;&apos; depends on missing bean &apos;&quot;</span> + dep + <span class="string">&quot;&apos;&quot;</span>, var24);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> (mbd.isSingleton()) {</span><br><span class="line">                sharedInstance = <span class="keyword">this</span>.getSingleton(beanName, () -&gt; {</span><br><span class="line">                    <span class="keyword">try</span> {</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">this</span>.createBean(beanName, mbd, args);</span><br><span class="line">                    } <span class="keyword">catch</span> (BeansException var5) {</span><br><span class="line">                        <span class="keyword">this</span>.destroySingleton(beanName);</span><br><span class="line">                        <span class="keyword">throw</span> var5;</span><br><span class="line">                    }</span><br><span class="line">                });</span><br><span class="line">                bean = <span class="keyword">this</span>.getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) {</span><br><span class="line">                var11 = <span class="keyword">null</span>;</span><br><span class="line">  </span><br><span class="line">                Object prototypeInstance;</span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    <span class="keyword">this</span>.beforePrototypeCreation(beanName);</span><br><span class="line">                    prototypeInstance = <span class="keyword">this</span>.createBean(beanName, mbd, args);</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    <span class="keyword">this</span>.afterPrototypeCreation(beanName);</span><br><span class="line">                }</span><br><span class="line">  </span><br><span class="line">                bean = <span class="keyword">this</span>.getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                String scopeName = mbd.getScope();</span><br><span class="line">                Scope scope = (Scope)<span class="keyword">this</span>.scopes.get(scopeName);</span><br><span class="line">                <span class="keyword">if</span> (scope == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;No Scope registered for scope name &apos;&quot;</span> + scopeName + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">                }</span><br><span class="line">  </span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    Object scopedInstance = scope.get(beanName, () -&gt; {</span><br><span class="line">                        <span class="keyword">this</span>.beforePrototypeCreation(beanName);</span><br><span class="line">  </span><br><span class="line">                        Object var4;</span><br><span class="line">                        <span class="keyword">try</span> {</span><br><span class="line">                            var4 = <span class="keyword">this</span>.createBean(beanName, mbd, args);</span><br><span class="line">                        } <span class="keyword">finally</span> {</span><br><span class="line">                            <span class="keyword">this</span>.afterPrototypeCreation(beanName);</span><br><span class="line">                        }</span><br><span class="line">  </span><br><span class="line">                        <span class="keyword">return</span> var4;</span><br><span class="line">                    });</span><br><span class="line">                    bean = <span class="keyword">this</span>.getObjectForBeanInstance(scopedInstance, name, beanName, mbd);</span><br><span class="line">                } <span class="keyword">catch</span> (IllegalStateException var23) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(beanName, <span class="string">&quot;Scope &apos;&quot;</span> + scopeName + <span class="string">&quot;&apos; is not active for the current thread; consider defining a scoped proxy for this bean if you intend to refer to it from a singleton&quot;</span>, var23);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (BeansException var26) {</span><br><span class="line">            <span class="keyword">this</span>.cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">            <span class="keyword">throw</span> var26;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">if</span> (requiredType != <span class="keyword">null</span> &amp;&amp; !requiredType.isInstance(bean)) {</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            T convertedBean = <span class="keyword">this</span>.getTypeConverter().convertIfNecessary(bean, requiredType);</span><br><span class="line">            <span class="keyword">if</span> (convertedBean == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> convertedBean;</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">catch</span> (TypeMismatchException var25) {</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) {</span><br><span class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Failed to convert bean &apos;&quot;</span> + name + <span class="string">&quot;&apos; to required type &apos;&quot;</span> + ClassUtils.getQualifiedName(requiredType) + <span class="string">&quot;&apos;&quot;</span>, var25);</span><br><span class="line">            }</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BeanNotOfRequiredTypeException(name, requiredType, bean.getClass());</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>doGetBean&#x7684;&#x6D41;&#x7A0B;&#x56FE;:</p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1ftlwn5l3cij20db0lywfp.jpg" alt=""></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">doCreateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)</span> <span class="keyword">throws</span> BeanCreationException </span>{</span><br><span class="line">       BeanWrapper instanceWrapper = <span class="keyword">null</span>;</span><br><span class="line">       <span class="keyword">if</span> (mbd.isSingleton()) {</span><br><span class="line">           instanceWrapper = (BeanWrapper)<span class="keyword">this</span>.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       <span class="keyword">if</span> (instanceWrapper == <span class="keyword">null</span>) {</span><br><span class="line">           instanceWrapper = <span class="keyword">this</span>.createBeanInstance(beanName, mbd, args);</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       Object bean = instanceWrapper.getWrappedInstance();</span><br><span class="line">       Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br><span class="line">       <span class="keyword">if</span> (beanType != NullBean.class) {</span><br><span class="line">           mbd.resolvedTargetType = beanType;</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       Object var7 = mbd.postProcessingLock;</span><br><span class="line">       <span class="keyword">synchronized</span>(mbd.postProcessingLock) {</span><br><span class="line">           <span class="keyword">if</span> (!mbd.postProcessed) {</span><br><span class="line">               <span class="keyword">try</span> {</span><br><span class="line">                   <span class="keyword">this</span>.applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br><span class="line">               } <span class="keyword">catch</span> (Throwable var17) {</span><br><span class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName, <span class="string">&quot;Post-processing of merged bean definition failed&quot;</span>, var17);</span><br><span class="line">               }</span><br><span class="line">  </span><br><span class="line">               mbd.postProcessed = <span class="keyword">true</span>;</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       <span class="keyword">boolean</span> earlySingletonExposure = mbd.isSingleton() &amp;&amp; <span class="keyword">this</span>.allowCircularReferences &amp;&amp; <span class="keyword">this</span>.isSingletonCurrentlyInCreation(beanName);</span><br><span class="line">       <span class="keyword">if</span> (earlySingletonExposure) {</span><br><span class="line">           <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) {</span><br><span class="line">               <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Eagerly caching bean &apos;&quot;</span> + beanName + <span class="string">&quot;&apos; to allow for resolving potential circular references&quot;</span>);</span><br><span class="line">           }</span><br><span class="line">  </span><br><span class="line">           <span class="keyword">this</span>.addSingletonFactory(beanName, () -&gt; {</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">this</span>.getEarlyBeanReference(beanName, mbd, bean);</span><br><span class="line">           });</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       Object exposedObject = bean;</span><br><span class="line">  </span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           <span class="keyword">this</span>.populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">           exposedObject = <span class="keyword">this</span>.initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">       } <span class="keyword">catch</span> (Throwable var18) {</span><br><span class="line">           <span class="keyword">if</span> (var18 <span class="keyword">instanceof</span> BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException)var18).getBeanName())) {</span><br><span class="line">               <span class="keyword">throw</span> (BeanCreationException)var18;</span><br><span class="line">           }</span><br><span class="line">  </span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName, <span class="string">&quot;Initialization of bean failed&quot;</span>, var18);</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       <span class="keyword">if</span> (earlySingletonExposure) {</span><br><span class="line">           Object earlySingletonReference = <span class="keyword">this</span>.getSingleton(beanName, <span class="keyword">false</span>);</span><br><span class="line">           <span class="keyword">if</span> (earlySingletonReference != <span class="keyword">null</span>) {</span><br><span class="line">               <span class="keyword">if</span> (exposedObject == bean) {</span><br><span class="line">                   exposedObject = earlySingletonReference;</span><br><span class="line">               } <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="keyword">this</span>.allowRawInjectionDespiteWrapping &amp;&amp; <span class="keyword">this</span>.hasDependentBean(beanName)) {</span><br><span class="line">                   String[] dependentBeans = <span class="keyword">this</span>.getDependentBeans(beanName);</span><br><span class="line">                   Set&lt;String&gt; actualDependentBeans = <span class="keyword">new</span> LinkedHashSet(dependentBeans.length);</span><br><span class="line">                   String[] var12 = dependentBeans;</span><br><span class="line">                   <span class="keyword">int</span> var13 = dependentBeans.length;</span><br><span class="line">  </span><br><span class="line">                   <span class="keyword">for</span>(<span class="keyword">int</span> var14 = <span class="number">0</span>; var14 &lt; var13; ++var14) {</span><br><span class="line">                       String dependentBean = var12[var14];</span><br><span class="line">                       <span class="keyword">if</span> (!<span class="keyword">this</span>.removeSingletonIfCreatedForTypeCheckOnly(dependentBean)) {</span><br><span class="line">                           actualDependentBeans.add(dependentBean);</span><br><span class="line">                       }</span><br><span class="line">                   }</span><br><span class="line">  </span><br><span class="line">                   <span class="keyword">if</span> (!actualDependentBeans.isEmpty()) {</span><br><span class="line">                       <span class="keyword">throw</span> <span class="keyword">new</span> BeanCurrentlyInCreationException(beanName, <span class="string">&quot;Bean with name &apos;&quot;</span> + beanName + <span class="string">&quot;&apos; has been injected into other beans [&quot;</span> + StringUtils.collectionToCommaDelimitedString(actualDependentBeans) + <span class="string">&quot;] in its raw version as part of a circular reference, but has eventually been wrapped. This means that said other beans do not use the final version of the bean. This is often the result of over-eager type matching - consider using &apos;getBeanNamesOfType&apos; with the &apos;allowEagerInit&apos; flag turned off, for example.&quot;</span>);</span><br><span class="line">                   }</span><br><span class="line">               }</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line">  </span><br><span class="line">       <span class="keyword">try</span> {</span><br><span class="line">           <span class="keyword">this</span>.registerDisposableBeanIfNecessary(beanName, bean, mbd);</span><br><span class="line">           <span class="keyword">return</span> exposedObject;</span><br><span class="line">       } <span class="keyword">catch</span> (BeanDefinitionValidationException var16) {</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd.getResourceDescription(), beanName, <span class="string">&quot;Invalid destruction signature&quot;</span>, var16);</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8FD9;&#x91CC;&#x6709;&#x4E2A;BeanWapper&#xFF0C;&#x8FD9;&#x4E2A;BeanWapper&#x7684;&#x4F5C;&#x7528;&#x662F;&#x7BA1;&#x7406;Bean&#x7684;&#x5C5E;&#x6027;</p>
</li>
</ul>
<h4 id="&#x5BB9;&#x5668;&#x76F8;&#x5173;&#x7279;&#x6027;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"><a href="#&#x5BB9;&#x5668;&#x76F8;&#x5173;&#x7279;&#x6027;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;" class="headerlink" title="&#x5BB9;&#x5668;&#x76F8;&#x5173;&#x7279;&#x6027;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;"></a>&#x5BB9;&#x5668;&#x76F8;&#x5173;&#x7279;&#x6027;&#x7684;&#x8BBE;&#x8BA1;&#x4E0E;&#x5B9E;&#x73B0;</h4><h5 id="ApplicationContext&#x548C;Bean&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x9500;&#x6BC1;"><a href="#ApplicationContext&#x548C;Bean&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x9500;&#x6BC1;" class="headerlink" title="ApplicationContext&#x548C;Bean&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x9500;&#x6BC1;"></a>ApplicationContext&#x548C;Bean&#x7684;&#x521D;&#x59CB;&#x5316;&#x548C;&#x9500;&#x6BC1;</h5><p>ApplicationContext&#x521D;&#x59CB;&#x5316;:prepareBeanFactory()</p>
<p>ApplicationContext&#x7684;&#x9500;&#x6BC1;&#xFF1A;doClose();</p>
<p>&#x5BB9;&#x5668;&#x7684;&#x5B9E;&#x73B0;&#x662F;&#x901A;&#x8FC7;IOC&#x7BA1;&#x7406;Bean&#x751F;&#x547D;&#x5468;&#x671F;&#x6765;&#x5B9E;&#x73B0;&#x7684;&#xFF1A;</p>
<p>initailizeBean&#xFF1B;doClose&#xFF1B;destroy</p>
<h5 id="lazy-init&#x5C5E;&#x6027;&#x548C;&#x9884;&#x5B9E;&#x4F8B;&#x5316;"><a href="#lazy-init&#x5C5E;&#x6027;&#x548C;&#x9884;&#x5B9E;&#x4F8B;&#x5316;" class="headerlink" title="lazy-init&#x5C5E;&#x6027;&#x548C;&#x9884;&#x5B9E;&#x4F8B;&#x5316;"></a>lazy-init&#x5C5E;&#x6027;&#x548C;&#x9884;&#x5B9E;&#x4F8B;&#x5316;</h5><h5 id="FactoryBean&#x7684;&#x5B9E;&#x73B0;"><a href="#FactoryBean&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="FactoryBean&#x7684;&#x5B9E;&#x73B0;"></a>FactoryBean&#x7684;&#x5B9E;&#x73B0;</h5><p>&#x5176;&#x5B9E;&#x5728;&#x6211;&#x770B;&#x6765;FactoryBean&#x5176;&#x5B9E;&#x5C31;&#x662F;Spring &#x5E2E;&#x6211;&#x4EEC;&#x5C01;&#x88C5;&#x4E00;&#x4E2A;&#x7B80;&#x5316;&#x7684;&#x5DE5;&#x5382;&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x628A;&#x8FD9;&#x4E2A;FactoryBean&#x653E;&#x5728;IOC&#x5BB9;&#x5668;&#x91CC;&#x9762;&#xFF0C;&#x7136;&#x540E;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x5DE5;&#x5382;&#x7C7B;&#x751F;&#x6210;&#x6211;&#x4EEC;&#x60F3;&#x8981;&#x7684;&#x7C7B;</p>
<p>&#x4E3B;&#x8981;&#x6D89;&#x53CA;&#x5230;&#x7684;&#x6E90;&#x7801;&#xFF1A;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">getObjectForBeanInstance</span><span class="params">(Object beanInstance, String name, String beanName, @Nullable RootBeanDefinition mbd)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (BeanFactoryUtils.isFactoryDereference(name)) {</span><br><span class="line">            <span class="keyword">if</span> (beanInstance <span class="keyword">instanceof</span> NullBean) {</span><br><span class="line">                <span class="keyword">return</span> beanInstance;</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!(beanInstance <span class="keyword">instanceof</span> FactoryBean)) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BeanIsNotAFactoryException(<span class="keyword">this</span>.transformedBeanName(name), beanInstance.getClass());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (beanInstance <span class="keyword">instanceof</span> FactoryBean &amp;&amp; !BeanFactoryUtils.isFactoryDereference(name)) {</span><br><span class="line">            Object object = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (mbd == <span class="keyword">null</span>) {</span><br><span class="line">                object = <span class="keyword">this</span>.getCachedObjectForFactoryBean(beanName);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (object == <span class="keyword">null</span>) {</span><br><span class="line">                FactoryBean&lt;?&gt; factory = (FactoryBean)beanInstance;</span><br><span class="line">                <span class="keyword">if</span> (mbd == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.containsBeanDefinition(beanName)) {</span><br><span class="line">                    mbd = <span class="keyword">this</span>.getMergedLocalBeanDefinition(beanName);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">boolean</span> synthetic = mbd != <span class="keyword">null</span> &amp;&amp; mbd.isSynthetic();</span><br><span class="line">                object = <span class="keyword">this</span>.getObjectFromFactoryBean(factory, beanName, !synthetic);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> object;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> beanInstance;</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">getObjectFromFactoryBean</span><span class="params">(FactoryBean&lt;?&gt; factory, String beanName, <span class="keyword">boolean</span> shouldPostProcess)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (factory.isSingleton() &amp;&amp; <span class="keyword">this</span>.containsSingleton(beanName)) {</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.getSingletonMutex()) {</span><br><span class="line">            Object object = <span class="keyword">this</span>.factoryBeanObjectCache.get(beanName);</span><br><span class="line">            <span class="keyword">if</span> (object == <span class="keyword">null</span>) {</span><br><span class="line">                object = <span class="keyword">this</span>.doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">                Object alreadyThere = <span class="keyword">this</span>.factoryBeanObjectCache.get(beanName);</span><br><span class="line">                <span class="keyword">if</span> (alreadyThere != <span class="keyword">null</span>) {</span><br><span class="line">                    object = alreadyThere;</span><br><span class="line">                } <span class="keyword">else</span> {</span><br><span class="line">                    <span class="keyword">if</span> (shouldPostProcess) {</span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">this</span>.isSingletonCurrentlyInCreation(beanName)) {</span><br><span class="line">                            <span class="keyword">return</span> object;</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">this</span>.beforeSingletonCreation(beanName);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">try</span> {</span><br><span class="line">                            object = <span class="keyword">this</span>.postProcessObjectFromFactoryBean(object, beanName);</span><br><span class="line">                        } <span class="keyword">catch</span> (Throwable var14) {</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(beanName, <span class="string">&quot;Post-processing of FactoryBean&apos;s singleton object failed&quot;</span>, var14);</span><br><span class="line">                        } <span class="keyword">finally</span> {</span><br><span class="line">                            <span class="keyword">this</span>.afterSingletonCreation(beanName);</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.containsSingleton(beanName)) {</span><br><span class="line">                        <span class="keyword">this</span>.factoryBeanObjectCache.put(beanName, object);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> object;</span><br><span class="line">        }</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        Object object = <span class="keyword">this</span>.doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">        <span class="keyword">if</span> (shouldPostProcess) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                object = <span class="keyword">this</span>.postProcessObjectFromFactoryBean(object, beanName);</span><br><span class="line">            } <span class="keyword">catch</span> (Throwable var17) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(beanName, <span class="string">&quot;Post-processing of FactoryBean&apos;s object failed&quot;</span>, var17);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x4E0A;&#x9762;&#x4E24;&#x4E2A;&#x65B9;&#x6CD5;&#x89E3;&#x91CA;&#x4E86;&#x4ECE;FactoryBean&#x53D6;&#x5F97;&#x771F;&#x5B9E;&#x5BF9;&#x8C61;</p>
<h5 id="BeanPostProcessor&#x7684;&#x5B9E;&#x73B0;"><a href="#BeanPostProcessor&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="BeanPostProcessor&#x7684;&#x5B9E;&#x73B0;"></a>BeanPostProcessor&#x7684;&#x5B9E;&#x73B0;</h5><p>&#x8FD9;&#x4E2A;&#x6211;&#x4EEC;&#x770B;&#x6E90;&#x7801;&#x7684;initializeBean&#x65B9;&#x6CD5;&#x5C31;&#x884C;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">initializeBean</span><span class="params">(String beanName, Object bean, @Nullable RootBeanDefinition mbd)</span> </span>{</span><br><span class="line">    <span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span>) {</span><br><span class="line">        AccessController.doPrivileged(() -&gt; {</span><br><span class="line">            <span class="keyword">this</span>.invokeAwareMethods(beanName, bean);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        }, <span class="keyword">this</span>.getAccessControlContext());</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">this</span>.invokeAwareMethods(beanName, bean);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">//&#x5F97;&#x5230;&#x7684;&#x662F;&#x4E00;&#x4E2A;BeanWapper</span></span><br><span class="line">    Object wrappedBean = bean;</span><br><span class="line">    <span class="keyword">if</span> (mbd == <span class="keyword">null</span> || !mbd.isSynthetic()) {</span><br><span class="line">        <span class="comment">//&#x8FD9;&#x91CC;&#x5C31;&#x4F1A;&#x4E00;&#x6B21;&#x8C03;&#x7528;&#x6240;&#x6709;Bean&#x521B;&#x5EFA;&#x7684;&#x524D;&#x7F6E;&#x5904;&#x7406;&#x5668;</span></span><br><span class="line">        wrappedBean = <span class="keyword">this</span>.applyBeanPostProcessorsBeforeInitialization(bean, beanName);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="comment">//&#x521D;&#x59CB;&#x5316;Bean</span></span><br><span class="line">        <span class="keyword">this</span>.invokeInitMethods(beanName, wrappedBean, mbd);</span><br><span class="line">    } <span class="keyword">catch</span> (Throwable var6) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BeanCreationException(mbd != <span class="keyword">null</span> ? mbd.getResourceDescription() : <span class="keyword">null</span>, beanName, <span class="string">&quot;Invocation of init method failed&quot;</span>, var6);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mbd == <span class="keyword">null</span> || !mbd.isSynthetic()) {</span><br><span class="line">        <span class="comment">//&#x8C03;&#x7528;&#x6240;&#x6709;Bean&#x521B;&#x5EFA;&#x7684;&#x540E;&#x7F6E;&#x5904;&#x7406;&#x5668;</span></span><br><span class="line">        wrappedBean = <span class="keyword">this</span>.applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> wrappedBean;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x5728;getBean -&gt;doGetBean() -&gt;createBean-&gt; doCreateBean&#x4E2D;&#x8C03;&#x7528;        </p>
<h5 id="autowiring-&#x7684;&#x5B9E;&#x73B0;"><a href="#autowiring-&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="autowiring &#x7684;&#x5B9E;&#x73B0;"></a>autowiring &#x7684;&#x5B9E;&#x73B0;</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mbd.getResolvedAutowireMode() == <span class="number">1</span> || mbd.getResolvedAutowireMode() == <span class="number">2</span>) {</span><br><span class="line">    MutablePropertyValues newPvs = <span class="keyword">new</span> MutablePropertyValues((PropertyValues)pvs);</span><br><span class="line">    <span class="keyword">if</span> (mbd.getResolvedAutowireMode() == <span class="number">1</span>) {</span><br><span class="line">        <span class="keyword">this</span>.autowireByName(beanName, mbd, bw, newPvs);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mbd.getResolvedAutowireMode() == <span class="number">2</span>) {</span><br><span class="line">        <span class="keyword">this</span>.autowireByType(beanName, mbd, bw, newPvs);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    pvs = newPvs;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8FD9;&#x662F;&#x81EA;&#x52A8;&#x88C5;&#x914D;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;&#x5728;AbstractAutowireCapableBeanFactory&#x7684;populateBean&#x65B9;&#x6CD5;&#x4E2D;&#xFF0C;&#x8FD9;&#x4E2A;populateBean &#x4F1A;&#x5728;&#x8C03;&#x7528;doCreateBean&#x4E2D;&#x8C03;&#x7528;</p>
<h5 id="Bean&#x5BF9;IOC&#x5BB9;&#x5668;&#x7684;&#x611F;&#x77E5;"><a href="#Bean&#x5BF9;IOC&#x5BB9;&#x5668;&#x7684;&#x611F;&#x77E5;" class="headerlink" title="Bean&#x5BF9;IOC&#x5BB9;&#x5668;&#x7684;&#x611F;&#x77E5;"></a>Bean&#x5BF9;IOC&#x5BB9;&#x5668;&#x7684;&#x611F;&#x77E5;</h5><h3 id="Spring-AOP"><a href="#Spring-AOP" class="headerlink" title="Spring AOP"></a>Spring AOP</h3><h4 id="Spring-AOP-&#x6982;&#x8FF0;"><a href="#Spring-AOP-&#x6982;&#x8FF0;" class="headerlink" title="Spring AOP &#x6982;&#x8FF0;"></a>Spring AOP &#x6982;&#x8FF0;</h4><p>&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x7684;&#x4EE3;&#x7801;&#x4E2D;&#x4E0D;&#x518D;&#x542B;&#x6709;&#x9488;&#x5BF9;&#x7279;&#x5B9A;&#x9886;&#x57DF;&#x95EE;&#x9898;&#x4EE3;&#x7801;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x4E1A;&#x52A1;&#x903B;&#x8F91;&#x540C;&#x7279;&#x5B9A;&#x9886;&#x57DF;&#x95EE;&#x9898;&#x7684;&#x5173;&#x7CFB;&#x901A;&#x8FC7;&#x5207;&#x9762;&#x6765;&#x5C01;&#x88C5;&#x548C;&#x7EF4;&#x62A4;&#xFF0C;&#x8FD9;&#x6837;&#x539F;&#x672C;&#x5206;&#x6563;&#x5728;&#x6574;&#x4E2A;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x4E2D;&#x7684;&#x53D8;&#x52A8;&#x5C31;&#x53EF;&#x4EE5;&#x5F88;&#x597D;&#x7684;&#x7BA1;&#x7406;&#x8D77;&#x6765;</p>
<ul>
<li>&#x57FA;&#x7840;&#xFF1A;&#x89C6;&#x4E3A;&#x5F85;&#x589E;&#x5F3A;&#x5BF9;&#x8C61;&#x6216;&#x8005;&#x8BF4;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#xFF1B;</li>
<li>&#x5207;&#x9762;&#xFF1A;&#x901A;&#x5E38;&#x5305;&#x542B;&#x5BF9;&#x4E8E;&#x57FA;&#x7840;&#x7684;&#x589E;&#x5F3A;&#x5E94;&#x7528;&#xFF1B;</li>
<li>&#x914D;&#x7F6E;&#xFF1A;&#x53EF;&#x4EE5;&#x770B;&#x6210;&#x662F;&#x4E00;&#x79CD;&#x7F16;&#x7EC7;&#xFF0C;&#x628A;&#x57FA;&#x7840;&#x548C;&#x5207;&#x9762;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x5207;&#x9762;&#x5BF9;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x7684;&#x7F16;&#x7EC7;&#x5B9E;&#x73B0;</li>
</ul>
<p>&#x5728;Spring AOP&#x4E2D;&#x6709;&#x4E09;&#x4E2A;&#x4E0E;&#x4E0A;&#x9762;&#x5BF9;&#x5E94;&#xFF1A;</p>
<ul>
<li>Advice&#x901A;&#x77E5;&#xFF1A;&#x5B9A;&#x4E49;&#x5728;&#x5207;&#x5165;&#x70B9;&#x505A;&#x4EC0;&#x4E48;&#xFF0C;&#x4E3A;&#x5207;&#x9762;&#x589E;&#x5F3A;&#x63D0;&#x4F9B;&#x7EC7;&#x5165;&#x63A5;&#x53E3;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x5207;&#x9762;</li>
<li>Pointcut&#x5207;&#x70B9;&#xFF1A;&#x5B9A;&#x4E49;&#x901A;&#x77E5;&#x5E94;&#x8BE5;&#x4F5C;&#x7528;&#x4E8E;&#x54EA;&#x4E2A;&#x8FDE;&#x63A5;&#x70B9;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x57FA;&#x7840;</li>
<li>Advisor&#x901A;&#x77E5;&#x5668;&#xFF1A;&#x5C06;&#x5207;&#x9762;&#x548C;&#x8FDE;&#x63A5;&#x70B9;&#x7ED3;&#x5408;&#x8D77;&#x6765;&#x7684;&#x8BBE;&#x8BA1;&#xFF0C;&#x76F8;&#x5F53;&#x4E8E;&#x4E0A;&#x9762;&#x7684;&#x914D;&#x7F6E;</li>
</ul>
<h4 id="&#x589E;&#x5F3A;&#x5BF9;&#x8C61;&#x529F;&#x80FD;&#x7684;&#x8FC7;&#x7A0B;"><a href="#&#x589E;&#x5F3A;&#x5BF9;&#x8C61;&#x529F;&#x80FD;&#x7684;&#x8FC7;&#x7A0B;" class="headerlink" title="&#x589E;&#x5F3A;&#x5BF9;&#x8C61;&#x529F;&#x80FD;&#x7684;&#x8FC7;&#x7A0B;"></a>&#x589E;&#x5F3A;&#x5BF9;&#x8C61;&#x529F;&#x80FD;&#x7684;&#x8FC7;&#x7A0B;</h4><p>&#x9996;&#x5148;&#x7ED9;&#x51FA;AOP&#x5E94;&#x7528;&#x76F8;&#x5173;&#x7C7B;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x56FE;&#xFF1A;</p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fts57tjs3uj20op0dz0t2.jpg" alt=""></p>
<p>&#x6211;&#x4EEC;&#x5148;&#x4EE5;ProxyFactoryBean&#x6765;&#x8BB2;&#x89E3;Aop</p>
<ol>
<li><p>&#x914D;&#x7F6E;ProxyFactoryBean</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testAdvisor&quot;</span> <span class="attr">class</span>=<span class="string">&quot;comabc.TestAdvisor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;testAop&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.aop.ProxyFactoryBean&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;proxyInterfaces&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>com.test.AbcInterface<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;target&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.abc.TestTarget&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;intercerptorNames&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">list</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>testAdvisor<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>testAdvisor&#x662F;&#x5B9A;&#x4E49;&#x5207;&#x9762;</li>
<li>testAop&#x5B9A;&#x4E49;ProxyFactoryBean&#xFF0C;target&#x5C5E;&#x6027;&#x662F;&#x57FA;&#x7840;&#x5373;&#x5F85;&#x589E;&#x5F3A;&#x7684;&#x7C7B;</li>
</ul>
</li>
<li><p>ProxyFactoryBean<strong>&#x751F;&#x6210;AopProxy&#x4EE3;&#x7406;&#x5BF9;&#x8C61;</strong></p>
<p>&#x751F;&#x6210;AopProxy&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x7684;&#x6D41;&#x7A0B;&#x56FE;</p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fts84yqduyj20x50gvwfd.jpg" alt=""></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> BeansException </span>{</span><br><span class="line">    <span class="comment">//&#x521D;&#x59CB;&#x5316;&#x901A;&#x77E5;&#x5668;&#x94FE;</span></span><br><span class="line">    <span class="keyword">this</span>.initializeAdvisorChain();</span><br><span class="line">    <span class="comment">//&#x8FD9;&#x91CC;&#x662F;&#x5BF9;singleton&#x548C;prototype&#x7684;&#x7C7B;&#x578B;&#x8FDB;&#x884C;&#x533A;&#x5206;&#xFF0C;&#x751F;&#x6210;&#x5BF9;&#x5E94;&#x7684;proxy</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isSingleton()) {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getSingletonInstance();</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.targetName == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.logger.warn(<span class="string">&quot;Using non-singleton proxies with singleton targets is often undesirable. Enable prototype proxies by setting the &apos;targetName&apos; property.&quot;</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.newPrototypeInstance();</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">initializeAdvisorChain</span><span class="params">()</span> <span class="keyword">throws</span> AopConfigException, BeansException </span>{</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.advisorChainInitialized) {</span><br><span class="line">            <span class="keyword">if</span> (!ObjectUtils.isEmpty(<span class="keyword">this</span>.interceptorNames)) {</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;No BeanFactory available anymore (probably due to serialization) - cannot resolve interceptor names &quot;</span> + Arrays.asList(<span class="keyword">this</span>.interceptorNames));</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.interceptorNames[<span class="keyword">this</span>.interceptorNames.length - <span class="number">1</span>].endsWith(<span class="string">&quot;*&quot;</span>) &amp;&amp; <span class="keyword">this</span>.targetName == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.targetSource == EMPTY_TARGET_SOURCE) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">&quot;Target required after globals&quot;</span>);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                String[] var1 = <span class="keyword">this</span>.interceptorNames;</span><br><span class="line">                <span class="keyword">int</span> var2 = var1.length;</span><br><span class="line">                <span class="comment">//&#x8FD9;&#x91CC;&#x662F;&#x6DFB;&#x52A0;Advisor&#x94FE;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x901A;&#x8FC7;interceprotNames&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x7684;</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> var3 = <span class="number">0</span>; var3 &lt; var2; ++var3) {</span><br><span class="line">                    String name = var1[var3];</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isTraceEnabled()) {</span><br><span class="line">                        <span class="keyword">this</span>.logger.trace(<span class="string">&quot;Configuring advisor or advice &apos;&quot;</span> + name + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (name.endsWith(<span class="string">&quot;*&quot;</span>)) {</span><br><span class="line">                        <span class="keyword">if</span> (!(<span class="keyword">this</span>.beanFactory <span class="keyword">instanceof</span> ListableBeanFactory)) {</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">&quot;Can only use global advisors or interceptors with a ListableBeanFactory&quot;</span>);</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">this</span>.addGlobalAdvisor((ListableBeanFactory)<span class="keyword">this</span>.beanFactory, name.substring(<span class="number">0</span>, name.length() - <span class="string">&quot;*&quot;</span>.length()));</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        Object advice;</span><br><span class="line">                        <span class="keyword">if</span> (!<span class="keyword">this</span>.singleton &amp;&amp; !<span class="keyword">this</span>.beanFactory.isSingleton(name)) {</span><br><span class="line">                            advice = <span class="keyword">new</span> ProxyFactoryBean.PrototypePlaceholderAdvisor(name);</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            advice = <span class="keyword">this</span>.beanFactory.getBean(name);</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">this</span>.addAdvisorOnChainCreation(advice, name);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.advisorChainInitialized = <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> Object <span class="title">getSingletonInstance</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.singletonInstance == <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.targetSource = <span class="keyword">this</span>.freshTargetSource();</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.autodetectInterfaces &amp;&amp; <span class="keyword">this</span>.getProxiedInterfaces().length == <span class="number">0</span> &amp;&amp; !<span class="keyword">this</span>.isProxyTargetClass()) {</span><br><span class="line">                Class&lt;?&gt; targetClass = <span class="keyword">this</span>.getTargetClass();</span><br><span class="line">                <span class="keyword">if</span> (targetClass == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> FactoryBeanNotInitializedException(<span class="string">&quot;Cannot determine target class for proxy&quot;</span>);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.setInterfaces(ClassUtils.getAllInterfacesForClass(targetClass, <span class="keyword">this</span>.proxyClassLoader));</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">super</span>.setFrozen(<span class="keyword">this</span>.freezeProxy);</span><br><span class="line">            <span class="keyword">this</span>.singletonInstance = <span class="keyword">this</span>.getProxy(<span class="keyword">this</span>.createAopProxy());</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.singletonInstance;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> AopProxy <span class="title">createAopProxy</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.active) {</span><br><span class="line">            <span class="keyword">this</span>.activate();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getAopProxyFactory().createAopProxy(<span class="keyword">this</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AopProxy <span class="title">createAopProxy</span><span class="params">(AdvisedSupport config)</span> <span class="keyword">throws</span> AopConfigException </span>{</span><br><span class="line">        <span class="keyword">if</span> (!config.isOptimize() &amp;&amp; !config.isProxyTargetClass() &amp;&amp; !<span class="keyword">this</span>.hasNoUserSuppliedProxyInterfaces(config)) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> JdkDynamicAopProxy(config);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            Class&lt;?&gt; targetClass = config.getTargetClass();</span><br><span class="line">            <span class="keyword">if</span> (targetClass == <span class="keyword">null</span>) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">&quot;TargetSource cannot determine target class: Either an interface or a target is required for proxy creation.&quot;</span>);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//&#x5982;&#x679C;&#x6709;&#x63A5;&#x53E3;&#x4F7F;&#x7528;JDK&#x52A8;&#x6001;&#x4EE3;&#x7406;&#xFF0C;&#x6CA1;&#x6709;&#x63A5;&#x53E3;&#x4F7F;&#x7528;CGLIB</span></span><br><span class="line">                <span class="keyword">return</span> (AopProxy)(!targetClass.isInterface() &amp;&amp; !Proxy.isProxyClass(targetClass) ? <span class="keyword">new</span> ObjenesisCglibAopProxy(config) : <span class="keyword">new</span> JdkDynamicAopProxy(config));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>Spring Aop&#x62E6;&#x622A;&#x5668;&#x8C03;&#x7528;&#x5B9E;&#x73B0;</p>
<p>&#x6211;&#x4EEC;&#x5C31;&#x4EE5;JDK invoke&#x65B9;&#x6CD5;&#x8BB2;&#x89E3;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">    Object oldProxy = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">boolean</span> setProxyContext = <span class="keyword">false</span>;</span><br><span class="line">    TargetSource targetSource = <span class="keyword">this</span>.advised.targetSource;</span><br><span class="line">    Object target = <span class="keyword">null</span>;</span><br><span class="line">   </span><br><span class="line">    Boolean var9;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.equalsDefined || !AopUtils.isEqualsMethod(method)) {</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x76EE;&#x6807;&#x5BF9;&#x8C61;&#x6CA1;&#x6709;Object&#x7C7B;&#x7684;equals&#x3001;hashCode&#x65B9;&#x6CD5;</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.hashCodeDefined &amp;&amp; AopUtils.isHashCodeMethod(method)) {</span><br><span class="line">                Integer var19 = <span class="keyword">this</span>.hashCode();</span><br><span class="line">                <span class="keyword">return</span> var19;</span><br><span class="line">            }</span><br><span class="line">   </span><br><span class="line">            <span class="keyword">if</span> (method.getDeclaringClass() == DecoratingProxy.class) {</span><br><span class="line">                Class var18 = AopProxyUtils.ultimateTargetClass(<span class="keyword">this</span>.advised);</span><br><span class="line">                <span class="keyword">return</span> var18;</span><br><span class="line">            }</span><br><span class="line">   </span><br><span class="line">            Object retVal;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.advised.opaque &amp;&amp; method.getDeclaringClass().isInterface() &amp;&amp; method.getDeclaringClass().isAssignableFrom(Advised.class)) {</span><br><span class="line">                <span class="comment">//&#x6839;&#x636E;&#x4EE3;&#x7406;&#x5BF9;&#x8C61;&#x7684;&#x914D;&#x7F6E;(ProxyConfig)&#x6765;&#x8C03;&#x7528;&#x670D;&#x52A1;</span></span><br><span class="line">                retVal = AopUtils.invokeJoinpointUsingReflection(<span class="keyword">this</span>.advised, method, args);</span><br><span class="line">                <span class="keyword">return</span> retVal;</span><br><span class="line">            }</span><br><span class="line">   </span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.advised.exposeProxy) {</span><br><span class="line">                oldProxy = AopContext.setCurrentProxy(proxy);</span><br><span class="line">                setProxyContext = <span class="keyword">true</span>;</span><br><span class="line">            }</span><br><span class="line">   </span><br><span class="line">            target = targetSource.getTarget();</span><br><span class="line">            Class&lt;?&gt; targetClass = target != <span class="keyword">null</span> ? target.getClass() : <span class="keyword">null</span>;</span><br><span class="line">            <span class="comment">//&#x83B7;&#x5F97;&#x7ECF;&#x8FC7;&#x8FC7;&#x6EE4;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x6240;&#x6709;&#x62E6;&#x622A;&#x5668;</span></span><br><span class="line">            List&lt;Object&gt; chain = <span class="keyword">this</span>.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);</span><br><span class="line">            <span class="keyword">if</span> (chain.isEmpty()) {</span><br><span class="line">                Object[] argsToUse = AopProxyUtils.adaptArgumentsIfNecessary(method, args);</span><br><span class="line">                retVal = AopUtils.invokeJoinpointUsingReflection(target, method, argsToUse);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">//&#x6CBF;&#x7740;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x6267;&#x884C;&#x65B9;&#x6CD5;</span></span><br><span class="line">                MethodInvocation invocation = <span class="keyword">new</span> ReflectiveMethodInvocation(proxy, target, method, args, targetClass, chain);</span><br><span class="line">                retVal = invocation.proceed();</span><br><span class="line">            }</span><br><span class="line">   </span><br><span class="line">            Class&lt;?&gt; returnType = method.getReturnType();</span><br><span class="line">            <span class="keyword">if</span> (retVal != <span class="keyword">null</span> &amp;&amp; retVal == target &amp;&amp; returnType != Object.class &amp;&amp; returnType.isInstance(proxy) &amp;&amp; !RawTargetAccess.class.isAssignableFrom(method.getDeclaringClass())) {</span><br><span class="line">                retVal = proxy;</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (retVal == <span class="keyword">null</span> &amp;&amp; returnType != Void.TYPE &amp;&amp; returnType.isPrimitive()) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AopInvocationException(<span class="string">&quot;Null return value from advice does not match primitive return type for: &quot;</span> + method);</span><br><span class="line">            }</span><br><span class="line">   </span><br><span class="line">            Object var13 = retVal;</span><br><span class="line">            <span class="keyword">return</span> var13;</span><br><span class="line">        }</span><br><span class="line">   </span><br><span class="line">        var9 = <span class="keyword">this</span>.equals(args[<span class="number">0</span>]);</span><br><span class="line">    } <span class="keyword">finally</span> {</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="keyword">null</span> &amp;&amp; !targetSource.isStatic()) {</span><br><span class="line">            targetSource.releaseTarget(target);</span><br><span class="line">        }</span><br><span class="line">   </span><br><span class="line">        <span class="keyword">if</span> (setProxyContext) {</span><br><span class="line">            AopContext.setCurrentProxy(oldProxy);</span><br><span class="line">        }</span><br><span class="line">   </span><br><span class="line">    }</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> var9;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>AOP &#x62E6;&#x622A;&#x5668;&#x94FE;&#x7684;&#x8C03;&#x7528;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">proceed</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.currentInterceptorIndex ==<span class="keyword">this</span>.interceptorsAndDynamicMethodMatchers.size() - <span class="number">1</span>) {</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.invokeJoinpoint();</span><br><span class="line"> } <span class="keyword">else</span> {</span><br><span class="line">            Object interceptorOrInterceptionAdvice = <span class="keyword">this</span>.interceptorsAndDynamicMethodMatchers.get(++<span class="keyword">this</span>.currentInterceptorIndex);</span><br><span class="line">            <span class="keyword">if</span> (interceptorOrInterceptionAdvice <span class="keyword">instanceof</span> InterceptorAndDynamicMethodMatcher) {</span><br><span class="line">                InterceptorAndDynamicMethodMatcher dm = (InterceptorAndDynamicMethodMatcher)interceptorOrInterceptionAdvice;</span><br><span class="line">                <span class="comment">//&#x5982;&#x679C;&#x901A;&#x77E5;&#x5668;&#x548C;&#x8C03;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x5339;&#x914D;&#xFF0C;&#x90A3;&#x4E48;&#x8C03;&#x7528;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x7684;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#xFF0C;&#x5426;&#x5219;&#x7EE7;&#x7EED;&#x5339;&#x914D;</span></span><br><span class="line">                <span class="keyword">return</span> dm.methodMatcher.matches(<span class="keyword">this</span>.method, <span class="keyword">this</span>.targetClass, <span class="keyword">this</span>.arguments) ? dm.interceptor.invoke(<span class="keyword">this</span>) : <span class="keyword">this</span>.proceed();</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">return</span> ((MethodInterceptor)interceptorOrInterceptionAdvice).invoke(<span class="keyword">this</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>&#x62E6;&#x622A;&#x5668;&#x94FE;&#x7684;&#x4EA7;&#x751F;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">initializeAdvisorChain</span><span class="params">()</span> <span class="keyword">throws</span> AopConfigException, BeansException </span>{</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.advisorChainInitialized) {</span><br><span class="line">            <span class="keyword">if</span> (!ObjectUtils.isEmpty(<span class="keyword">this</span>.interceptorNames)) {</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.beanFactory == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;No BeanFactory available anymore (probably due to serialization) - cannot resolve interceptor names &quot;</span> + Arrays.asList(<span class="keyword">this</span>.interceptorNames));</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.interceptorNames[<span class="keyword">this</span>.interceptorNames.length - <span class="number">1</span>].endsWith(<span class="string">&quot;*&quot;</span>) &amp;&amp; <span class="keyword">this</span>.targetName == <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.targetSource == EMPTY_TARGET_SOURCE) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">&quot;Target required after globals&quot;</span>);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                String[] var1 = <span class="keyword">this</span>.interceptorNames;</span><br><span class="line">                <span class="keyword">int</span> var2 = var1.length;</span><br><span class="line">                <span class="comment">//&#x8FD9;&#x91CC;&#x662F;&#x6DFB;&#x52A0;Advisor&#x94FE;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x662F;&#x901A;&#x8FC7;interceprotNames&#x5C5E;&#x6027;&#x8FDB;&#x884C;&#x8BBE;&#x7F6E;&#x7684;</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> var3 = <span class="number">0</span>; var3 &lt; var2; ++var3) {</span><br><span class="line">                    String name = var1[var3];</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isTraceEnabled()) {</span><br><span class="line">                        <span class="keyword">this</span>.logger.trace(<span class="string">&quot;Configuring advisor or advice &apos;&quot;</span> + name + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (name.endsWith(<span class="string">&quot;*&quot;</span>)) {</span><br><span class="line">                        <span class="keyword">if</span> (!(<span class="keyword">this</span>.beanFactory <span class="keyword">instanceof</span> ListableBeanFactory)) {</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> AopConfigException(<span class="string">&quot;Can only use global advisors or interceptors with a ListableBeanFactory&quot;</span>);</span><br><span class="line">                        }</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">this</span>.addGlobalAdvisor((ListableBeanFactory)<span class="keyword">this</span>.beanFactory, name.substring(<span class="number">0</span>, name.length() - <span class="string">&quot;*&quot;</span>.length()));</span><br><span class="line">                    } <span class="keyword">else</span> {</span><br><span class="line">                        Object advice;</span><br><span class="line">                        <span class="keyword">if</span> (!<span class="keyword">this</span>.singleton &amp;&amp; !<span class="keyword">this</span>.beanFactory.isSingleton(name)) {</span><br><span class="line">                            advice = <span class="keyword">new</span> ProxyFactoryBean.PrototypePlaceholderAdvisor(name);</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            <span class="comment">//&#x4ECE;IOC&#x5BB9;&#x5668;&#x4E2D;&#x83B7;&#x5F97;&#x901A;&#x77E5;&#x5668;&#x6216;&#x8005;&#x5207;&#x9762;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x5B9E;&#x73B0;&#x4E2D;&#x4E0D;&#x7BA1;&#x662F;&#x901A;&#x77E5;&#x5668;&#x8FD8;&#x662F;&#x5207;&#x9762;&#x90FD;&#x4F1A;&#x6700;&#x7EC8;</span></span><br><span class="line">                            <span class="comment">//&#x53D8;&#x6210;&#x901A;&#x77E5;&#x5668;Advisor</span></span><br><span class="line">                            advice = <span class="keyword">this</span>.beanFactory.getBean(name);</span><br><span class="line">                        }</span><br><span class="line">                        <span class="comment">//&#x6DFB;&#x52A0;&#x5230;&#x901A;&#x77E5;&#x5668;&#x4E2D;</span></span><br><span class="line">                        <span class="keyword">this</span>.addAdvisorOnChainCreation(advice, name);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">this</span>.advisorChainInitialized = <span class="keyword">true</span>;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8FD9;&#x4E2A;&#x5B8C;&#x6210;&#x4E86;&#x4ECE;&#x6240;&#x6709;&#x7684;&#x901A;&#x77E5;&#x5668;&#x4E2D;&#x5F97;&#x5230;&#x62E6;&#x622A;&#x5668;&#x94FE;</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">getInterceptorsAndDynamicInterceptionAdvice</span><span class="params">(Advised config, Method method, @Nullable Class&lt;?&gt; targetClass)</span> </span>{</span><br><span class="line">        List&lt;Object&gt; interceptorList = <span class="keyword">new</span> ArrayList(config.getAdvisors().length);</span><br><span class="line">        Class&lt;?&gt; actualClass = targetClass != <span class="keyword">null</span> ? targetClass : method.getDeclaringClass();</span><br><span class="line">        <span class="keyword">boolean</span> hasIntroductions = hasMatchingIntroductions(config, actualClass);</span><br><span class="line">        AdvisorAdapterRegistry registry = GlobalAdvisorAdapterRegistry.getInstance();</span><br><span class="line">    <span class="comment">//&#x4ECE;config&#x4E2D;&#x5F97;&#x5230;&#x5B9E;&#x73B0;&#x4ECE;xml&#x4E2D;&#x83B7;&#x5F97;&#x7684;&#x6240;&#x6709;&#x901A;&#x77E5;&#x5668;</span></span><br><span class="line">        Advisor[] var8 = config.getAdvisors();</span><br><span class="line">        <span class="keyword">int</span> var9 = var8.length;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> var10 = <span class="number">0</span>; var10 &lt; var9; ++var10) {</span><br><span class="line">            Advisor advisor = var8[var10];</span><br><span class="line">            <span class="comment">//&#x62E6;&#x622A;&#x5668;&#x94FE;</span></span><br><span class="line">            MethodInterceptor[] interceptors;</span><br><span class="line">            <span class="keyword">if</span> (advisor <span class="keyword">instanceof</span> PointcutAdvisor) {</span><br><span class="line">                PointcutAdvisor pointcutAdvisor = (PointcutAdvisor)advisor;</span><br><span class="line">                <span class="keyword">if</span> (config.isPreFiltered() || pointcutAdvisor.getPointcut().getClassFilter().matches(actualClass)) {</span><br><span class="line">                    <span class="comment">//&#x5168;&#x5C40;&#x7684;&#x6CE8;&#x518C;&#x5DE5;&#x5382;&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x901A;&#x77E5;&#x5668;&#x7684;&#x62E6;&#x622A;&#x5668;(&#x8FD9;&#x91CC;&#x662F;&#x540C;&#x6CE8;&#x518C;&#x5DE5;&#x5382;&#x91CC;&#x9762;&#x7684;&#x9002;&#x914D;&#x5668;&#x5C06;&#x6240;&#x6709;&#x7684;)</span></span><br><span class="line">                    <span class="comment">//advisor&#x53D8;&#x6210;&#x7279;&#x5B9A;&#x7C7B;&#x578B;&#x7684;&#x62E6;&#x622A;&#x5668;(MethodBeforeAdvice&#x3001;AfterReturningAdvice&#x7B49;&#x7B49;)</span></span><br><span class="line">                    interceptors = registry.getInterceptors(advisor);</span><br><span class="line">                    <span class="comment">//&#x5982;&#x679C;&#x7F16;&#x7801;&#x5B9E;&#x73B0;&#x901A;&#x77E5;&#x5668;&#xFF0C;&#x901A;&#x77E5;&#x5668;&#x4E2D;&#x4F1A;&#x5B9E;&#x73B0;&#x5207;&#x5165;&#x70B9;&#xFF0C;&#x53EA;&#x4E0D;&#x8FC7;&#x6211;&#x4EEC;&#x4E0D;&#x600E;&#x4E48;&#x4F7F;&#x7528;&#x786C;&#x7F16;&#x7801;&#x7684;&#x5F62;&#x5F0F;&#x5B9E;&#x73B0;</span></span><br><span class="line">                    <span class="comment">//&#x5207;&#x5165;&#x70B9;&#xFF0C;&#x6240;&#x4EE5;&#x4E0B;&#x9762;&#x518D;&#x68C0;&#x67E5;&#x662F;&#x5426;&#x65B9;&#x6CD5;&#x662F;&#x5426;&#x7B26;&#x5408;&#x5207;&#x5165;&#x70B9;</span></span><br><span class="line">                    MethodMatcher mm = pointcutAdvisor.getPointcut().getMethodMatcher();</span><br><span class="line">                    <span class="comment">//&#x4E0B;&#x9762;&#x662F;&#x5BF9;&#x6240;&#x6709;&#x7684;&#x62E6;&#x622A;&#x5668;&#x8FDB;&#x884C;&#x8FC7;&#x6EE4;&#xFF0C;&#x5269;&#x4E0B;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x62E6;&#x622A;&#x5668;</span></span><br><span class="line">                    <span class="keyword">if</span> (MethodMatchers.matches(mm, method, actualClass, hasIntroductions)) {</span><br><span class="line">                        <span class="keyword">if</span> (mm.isRuntime()) {</span><br><span class="line">                            MethodInterceptor[] var15 = interceptors;</span><br><span class="line">                            <span class="keyword">int</span> var16 = interceptors.length;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">for</span>(<span class="keyword">int</span> var17 = <span class="number">0</span>; var17 &lt; var16; ++var17) {</span><br><span class="line">                                MethodInterceptor interceptor = var15[var17];</span><br><span class="line">                                <span class="comment">//&#x5C06;&#x6240;&#x6709;&#x65B9;&#x6CD5;&#x52A0;&#x5165;&#x62E6;&#x622A;&#x5668;&#x94FE;</span></span><br><span class="line">                                interceptorList.add(<span class="keyword">new</span> InterceptorAndDynamicMethodMatcher(interceptor, mm));</span><br><span class="line">                            }</span><br><span class="line">                        } <span class="keyword">else</span> {</span><br><span class="line">                            interceptorList.addAll(Arrays.asList(interceptors));</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> <span class="keyword">if</span> (advisor <span class="keyword">instanceof</span> IntroductionAdvisor) {</span><br><span class="line">                IntroductionAdvisor ia = (IntroductionAdvisor)advisor;</span><br><span class="line">                <span class="keyword">if</span> (config.isPreFiltered() || ia.getClassFilter().matches(actualClass)) {</span><br><span class="line">                    interceptors = registry.getInterceptors(advisor);</span><br><span class="line">                    interceptorList.addAll(Arrays.asList(interceptors));</span><br><span class="line">                }</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                Interceptor[] interceptors = registry.getInterceptors(advisor);</span><br><span class="line">                interceptorList.addAll(Arrays.asList(interceptors));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> interceptorList;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>&#x65B9;&#x6CD5;&#x589E;&#x5F3A;&#x7684;&#x5B9E;&#x73B0;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x610F;&#x56FE;&#x662F;&#x501F;&#x52A9;DefaultAdvisorAdapterRegistry&#x7684;&#x9002;&#x914D;&#x5668;&#x5C06;&#x6240;&#x6709;&#x7684;Advisor&#x53D8;&#x6210;&#x7279;&#x5B9A;&#x7684;interceptor</span></span><br><span class="line"><span class="comment">//&#x65B9;&#x4FBF;&#x5728;&#x8C03;&#x7528;&#x62E6;&#x622A;&#x5668;&#x94FE;&#x65F6;&#x7684;&#x8C03;&#x7528;</span></span><br><span class="line"><span class="keyword">public</span> MethodInterceptor[] getInterceptors(Advisor advisor) <span class="keyword">throws</span> UnknownAdviceTypeException {</span><br><span class="line">        List&lt;MethodInterceptor&gt; interceptors = <span class="keyword">new</span> ArrayList(<span class="number">3</span>);</span><br><span class="line">        Advice advice = advisor.getAdvice();</span><br><span class="line">        <span class="keyword">if</span> (advice <span class="keyword">instanceof</span> MethodInterceptor) {</span><br><span class="line">            interceptors.add((MethodInterceptor)advice);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Iterator var4 = <span class="keyword">this</span>.adapters.iterator();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//&#x6839;&#x636E;&#x6240;&#x6709;&#x7684;&#x9002;&#x914D;&#x5668;&#x6765;&#x9002;&#x914D;&#x5F97;&#x5230;&#x62E6;&#x622A;&#x5668;</span></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) {</span><br><span class="line">            AdvisorAdapter adapter = (AdvisorAdapter)var4.next();</span><br><span class="line">            <span class="keyword">if</span> (adapter.supportsAdvice(advice)) {</span><br><span class="line">                interceptors.add(adapter.getInterceptor(advisor));</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (interceptors.isEmpty()) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UnknownAdviceTypeException(advisor.getAdvice());</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            <span class="keyword">return</span> (MethodInterceptor[])interceptors.toArray(<span class="keyword">new</span> MethodInterceptor[<span class="number">0</span>]);</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x6211;&#x4EEC;&#x5C31;&#x5206;&#x6790;&#x8FD9;&#x4E2A;adapter&#xFF0C;supportsAdvice&#x7528;&#x6765;&#x9002;&#x914D;&#x5224;&#x65AD;&#x80FD;&#x591F;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x9002;&#x914D;&#x5668;&#x6765;&#x5F97;&#x5230;&#x7279;&#x5B9A;&#x7684;&#x62E6;&#x622A;&#x5668;&#xFF1B;</span></span><br><span class="line"><span class="comment">//getInterceptor&#x5C31;&#x662F;&#x7528;&#x6765;&#x5F97;&#x5230;&#x7279;&#x5B9A;&#x7684;&#x62E6;&#x622A;&#x5668;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MethodBeforeAdviceAdapter</span> <span class="keyword">implements</span> <span class="title">AdvisorAdapter</span>, <span class="title">Serializable</span> </span>{</span><br><span class="line">    MethodBeforeAdviceAdapter() {</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsAdvice</span><span class="params">(Advice advice)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> advice <span class="keyword">instanceof</span> MethodBeforeAdvice;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MethodInterceptor <span class="title">getInterceptor</span><span class="params">(Advisor advisor)</span> </span>{</span><br><span class="line">        MethodBeforeAdvice advice = (MethodBeforeAdvice)advisor.getAdvice();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MethodBeforeAdviceInterceptor(advice);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x8FD9;&#x4E2A;&#x5C31;&#x662F;&#x4E00;&#x79CD;&#x62E6;&#x622A;&#x5668;&#xFF0C;&#x901A;&#x8FC7;invoke&#x65B9;&#x6CD5;&#xFF0C;&#x6211;&#x4EEC;&#x4E5F;&#x53EF;&#x4EE5;&#x77E5;&#x9053;&#xFF0C;&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x5728;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x4E4B;&#x524D;&#x5148;&#x6267;&#x884C;&#x4E86;&#x589E;&#x5F3A;&#x7684;&#x5185;&#x5BB9;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodBeforeAdviceInterceptor</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span>, <span class="title">Serializable</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> MethodBeforeAdvice advice;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MethodBeforeAdviceInterceptor</span><span class="params">(MethodBeforeAdvice advice)</span> </span>{</span><br><span class="line">        Assert.notNull(advice, <span class="string">&quot;Advice must not be null&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.advice = advice;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable </span>{</span><br><span class="line">        <span class="keyword">this</span>.advice.before(mi.getMethod(), mi.getArguments(), mi.getThis());</span><br><span class="line">        <span class="keyword">return</span> mi.proceed();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="&#x5927;&#x6982;&#x8BB2;&#x8FF0;&#x4E00;&#x4E2A;Spring-AOP&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;"><a href="#&#x5927;&#x6982;&#x8BB2;&#x8FF0;&#x4E00;&#x4E2A;Spring-AOP&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;" class="headerlink" title="&#x5927;&#x6982;&#x8BB2;&#x8FF0;&#x4E00;&#x4E2A;Spring AOP&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;"></a>&#x5927;&#x6982;&#x8BB2;&#x8FF0;&#x4E00;&#x4E2A;Spring AOP&#x5B9E;&#x73B0;&#x7684;&#x8FC7;&#x7A0B;</h4><ol>
<li>&#x9996;&#x5148;&#x6211;&#x4EEC;&#x4EE5;getObject()&#x4E3A;&#x7A81;&#x7834;&#x53E3;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x7684;&#x76EE;&#x7684;&#x662F;&#x4E3A;&#x4E86;&#x5F97;&#x5230;&#x4E00;&#x4E2A;AopProxy&#xFF0C;&#x6211;&#x8BA4;&#x4E3A;&#x8FD9;&#x4E2A;AopProxy&#x4F1A;&#x4F20;&#x7ED9;&#x52A8;&#x6001;&#x4EE3;&#x7406;&#x53C2;&#x6570;&#x6765;&#x589E;&#x5F3A;&#x51FD;&#x6570;&#xFF0C;&#x7136;&#x540E;&#x7528;&#x8FD9;&#x4E2A;&#x7C7B;&#x7684;&#x63A5;&#x53E3;&#x6765;&#x63A5;&#x53D7;&#x8FD9;&#x4E2A;&#x4EE3;&#x7406;&#x7C7B;&#xFF1B;getObject&#x65B9;&#x6CD5;&#x5728;&#x521B;&#x5EFA;&#x4EE3;&#x7406;&#x7C7B;&#x7684;&#x4E4B;&#x524D;&#x901A;&#x8FC7;initializeAdvisorChain&#x65B9;&#x6CD5;&#x5C06;&#x6240;&#x6709;&#x7684;&#x901A;&#x77E5;&#x5668;&#x6CE8;&#x518C;&#x5230;ProxyFactoryBean&#x7684;advisors&#x4E2D;</li>
<li>&#x7136;&#x540E;&#x5C31;&#x662F;&#x89E6;&#x53D1;&#x589E;&#x5F3A;&#x52A8;&#x80FD;&#x7684;AopProxy&#x7684;invoke&#x65B9;&#x6CD5;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x4ECE;&#x5168;&#x5C40;&#x7684;advisors&#x4E2D;&#x5339;&#x914D;&#x5F97;&#x5230;&#x6240;&#x6709;&#x6709;&#x5173;&#x8C03;&#x7528;&#x65B9;&#x6CD5;&#x7684;&#x62E6;&#x622A;&#x5668;&#xFF0C;invocation.proceed()&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x4F1A;&#x89E6;&#x53D1;&#x62E6;&#x622A;&#x5668;&#x7684;&#x8C03;&#x7528;&#xFF0C;&#x5728;&#x62E6;&#x622A;&#x5668;&#x8C03;&#x7528;&#x8FC7;&#x7A0B;&#x4E2D;&#x4F1A;&#x628A;&#x6240;&#x6709;&#x62E6;&#x622A;&#x5668;&#x8C03;&#x7528;&#x5B8C;&#xFF0C;&#x4E5F;&#x4F1A;&#x533A;&#x522B;&#x5B83;&#x4EEC;&#x7684;&#x5148;&#x540E;&#x5173;&#x7CFB;</li>
</ol>
<h3 id="&#x5173;&#x4E8E;Spring-MVC-&#x6E90;&#x7801;&#x8BE6;&#x89E3;"><a href="#&#x5173;&#x4E8E;Spring-MVC-&#x6E90;&#x7801;&#x8BE6;&#x89E3;" class="headerlink" title="&#x5173;&#x4E8E;Spring MVC &#x6E90;&#x7801;&#x8BE6;&#x89E3;"></a>&#x5173;&#x4E8E;Spring MVC &#x6E90;&#x7801;&#x8BE6;&#x89E3;</h3><h4 id="&#x5173;&#x4E8E;web-xml"><a href="#&#x5173;&#x4E8E;web-xml" class="headerlink" title="&#x5173;&#x4E8E;web.xml"></a>&#x5173;&#x4E8E;web.xml</h4><p>web.xml&#x5176;&#x5B9E;&#x662F;&#x5BF9;ServletContext&#x7684;&#x53C2;&#x6570;&#x8BBE;&#x7F6E;&#x4E5F;&#x5C31;&#x662F;Tomcat&#x7684;&#x73AF;&#x5883;&#x8BBE;&#x7F6E;&#xFF0C;&#x6211;&#x89C9;&#x5F97;&#x901A;&#x4FD7;&#x70B9;&#x8BB2;&#x5C31;&#x662F;&#x6240;&#x6709;Servlet&#x7684;&#x4E0A;&#x4E0B;&#x6587;&#x73AF;&#x5883;&#x7684;&#x8BBE;&#x7F6E;&#xFF0C;&#x5176;&#x5B9E;&#x5B83;&#x4E5F;&#x662F;Tomcat&#x548C;Spring&#x9879;&#x76EE;&#x7684;&#x8026;&#x5408;&#x70B9;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;Tomcat&#x542F;&#x52A8;&#x540E;&#x4F1A;&#x53BB;&#x52A0;&#x8F7D;&#x8FD9;&#x4E2A;&#x6587;&#x4EF6;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;&#xFF1B;&#x7136;&#x540E;&#x4E5F;&#x662F;&#x57FA;&#x4E8E;&#x6B64;&#x5185;&#x5BB9;Spring &#x4F1A;&#x53BB;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;WebApplicationContext&#x4E5F;&#x5C31;&#x662F;IOC&#x5BB9;&#x5668;&#xFF0C;&#x5728;&#x8FD9;&#x91CC;&#x5177;&#x4F53;&#x7684;&#x662F;XmlWebApplicationContext&#xFF0C;&#x4E0B;&#x9762;&#x4F1A;&#x5177;&#x4F53;&#x8BB2;&#x600E;&#x4E48;&#x521B;&#x5EFA;&#x7684;&#xFF0C;&#x4E5F;&#x57FA;&#x4E8E;&#x6B64;&#x5728;web.xml&#x4E2D;&#x6709;&#x4E0B;&#x9762;&#x7684;&#x4E00;&#x6BB5;&#x914D;&#x7F6E;&#xFF1A;</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span><span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>XmlWebApplicationContext &#x4F1A;&#x5C06;&#x5177;&#x4F53;&#x8DEF;&#x5F84;&#x7684;&#x914D;&#x7F6E;&#x52A0;&#x8F7D;&#x5230;IOC&#x5BB9;&#x5668;&#x4E2D;</p>
<h4 id="&#x5173;&#x4E8E;ContextLoaderListener"><a href="#&#x5173;&#x4E8E;ContextLoaderListener" class="headerlink" title="&#x5173;&#x4E8E;ContextLoaderListener"></a>&#x5173;&#x4E8E;ContextLoaderListener</h4><p>&#x8FD9;&#x4E2A;&#x662F;&#x5177;&#x4F53;Tomcat&#x548C;Spring&#x7684;&#x8026;&#x5408;&#x70B9;&#xFF0C;&#x901A;&#x8FC7;&#x8FD9;&#x4E2A;&#x76D1;&#x542C;&#x5668;Tomcat&#x5728;&#x542F;&#x52A8;&#x5B8C;&#x6210;&#x540E;&#x4F20;&#x9012;ServletContext&#x7ED9;Spring&#x7136;&#x540E;&#x5B8C;&#x6210;&#x4E00;&#x7CFB;&#x5217;Spring&#x9879;&#x76EE;&#x7684;&#x542F;&#x52A8;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ContextLoaderListener</span> <span class="keyword">extends</span> <span class="title">ContextLoader</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ContextLoaderListener</span><span class="params">()</span> </span>{</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ContextLoaderListener</span><span class="params">(WebApplicationContext context)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Tomat&#x4F1A;&#x5728;&#x542F;&#x52A8;&#x540E;&#x901A;&#x8FC7;&#x76D1;&#x542C;&#x5668;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent event)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.initWebApplicationContext(event.getServletContext());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent event)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.closeWebApplicationContext(event.getServletContext());</span><br><span class="line">        ContextCleanupListener.cleanupAttributes(event.getServletContext());</span><br><span class="line">    }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WebApplicationContext <span class="title">initWebApplicationContext</span><span class="params">(ServletContext servletContext)</span> </span>{</span><br><span class="line">        <span class="keyword">if</span> (servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE) != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Cannot initialize context because there is already a root application context present - check whether you have multiple ContextLoader* definitions in your web.xml!&quot;</span>);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            Log logger = LogFactory.getLog(ContextLoader.class);</span><br><span class="line">            servletContext.log(<span class="string">&quot;Initializing Spring root WebApplicationContext&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br><span class="line">                logger.info(<span class="string">&quot;Root WebApplicationContext: initialization started&quot;</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.context == <span class="keyword">null</span>) {</span><br><span class="line">                    <span class="comment">//ContextLoader&#x4F1A;&#x53BB;&#x8BFB;ContextLoader.properties&#x4E2D;&#x7684;Context&#x7684;&#x7C7B;&#x578B;&#x6765;&#x521B;&#x5EFA;&#x5177;&#x4F53;&#x662F;&#x4EC0;&#x4E48;</span></span><br><span class="line">                    <span class="comment">//Context</span></span><br><span class="line">                    <span class="keyword">this</span>.context = <span class="keyword">this</span>.createWebApplicationContext(servletContext);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.context <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) {</span><br><span class="line">                    ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext)<span class="keyword">this</span>.context;</span><br><span class="line">                    <span class="keyword">if</span> (!cwac.isActive()) {</span><br><span class="line">                        <span class="keyword">if</span> (cwac.getParent() == <span class="keyword">null</span>) {</span><br><span class="line">                            <span class="comment">//&#x8FD9;&#x91CC;&#x662F;NULL&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x8BF4;&#x7740;&#x4E2A;&#x5BB9;&#x5668;&#x5DF2;&#x7ECF;&#x662F;&#x9876;&#x7EA7;&#x5BB9;&#x5668;</span></span><br><span class="line">                            ApplicationContext parent = <span class="keyword">this</span>.loadParentContext(servletContext);</span><br><span class="line">                            cwac.setParent(parent);</span><br><span class="line">                        }</span><br><span class="line">                        <span class="comment">//&#x8BBE;&#x7F6E;&#x548C;&#x521D;&#x59CB;&#x5316;&#x8BE5;ROOT IOC &#x5BB9;&#x5668;</span></span><br><span class="line">                        <span class="keyword">this</span>.configureAndRefreshWebApplicationContext(cwac, servletContext);</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="keyword">this</span>.context);</span><br><span class="line">                ClassLoader ccl = Thread.currentThread().getContextClassLoader();</span><br><span class="line">                <span class="keyword">if</span> (ccl == ContextLoader.class.getClassLoader()) {</span><br><span class="line">                    currentContext = <span class="keyword">this</span>.context;</span><br><span class="line">                } <span class="keyword">else</span> <span class="keyword">if</span> (ccl != <span class="keyword">null</span>) {</span><br><span class="line">                    currentContextPerThread.put(ccl, <span class="keyword">this</span>.context);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) {</span><br><span class="line">                    logger.debug(<span class="string">&quot;Published root WebApplicationContext as ServletContext attribute with name [&quot;</span> + WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br><span class="line">                    <span class="keyword">long</span> elapsedTime = System.currentTimeMillis() - startTime;</span><br><span class="line">                    logger.info(<span class="string">&quot;Root WebApplicationContext: initialization completed in &quot;</span> + elapsedTime + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>.context;</span><br><span class="line">            } <span class="keyword">catch</span> (RuntimeException var8) {</span><br><span class="line">                logger.error(<span class="string">&quot;Context initialization failed&quot;</span>, var8);</span><br><span class="line">                servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, var8);</span><br><span class="line">                <span class="keyword">throw</span> var8;</span><br><span class="line">            } <span class="keyword">catch</span> (Error var9) {</span><br><span class="line">                logger.error(<span class="string">&quot;Context initialization failed&quot;</span>, var9);</span><br><span class="line">                servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, var9);</span><br><span class="line">                <span class="keyword">throw</span> var9;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureAndRefreshWebApplicationContext</span><span class="params">(ConfigurableWebApplicationContext wac, ServletContext sc)</span> </span>{</span><br><span class="line">     String configLocationParam;</span><br><span class="line">     <span class="keyword">if</span> (ObjectUtils.identityToString(wac).equals(wac.getId())) {</span><br><span class="line">         configLocationParam = sc.getInitParameter(<span class="string">&quot;contextId&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span> (configLocationParam != <span class="keyword">null</span>) {</span><br><span class="line">             wac.setId(configLocationParam);</span><br><span class="line">         } <span class="keyword">else</span> {</span><br><span class="line">             wac.setId(ConfigurableWebApplicationContext.APPLICATION_CONTEXT_ID_PREFIX + ObjectUtils.getDisplayString(sc.getContextPath()));</span><br><span class="line">         }</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     wac.setServletContext(sc);</span><br><span class="line">    <span class="comment">//&#x901A;&#x8FC7;ServletContext&#x8BFB;&#x53D6;web.xml&#x6587;&#x4EF6;&#x4E2D;&#x8BBE;&#x7F6E;&#x7684;contextConfigLocation&#x5E76;&#x628A;&#x5B83;&#x8D4B;&#x503C;&#x7ED9;wac</span></span><br><span class="line">    <span class="comment">//&#x65B9;&#x4FBF;&#x5728;&#x540E;IOC&#x5BB9;&#x5668;&#x7684;&#x52A0;&#x8F7D;</span></span><br><span class="line">     configLocationParam = sc.getInitParameter(<span class="string">&quot;contextConfigLocation&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (configLocationParam != <span class="keyword">null</span>) {</span><br><span class="line">         wac.setConfigLocation(configLocationParam);</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     ConfigurableEnvironment env = wac.getEnvironment();</span><br><span class="line">     <span class="keyword">if</span> (env <span class="keyword">instanceof</span> ConfigurableWebEnvironment) {</span><br><span class="line">         ((ConfigurableWebEnvironment)env).initPropertySources(sc, (ServletConfig)<span class="keyword">null</span>);</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">     <span class="keyword">this</span>.customizeContext(sc, wac);</span><br><span class="line">    <span class="comment">//IOC &#x5BB9;&#x5668;&#x542F;&#x52A8;&#x5566;</span></span><br><span class="line">     wac.refresh();</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="&#x5173;&#x4E8E;DispatchServlet"><a href="#&#x5173;&#x4E8E;DispatchServlet" class="headerlink" title="&#x5173;&#x4E8E;DispatchServlet"></a>&#x5173;&#x4E8E;DispatchServlet</h4><p>DispatchServlet&#x56E0;&#x4E3A;&#x5176;&#x81EA;&#x8EAB;&#x672C;&#x6765;&#x5C31;&#x662F;&#x4E00;&#x4E2A;Servlet&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x521D;&#x59CB;&#x5316;&#x7684;&#x5B8C;&#x6210;&#x65F6;&#x4F9D;&#x8D56;&#x4E8E;Servlet&#x7684;init&#x65B9;&#x6CD5;    </p>
<p>&#x4E0B;&#x9762;&#x5173;&#x4E8E;&#x5B83;&#x7684;&#x7EE7;&#x627F;&#x5173;&#x7CFB;&#x56FE;</p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fu63tj7rxyj20ob0do74r.jpg" alt=""></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>{</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) {</span><br><span class="line">            <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Initializing servlet &apos;&quot;</span> + <span class="keyword">this</span>.getServletName() + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        PropertyValues pvs = <span class="keyword">new</span> HttpServletBean.ServletConfigPropertyValues(<span class="keyword">this</span>.getServletConfig(), <span class="keyword">this</span>.requiredProperties);</span><br><span class="line">        <span class="keyword">if</span> (!pvs.isEmpty()) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(<span class="keyword">this</span>);</span><br><span class="line">                ResourceLoader resourceLoader = <span class="keyword">new</span> ServletContextResourceLoader(<span class="keyword">this</span>.getServletContext());</span><br><span class="line">                bw.registerCustomEditor(Resource.class, <span class="keyword">new</span> ResourceEditor(resourceLoader, <span class="keyword">this</span>.getEnvironment()));</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">this</span>.initBeanWrapper(bw);</span><br><span class="line">                bw.setPropertyValues(pvs, <span class="keyword">true</span>);</span><br><span class="line">            } <span class="keyword">catch</span> (BeansException var4) {</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isErrorEnabled()) {</span><br><span class="line">                    <span class="keyword">this</span>.logger.error(<span class="string">&quot;Failed to set bean properties on servlet &apos;&quot;</span> + <span class="keyword">this</span>.getServletName() + <span class="string">&quot;&apos;&quot;</span>, var4);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="keyword">throw</span> var4;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">//&#x521D;&#x59CB;&#x5316;FrameworkServlet&#x4E2D;&#x7684;&#x5C5E;&#x6027;&#xFF0C;&#x5176;&#x4E2D;&#x5C31;&#x521D;&#x59CB;&#x5316;&#x4E86;IOC&#x5BB9;&#x5668;</span></span><br><span class="line">        <span class="keyword">this</span>.initServletBean();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) {</span><br><span class="line">            <span class="keyword">this</span>.logger.debug(<span class="string">&quot;Servlet &apos;&quot;</span> + <span class="keyword">this</span>.getServletName() + <span class="string">&quot;&apos; configured successfully&quot;</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x5728;DispatchServlet&#x521D;&#x59CB;&#x5316;IOC&#x5BB9;&#x5668;&#x8FC7;&#x7A0B;&#x4E2D;&#x6709;&#x5B8C;&#x6210;&#x4E86;&#x5BF9;&#x57FA;&#x7840;&#x8BBE;&#x65BD;&#x7684;&#x521D;&#x59CB;&#x5316;  </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">(ApplicationContext context)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.initStrategies(context);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initStrategies</span><span class="params">(ApplicationContext context)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.initMultipartResolver(context);</span><br><span class="line">        <span class="keyword">this</span>.initLocaleResolver(context);</span><br><span class="line">        <span class="keyword">this</span>.initThemeResolver(context);</span><br><span class="line">        <span class="keyword">this</span>.initHandlerMappings(context);</span><br><span class="line">        <span class="keyword">this</span>.initHandlerAdapters(context);</span><br><span class="line">        <span class="keyword">this</span>.initHandlerExceptionResolvers(context);</span><br><span class="line">        <span class="keyword">this</span>.initRequestToViewNameTranslator(context);</span><br><span class="line">        <span class="keyword">this</span>.initViewResolvers(context);</span><br><span class="line">        <span class="keyword">this</span>.initFlashMapManager(context);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="&#x5206;&#x6790;Spring-Boot&#x542F;&#x52A8;&#x6E90;&#x7801;"><a href="#&#x5206;&#x6790;Spring-Boot&#x542F;&#x52A8;&#x6E90;&#x7801;" class="headerlink" title="&#x5206;&#x6790;Spring Boot&#x542F;&#x52A8;&#x6E90;&#x7801;"></a>&#x5206;&#x6790;Spring Boot&#x542F;&#x52A8;&#x6E90;&#x7801;</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>{</span><br><span class="line">    <span class="comment">//&#x7528;&#x6765;&#x76D1;&#x542C;&#x53EA;&#x80FD;&#x8FD0;&#x884C;&#x4E00;&#x4E2A;Spring boot</span></span><br><span class="line">    StopWatch stopWatch = <span class="keyword">new</span> StopWatch();</span><br><span class="line">    stopWatch.start();</span><br><span class="line">    ConfigurableApplicationContext context = <span class="keyword">null</span>;</span><br><span class="line">    Collection&lt;SpringBootExceptionReporter&gt; exceptionReporters = <span class="keyword">new</span> ArrayList();</span><br><span class="line">    <span class="keyword">this</span>.configureHeadlessProperty();</span><br><span class="line">    <span class="comment">//&#x8FD9;&#x4E2A;&#x662F;Spring Boot&#x4E13;&#x6709;&#x7684;&#x76D1;&#x542C;&#x5668;</span></span><br><span class="line">    SpringApplicationRunListeners listeners = <span class="keyword">this</span>.getRunListeners(args);</span><br><span class="line">    listeners.starting();</span><br><span class="line"></span><br><span class="line">    Collection exceptionReporters;</span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        ApplicationArguments applicationArguments = <span class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span class="line">        ConfigurableEnvironment environment = <span class="keyword">this</span>.prepareEnvironment(listeners, applicationArguments);</span><br><span class="line">        <span class="keyword">this</span>.configureIgnoreBeanInfo(environment);</span><br><span class="line">        Banner printedBanner = <span class="keyword">this</span>.printBanner(environment);</span><br><span class="line">        <span class="comment">//&#x521D;&#x59CB;&#x5316;IOC&#x5BB9;&#x5668;&#x5B9E;&#x4F8B;</span></span><br><span class="line">        context = <span class="keyword">this</span>.createApplicationContext();</span><br><span class="line">        exceptionReporters = <span class="keyword">this</span>.getSpringFactoriesInstances(SpringBootExceptionReporter.class, <span class="keyword">new</span> Class[]{ConfigurableApplicationContext.class}, context);</span><br><span class="line">        <span class="comment">//&#x8FD9;&#x91CC;&#x9762;&#x5B8C;&#x6210;&#x4E86;BeanDefinition&#x7684;&#x5B9A;&#x4F4D;&#x3001;&#x8F7D;&#x5165;&#x3001;&#x6CE8;&#x518C;</span></span><br><span class="line">        <span class="keyword">this</span>.prepareContext(context, environment, listeners, applicationArguments, printedBanner);</span><br><span class="line">        <span class="comment">//&#x8FDB;&#x884C;IOC&#x5BB9;&#x5668;&#x7684;&#x521D;&#x59CB;&#x5316;</span></span><br><span class="line">        <span class="keyword">this</span>.refreshContext(context);</span><br><span class="line">        <span class="keyword">this</span>.afterRefresh(context, applicationArguments);</span><br><span class="line">        stopWatch.stop();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logStartupInfo) {</span><br><span class="line">            (<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)).logStarted(<span class="keyword">this</span>.getApplicationLog(), stopWatch);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        listeners.started(context);</span><br><span class="line">        <span class="keyword">this</span>.callRunners(context, applicationArguments);</span><br><span class="line">    } <span class="keyword">catch</span> (Throwable var10) {</span><br><span class="line">        <span class="keyword">this</span>.handleRunFailure(context, var10, exceptionReporters, listeners);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var10);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        listeners.running(context);</span><br><span class="line">        <span class="keyword">return</span> context;</span><br><span class="line">    } <span class="keyword">catch</span> (Throwable var9) {</span><br><span class="line">        <span class="keyword">this</span>.handleRunFailure(context, var9, exceptionReporters, (SpringApplicationRunListeners)<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var9);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x6BD4;&#x8F83;&#x6709;&#x8DA3;&#xFF0C;&#x5728;&#x521D;&#x59CB;&#x5316;&#x5B8C;IOC&#x5BB9;&#x5668;&#x540E;&#xFF0C;&#x6CE8;&#x518C;&#x4E86;&#x4E00;&#x4E2A;&#x8FD9;&#x4E2A;&#x5E94;&#x7528;&#x7684;shutdownhook</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">refreshContext</span><span class="params">(ConfigurableApplicationContext context)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>.refresh(context);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.registerShutdownHook) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                context.registerShutdownHook();</span><br><span class="line">            } <span class="keyword">catch</span> (AccessControlException var3) {</span><br><span class="line">                ;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h4 id="Spring-&#x5185;&#x7F6E;Tomcat&#x542F;&#x52A8;&#x6E90;&#x7801;&#x89E3;&#x8BFB;"><a href="#Spring-&#x5185;&#x7F6E;Tomcat&#x542F;&#x52A8;&#x6E90;&#x7801;&#x89E3;&#x8BFB;" class="headerlink" title="Spring &#x5185;&#x7F6E;Tomcat&#x542F;&#x52A8;&#x6E90;&#x7801;&#x89E3;&#x8BFB;"></a>Spring &#x5185;&#x7F6E;Tomcat&#x542F;&#x52A8;&#x6E90;&#x7801;&#x89E3;&#x8BFB;</h4><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>.onRefresh();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> {</span><br><span class="line">        <span class="keyword">this</span>.createWebServer();</span><br><span class="line">    } <span class="keyword">catch</span> (Throwable var2) {</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Unable to start web server&quot;</span>, var2);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x9996;&#x5148;&#x5728;&#x521D;&#x59CB;&#x5316;IOC&#x5BB9;&#x5668;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x901A;&#x8FC7;onRefresh&#x65B9;&#x6CD5;&#xFF0C;&#x8C03;&#x7528;creatWebServer&#x521B;&#x5EFA;&#x6307;&#x5B9A;&#x7684;Web&#x5BB9;&#x5668;&#x5E76;&#x542F;&#x52A8;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createWebServer</span><span class="params">()</span> </span>{</span><br><span class="line">       WebServer webServer = <span class="keyword">this</span>.webServer;</span><br><span class="line">       ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">       <span class="keyword">if</span> (webServer == <span class="keyword">null</span> &amp;&amp; servletContext == <span class="keyword">null</span>) {</span><br><span class="line">           ServletWebServerFactory factory = <span class="keyword">this</span>.getWebServerFactory();</span><br><span class="line">           <span class="keyword">this</span>.webServer = factory.getWebServer(<span class="keyword">new</span> ServletContextInitializer[]{<span class="keyword">this</span>.getSelfInitializer()});</span><br><span class="line">       } <span class="keyword">else</span> <span class="keyword">if</span> (servletContext != <span class="keyword">null</span>) {</span><br><span class="line">           <span class="keyword">try</span> {</span><br><span class="line">               <span class="keyword">this</span>.getSelfInitializer().onStartup(servletContext);</span><br><span class="line">           } <span class="keyword">catch</span> (ServletException var4) {</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Cannot initialize servlet context&quot;</span>, var4);</span><br><span class="line">           }</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">       <span class="keyword">this</span>.initPropertySources();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> WebServer <span class="title">getWebServer</span><span class="params">(ServletContextInitializer... initializers)</span> </span>{</span><br><span class="line">       Tomcat tomcat = <span class="keyword">new</span> Tomcat();</span><br><span class="line">       File baseDir = <span class="keyword">this</span>.baseDirectory != <span class="keyword">null</span> ? <span class="keyword">this</span>.baseDirectory : <span class="keyword">this</span>.createTempDir(<span class="string">&quot;tomcat&quot;</span>);</span><br><span class="line">       tomcat.setBaseDir(baseDir.getAbsolutePath());</span><br><span class="line">       Connector connector = <span class="keyword">new</span> Connector(<span class="keyword">this</span>.protocol);</span><br><span class="line">       tomcat.getService().addConnector(connector);</span><br><span class="line">       <span class="keyword">this</span>.customizeConnector(connector);</span><br><span class="line">       tomcat.setConnector(connector);</span><br><span class="line">       tomcat.getHost().setAutoDeploy(<span class="keyword">false</span>);</span><br><span class="line">       <span class="keyword">this</span>.configureEngine(tomcat.getEngine());</span><br><span class="line">       Iterator var5 = <span class="keyword">this</span>.additionalTomcatConnectors.iterator();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span>(var5.hasNext()) {</span><br><span class="line">           Connector additionalConnector = (Connector)var5.next();</span><br><span class="line">           tomcat.getService().addConnector(additionalConnector);</span><br><span class="line">       }</span><br><span class="line"></span><br><span class="line">       <span class="keyword">this</span>.prepareContext(tomcat.getHost(), initializers);</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.getTomcatWebServer(tomcat);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> TomcatWebServer <span class="title">getTomcatWebServer</span><span class="params">(Tomcat tomcat)</span> </span>{</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> TomcatWebServer(tomcat, <span class="keyword">this</span>.getPort() &gt;= <span class="number">0</span>);</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">TomcatWebServer</span><span class="params">(Tomcat tomcat, <span class="keyword">boolean</span> autoStart)</span> </span>{</span><br><span class="line">       <span class="keyword">this</span>.monitor = <span class="keyword">new</span> Object();</span><br><span class="line">       <span class="keyword">this</span>.serviceConnectors = <span class="keyword">new</span> HashMap();</span><br><span class="line">       Assert.notNull(tomcat, <span class="string">&quot;Tomcat Server must not be null&quot;</span>);</span><br><span class="line">       <span class="keyword">this</span>.tomcat = tomcat;</span><br><span class="line">       <span class="keyword">this</span>.autoStart = autoStart;</span><br><span class="line">       <span class="keyword">this</span>.initialize();</span><br><span class="line">   }</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">throws</span> WebServerException </span>{</span><br><span class="line">       logger.info(<span class="string">&quot;Tomcat initialized with port(s): &quot;</span> + <span class="keyword">this</span>.getPortsDescription(<span class="keyword">false</span>));</span><br><span class="line">       Object var1 = <span class="keyword">this</span>.monitor;</span><br><span class="line">       <span class="keyword">synchronized</span>(<span class="keyword">this</span>.monitor) {</span><br><span class="line">           <span class="keyword">try</span> {</span><br><span class="line">               <span class="keyword">this</span>.addInstanceIdToEngineName();</span><br><span class="line">               Context context = <span class="keyword">this</span>.findContext();</span><br><span class="line">               context.addLifecycleListener((event) -&gt; {</span><br><span class="line">                   <span class="keyword">if</span> (context.equals(event.getSource()) &amp;&amp; <span class="string">&quot;start&quot;</span>.equals(event.getType())) {</span><br><span class="line">                       <span class="keyword">this</span>.removeServiceConnectors();</span><br><span class="line">                   }</span><br><span class="line"></span><br><span class="line">               });</span><br><span class="line">               <span class="keyword">this</span>.tomcat.start();</span><br><span class="line">               <span class="keyword">this</span>.rethrowDeferredStartupExceptions();</span><br><span class="line"></span><br><span class="line">               <span class="keyword">try</span> {</span><br><span class="line">                   ContextBindings.bindClassLoader(context, context.getNamingToken(), <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">               } <span class="keyword">catch</span> (NamingException var5) {</span><br><span class="line">                   ;</span><br><span class="line">               }</span><br><span class="line"></span><br><span class="line">               <span class="keyword">this</span>.startDaemonAwaitThread();</span><br><span class="line">           } <span class="keyword">catch</span> (Exception var6) {</span><br><span class="line">               <span class="keyword">this</span>.stopSilently();</span><br><span class="line">               <span class="keyword">throw</span> <span class="keyword">new</span> WebServerException(<span class="string">&quot;Unable to start embedded Tomcat&quot;</span>, var6);</span><br><span class="line">           }</span><br><span class="line"></span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>&#x901A;&#x8FC7;&#x4E0A;&#x9762;&#x4E00;&#x6B65;&#x4E00;&#x6B65;&#x6211;&#x4EEC;&#x5F88;&#x5BB9;&#x6613;&#x53D1;&#x73B0;Tomcat&#x662F;&#x600E;&#x4E48;&#x542F;&#x52A8;&#x7684;</p>
<h4 id="&#x5173;&#x4E8E;Tomcat&#x6E90;&#x7801;"><a href="#&#x5173;&#x4E8E;Tomcat&#x6E90;&#x7801;" class="headerlink" title="&#x5173;&#x4E8E;Tomcat&#x6E90;&#x7801;"></a>&#x5173;&#x4E8E;Tomcat&#x6E90;&#x7801;</h4><ul>
<li>omcat&#x7684;&#x67B6;&#x6784;&#x56FE;</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1ftwlh8jmi0j20h90brq3m.jpg" alt=""></p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1ftwlcws80xj20es09wt90.jpg" alt=""></p>
<p>Container&#x7684;&#x7EC4;&#x6210;</p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1ftxkshzdpvj21fc14wgmw.jpg" alt=""></p>
<ul>
<li><p>&#x4E00;&#x4E9B;&#x540D;&#x8BCD;</p>
<ol>
<li><p>Server&#xFF1A;&#x670D;&#x52A1;&#x5668;&#xFF0C;&#x4E00;&#x4E2A;Tomcat&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;Server&#xFF0C;&#x53EF;&#x4EE5;&#x770B;&#x505A;&#x5C31;&#x662F;Tomcat&#xFF0C;&#x7528;&#x4E8E;&#x63A7;&#x5236;Tomcat&#x7684;&#x751F;&#x547D;&#x5468;&#x671F;</p>
</li>
<li><p>Service&#xFF1A;&#x670D;&#x52A1;&#xFF0C;&#x6709;&#x4E86;Service&#x5C31;&#x53EF;&#x4EE5;&#x5BF9;&#x5916;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x4E86;&#xFF0C;&#x4E00;&#x4E2A;Server&#x53EF;&#x4EE5;&#x62E5;&#x6709;&#x591A;&#x4E2A;Service</p>
</li>
<li><p>Connector&#xFF1A;&#x8FDE;&#x63A5;&#x5668;&#xFF0C;&#x8868;&#x793A;&#x63A5;&#x53D7;&#x8BF7;&#x6C42;&#x7684;&#x7AEF;&#x70B9;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x56DE;&#x590D;&#xFF1B;Servlet&#x5BB9;&#x5668;&#x5904;&#x7406;&#x8BF7;&#x6C42;&#xFF0C;&#x662F;&#x9700;&#x8981;Connector&#x8FDB;&#x884C;&#x8C03;&#x5EA6;&#x548C;&#x63A7;&#x5236;&#x7684;&#xFF0C;Connector&#x662F;Tomcat&#x5904;&#x7406;&#x8BF7;&#x6C42;&#x7684;&#x4E3B;&#x5E72;&#xFF0C;&#x56E0;&#x6B64;Connector&#x7684;&#x914D;&#x7F6E;&#x548C;&#x4F7F;&#x7528;&#x5BF9;Tomcat&#x7684;&#x6027;&#x80FD;&#x6709;&#x7740;&#x91CD;&#x8981;&#x7684;&#x5F71;&#x54CD; </p>
</li>
<li><p>Engine&#xFF1A;&#x5F15;&#x64CE;&#xFF0C;Engine&#x4E0B;&#x53EF;&#x4EE5;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x865A;&#x62DF;&#x4E3B;&#x673A;Virtual Host&#xFF0C;&#x6BCF;&#x4E2A;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x90FD;&#x6709;&#x4E00;&#x4E2A;&#x57DF;&#x540D;&#xFF0C;&#x5F53;Engine&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5B83;&#x628A;&#x8BE5;&#x8BF7;&#x6C42;&#x5339;&#x914D;&#x5230;&#x67D0;&#x4E2A;Host&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8BE5;&#x8BF7;&#x6C42;&#x4EA4;&#x7ED9;&#x8BE5;Host&#x6765;&#x5904;&#x7406;&#xFF0C;Engine&#x6709;&#x4E00;&#x4E2A;&#x9ED8;&#x8BA4;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#xFF0C;&#x5F53;&#x8BF7;&#x6C42;&#x65E0;&#x6CD5;&#x5339;&#x914D;&#x5230;&#x4EFB;&#x4F55;&#x4E00;&#x4E2A;Host&#x4E0A;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5C06;&#x4EA4;&#x7ED9;&#x8BE5;&#x9ED8;&#x8BA4;Host&#x6765;&#x5904;&#x7406;</p>
</li>
<li><p>Host&#xFF1A;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#xFF0C;&#x6BCF;&#x4E2A;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x548C;&#x67D0;&#x4E2A;&#x7F51;&#x7EDC;&#x57DF;&#x540D;Domain Name&#x76F8;&#x5339;&#x914D; &#xFF0C;&#x6BCF;&#x4E2A;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x4E0B;&#x90FD;&#x53EF;&#x4EE5;&#x90E8;&#x7F72;(deploy)&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;Web App ,&#x6BCF;&#x4E2A;Web App&#x5BF9;&#x5E94;&#x4E8E;&#x4E00;&#x4E2A;Context&#xFF0C;&#x6709;&#x4E00;&#x4E2A;Context path&#xFF0C;&#x5F53;Host&#x83B7;&#x5F97;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;&#x628A;&#x8BE5;&#x8BF7;&#x6C42;&#x5339;&#x914D;&#x5230;&#x67D0;&#x4E2A;Context&#x4E0A;&#xFF0C;&#x7136;&#x540E;&#x628A;&#x8BE5;&#x8BF7;&#x6C42;&#x4EA4;&#x7ED9;&#x8BE5;Context&#x6765;&#x5904;&#x7406;&#xFF0C;&#x5339;&#x914D;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x201C;&#x6700;&#x957F;&#x5339;&#x914D;&#x201D;&#xFF0C;&#x6240;&#x4EE5;&#x4E00;&#x4E2A;path==&#x201D;&#x201D;&#x7684;Context&#x5C06;&#x6210;&#x4E3A;&#x8BE5;Host&#x7684;&#x9ED8;&#x8BA4;Context&#xFF0C;&#x6240;&#x6709;&#x65E0;&#x6CD5;&#x548C;&#x5176;&#x5B83;Context&#x7684;&#x8DEF;&#x5F84;&#x540D;&#x5339;&#x914D;&#x7684;&#x8BF7;&#x6C42;&#x90FD;&#x5C06;&#x6700;&#x7EC8;&#x548C;&#x8BE5;&#x9ED8;&#x8BA4;Context&#x5339;&#x914D; </p>
</li>
<li><p>Context &#xFF1A;&#x4E00;&#x4E2A;Context&#x5BF9;&#x5E94;&#x4E8E;&#x4E00;&#x4E2A;Web Application&#xFF0C;&#x4E00;&#x4E2A;Web Application&#x7531;&#x4E00;&#x4E2A;&#x6216;&#x8005;&#x591A;&#x4E2A;Servlet&#x7EC4;&#x6210;&#xFF0C;Context&#x5728;&#x521B;&#x5EFA;&#x7684;&#x65F6;&#x5019;&#x5C06;&#x6839;&#x636E;&#x914D;&#x7F6E;&#x6587;&#x4EF6;CATALINA_HOME/conf/web.xml&#x548C;WEBAPP_HOME/WEB-INF/web.xml&#x8F7D;&#x5165;Servlet&#x7C7B;&#xFF0C;&#x5F53;Context&#x83B7;&#x5F97;&#x8BF7;&#x6C42;&#x65F6;&#xFF0C;&#x5C06;&#x5728;&#x81EA;&#x5DF1;&#x7684;&#x6620;&#x5C04;&#x8868;(mapping table)&#x4E2D;&#x5BFB;&#x627E;&#x76F8;&#x5339;&#x914D;&#x7684;Servlet&#x7C7B;&#xFF0C;&#x5982;&#x679C;&#x627E;&#x5230;&#xFF0C;&#x5219;&#x6267;&#x884C;&#x8BE5;&#x7C7B;&#xFF0C;&#x83B7;&#x5F97;&#x8BF7;&#x6C42;&#x7684;&#x56DE;&#x5E94;&#xFF0C;&#x5E76;&#x8FD4;&#x56DE;&#x3002; &#x4E00;&#x4E2A;Host&#x53EF;&#x4EE5;&#x6709;&#x591A;&#x4E2A;Context&#xFF0C;&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x591A;&#x4E2A;Web Application&#xFF1B;&#x5176;&#x4E2D;TomcatEmbeddedContext&#x5C31;&#x76F8;&#x5F53;&#x4E8E;&#x8FD9;&#x4E2A;</p>
</li>
<li><p>Wrapper&#xFF1A;&#x6700;&#x5E95;&#x5C42;&#x7684;&#x5BB9;&#x5668;&#xFF0C;&#x662F;&#x5BF9; Servlet &#x7684;&#x5C01;&#x88C5;&#xFF0C;&#x8D1F;&#x8D23; Servlet &#x5B9E;&#x4F8B;&#x7684;&#x521B; &#x5EFA;&#x3001;&#x6267;&#x884C;&#x548C;&#x9500;&#x6BC1; </p>
<p>&#x9700;&#x8981;&#x6CE8;&#x610F;&#x7684;&#x662F;    Engine&#x3001;Host&#x3001;Context&#x3001;Wrapper&#x90FD;&#x662F;&#x5B9E;&#x73B0;Container&#x63A5;&#x53E3;&#x7684;&#x7C7B;&#xFF0C;&#x6240;&#x4EE5;&#x91CC;&#x9762;&#x7684;&#x7ED3;&#x6784;&#x5C31;&#x50CF;&#x7B2C;&#x4E09;&#x5F20;&#x56FE;&#x4E00;&#x6837;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;&#x5D4C;&#x5957;&#x4E00;&#x4E2A;&#x5BB9;&#x5668;</p>
</li>
</ol>
</li>
</ul>
<h4 id="Spring-Boot&#x6E90;&#x7801;&#x4E4B;&#x5185;&#x7F6E;Servlet&#x5BB9;&#x5668;"><a href="#Spring-Boot&#x6E90;&#x7801;&#x4E4B;&#x5185;&#x7F6E;Servlet&#x5BB9;&#x5668;" class="headerlink" title="Spring Boot&#x6E90;&#x7801;&#x4E4B;&#x5185;&#x7F6E;Servlet&#x5BB9;&#x5668;"></a>Spring Boot&#x6E90;&#x7801;&#x4E4B;&#x5185;&#x7F6E;Servlet&#x5BB9;&#x5668;</h4><p>&#x521B;&#x5EFA;WebServer&#x5E76;&#x4E14;&#x542F;&#x52A8;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onRefresh</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.onRefresh();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">this</span>.createWebServer();</span><br><span class="line">        } <span class="keyword">catch</span> (Throwable var2) {</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Unable to start web server&quot;</span>, var2);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">createWebServer</span><span class="params">()</span> </span>{</span><br><span class="line">        WebServer webServer = <span class="keyword">this</span>.webServer;</span><br><span class="line">        ServletContext servletContext = <span class="keyword">this</span>.getServletContext();</span><br><span class="line">        <span class="keyword">if</span> (webServer == <span class="keyword">null</span> &amp;&amp; servletContext == <span class="keyword">null</span>) {</span><br><span class="line">            ServletWebServerFactory factory = <span class="keyword">this</span>.getWebServerFactory();</span><br><span class="line">            <span class="comment">//&#x53C2;&#x6570;&#x662F;&#x4E00;&#x4E9B;ServletContextInitializer&#xFF0C;Servlet&#x5BB9;&#x5668;&#x542F;&#x52A8;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x904D;&#x5386;&#x8FD9;&#x4E9B;ServletContextInitializer&#xFF0C;&#x5E76;&#x8C03;&#x7528;onStartup&#x65B9;&#x6CD5;</span></span><br><span class="line">            <span class="keyword">this</span>.webServer = factory.getWebServer(<span class="keyword">new</span> ServletContextInitializer[]{<span class="keyword">this</span>.getSelfInitializer()});</span><br><span class="line">        } <span class="keyword">else</span> <span class="keyword">if</span> (servletContext != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">try</span> {</span><br><span class="line">                <span class="keyword">this</span>.getSelfInitializer().onStartup(servletContext);</span><br><span class="line">            } <span class="keyword">catch</span> (ServletException var4) {</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(<span class="string">&quot;Cannot initialize servlet context&quot;</span>, var4);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.initPropertySources();</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<p>ServletContextInitializer&#x7684;&#x5176;&#x4E2D;&#x4E00;&#x4E2A;&#x5177;&#x4F53;&#x5185;&#x5BB9;&#xFF0C;&#x76EE;&#x7684;&#x662F;&#x6DFB;&#x52A0;Servlet&#x3001;Filter&#x3001;Listener&#xFF0C;&#x5305;&#x62EC;&#x90A3;&#x4E9B;&#x81EA;&#x5B9A;&#x4E49;&#x7684;&#xFF0C;&#x5B83;&#x4EEC;&#x6700;&#x7EC8;&#x90FD;&#x4F1A;&#x901A;&#x8FC7;&#x9002;&#x914D;&#x5668;&#x53D8;&#x4E3A;ServletRegistrationBean</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">selfInitialize</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException </span>{</span><br><span class="line">        <span class="keyword">this</span>.prepareWebApplicationContext(servletContext);</span><br><span class="line">        <span class="comment">//&#x5F97;&#x5230; IOC&#x5BB9;&#x5668;</span></span><br><span class="line">        ConfigurableListableBeanFactory beanFactory = <span class="keyword">this</span>.getBeanFactory();</span><br><span class="line">        ServletWebServerApplicationContext.ExistingWebApplicationScopes existingScopes = <span class="keyword">new</span> ServletWebServerApplicationContext.ExistingWebApplicationScopes(beanFactory);</span><br><span class="line">        WebApplicationContextUtils.registerWebApplicationScopes(beanFactory, <span class="keyword">this</span>.getServletContext());</span><br><span class="line">        existingScopes.restore();</span><br><span class="line">        <span class="comment">//&#x5C06;ServletContext&#x6CE8;&#x518C;&#x5230;IOC&#x5BB9;&#x5668;</span></span><br><span class="line">        WebApplicationContextUtils.registerEnvironmentBeans(beanFactory, <span class="keyword">this</span>.getServletContext());</span><br><span class="line">        <span class="comment">//&#x5F97;&#x5230;ServletContextInitializerBean&#x904D;&#x5386;&#x5668;</span></span><br><span class="line">        Iterator var4 = <span class="keyword">this</span>.getServletContextInitializerBeans().iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) {</span><br><span class="line">            <span class="comment">//&#x904D;&#x5386;&#x6267;&#x884C;&#x6240;&#x6709;ServletContextInitializer</span></span><br><span class="line">            ServletContextInitializer beans = (ServletContextInitializer)var4.next();</span><br><span class="line">            beans.onStartup(servletContext);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//IOC&#x5BB9;&#x5668;&#x521D;&#x59CB;&#x5316;&#x8FC7;&#x7A0B;</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">finishRefresh</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>.finishRefresh();</span><br><span class="line">        WebServer webServer = <span class="keyword">this</span>.startWebServer();</span><br><span class="line">        <span class="keyword">if</span> (webServer != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.publishEvent(<span class="keyword">new</span> ServletWebServerInitializedEvent(webServer, <span class="keyword">this</span>));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">//&#x8FD9;&#x91CC;&#x7684;&#x542F;&#x52A8;WebServer&#x5176;&#x5B9E;&#x5C31;&#x662F;&#x6CE8;&#x518C;&#x6240;&#x6709;&#x7684;</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> WebServer <span class="title">startWebServer</span><span class="params">()</span> </span>{</span><br><span class="line">        WebServer webServer = <span class="keyword">this</span>.webServer;</span><br><span class="line">        <span class="keyword">if</span> (webServer != <span class="keyword">null</span>) {</span><br><span class="line">            webServer.start();</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> webServer;</span><br><span class="line">    }</span><br><span class="line"><span class="comment">//&#x8FD9;&#x91CC;&#x4EE5;Tomcat&#x542F;&#x52A8;&#x4E3A;&#x4F8B;</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> <span class="keyword">throws</span> WebServerException </span>{</span><br><span class="line">        Object var1 = <span class="keyword">this</span>.monitor;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.monitor) {</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.started) {</span><br><span class="line">                <span class="keyword">boolean</span> var10 = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    var10 = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">this</span>.addPreviouslyRemovedConnectors();</span><br><span class="line">                    Connector var2 = <span class="keyword">this</span>.tomcat.getConnector();</span><br><span class="line">                    <span class="keyword">if</span> (var2 != <span class="keyword">null</span> &amp;&amp; <span class="keyword">this</span>.autoStart) {</span><br><span class="line">                        <span class="keyword">this</span>.performDeferredLoadOnStartup();</span><br><span class="line">                    }</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">this</span>.checkThatConnectorsHaveStarted();</span><br><span class="line">                    <span class="keyword">this</span>.started = <span class="keyword">true</span>;</span><br><span class="line">                    logger.info(<span class="string">&quot;Tomcat started on port(s): &quot;</span> + <span class="keyword">this</span>.getPortsDescription(<span class="keyword">true</span>) + <span class="string">&quot; with context path &apos;&quot;</span> + <span class="keyword">this</span>.getContextPath() + <span class="string">&quot;&apos;&quot;</span>);</span><br><span class="line">                    var10 = <span class="keyword">false</span>;</span><br><span class="line">                } <span class="keyword">catch</span> (ConnectorStartFailedException var11) {</span><br><span class="line">                    <span class="keyword">this</span>.stopSilently();</span><br><span class="line">                    <span class="keyword">throw</span> var11;</span><br><span class="line">                } <span class="keyword">catch</span> (Exception var12) {</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> WebServerException(<span class="string">&quot;Unable to start embedded Tomcat server&quot;</span>, var12);</span><br><span class="line">                } <span class="keyword">finally</span> {</span><br><span class="line">                    <span class="keyword">if</span> (var10) {</span><br><span class="line">                        Context context = <span class="keyword">this</span>.findContext();</span><br><span class="line">                        ContextBindings.unbindClassLoader(context, context.getNamingToken(), <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                Context context = <span class="keyword">this</span>.findContext();</span><br><span class="line">                ContextBindings.unbindClassLoader(context, context.getNamingToken(), <span class="keyword">this</span>.getClass().getClassLoader());</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">performDeferredLoadOnStartup</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">//&#x5F97;&#x5230;&#x8BE5;&#x865A;&#x62DF;&#x4E3B;&#x673A;&#x4E0B;&#x7684;&#x6240;&#x6709;Context&#x4E5F;&#x5C31;&#x662F;WebApplication&#x4E0A;&#x4E0B;&#x6587;</span></span><br><span class="line">            Container[] var1 = <span class="keyword">this</span>.tomcat.getHost().findChildren();</span><br><span class="line">            <span class="keyword">int</span> var2 = var1.length;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> var3 = <span class="number">0</span>; var3 &lt; var2; ++var3) {</span><br><span class="line">                Container child = var1[var3];</span><br><span class="line">                <span class="keyword">if</span> (child <span class="keyword">instanceof</span> TomcatEmbeddedContext) {</span><br><span class="line">                    ((TomcatEmbeddedContext)child).deferredLoadOnStartup();</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">        } <span class="keyword">catch</span> (Exception var5) {</span><br><span class="line">            logger.error(<span class="string">&quot;Cannot start connector: &quot;</span>, var5);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> WebServerException(<span class="string">&quot;Unable to start embedded Tomcat connectors&quot;</span>, var5);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deferredLoadOnStartup</span><span class="params">()</span> </span>{</span><br><span class="line">        ClassLoader classLoader = <span class="keyword">this</span>.getLoader().getClassLoader();</span><br><span class="line">        ClassLoader existingLoader = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (classLoader != <span class="keyword">null</span>) {</span><br><span class="line">            existingLoader = ClassUtils.overrideThreadContextClassLoader(classLoader);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.overrideLoadOnStart) {</span><br><span class="line">            <span class="comment">//&#x52A0;&#x8F7D;&#x8BE5;&#x4E0A;&#x4E0B;&#x6587;&#x4E0B;&#x7684;&#x6240;&#x6709;Servlet</span></span><br><span class="line">            <span class="keyword">super</span>.loadOnStartup(<span class="keyword">this</span>.findChildren());</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (existingLoader != <span class="keyword">null</span>) {</span><br><span class="line">            ClassUtils.overrideThreadContextClassLoader(existingLoader);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">loadOnStartup</span><span class="params">(Container[] children)</span> </span>{</span><br><span class="line">        TreeMap&lt;Integer, ArrayList&lt;Wrapper&gt;&gt; map = <span class="keyword">new</span> TreeMap();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; children.length; ++i) {</span><br><span class="line">            Wrapper wrapper = (Wrapper)children[i];</span><br><span class="line">            <span class="keyword">int</span> loadOnStartup = wrapper.getLoadOnStartup();</span><br><span class="line">            <span class="keyword">if</span> (loadOnStartup &gt;= <span class="number">0</span>) {</span><br><span class="line">                Integer key = loadOnStartup;</span><br><span class="line">                ArrayList&lt;Wrapper&gt; list = (ArrayList)map.get(key);</span><br><span class="line">                <span class="keyword">if</span> (list == <span class="keyword">null</span>) {</span><br><span class="line">                    list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">                    map.put(key, list);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                list.add(wrapper);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Iterator i$ = map.values().iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(i$.hasNext()) {</span><br><span class="line">            ArrayList&lt;Wrapper&gt; list = (ArrayList)i$.next();</span><br><span class="line">            Iterator i$ = list.iterator();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(i$.hasNext()) {</span><br><span class="line">                Wrapper wrapper = (Wrapper)i$.next();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> {</span><br><span class="line">                    wrapper.load();</span><br><span class="line">                } <span class="keyword">catch</span> (ServletException var8) {</span><br><span class="line">                    <span class="keyword">this</span>.getLogger().error(sm.getString(<span class="string">&quot;standardContext.loadOnStartup.loadException&quot;</span>, <span class="keyword">new</span> Object[]{<span class="keyword">this</span>.getName(), wrapper.getName()}), StandardWrapper.getRootCause(var8));</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">this</span>.getComputedFailCtxIfServletStartFails()) {</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    }</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="&#x5173;&#x4E8E;Spring-AplicationContextEvent"><a href="#&#x5173;&#x4E8E;Spring-AplicationContextEvent" class="headerlink" title="&#x5173;&#x4E8E;Spring AplicationContextEvent"></a>&#x5173;&#x4E8E;Spring AplicationContextEvent</h3><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AbstractApplicationContext&#x4E0B;&#x7684;</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">publishEvent</span><span class="params">(Object event, @Nullable ResolvableType eventType)</span> </span>{</span><br><span class="line">        Assert.notNull(event, <span class="string">&quot;Event must not be null&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isTraceEnabled()) {</span><br><span class="line">            <span class="keyword">this</span>.logger.trace(<span class="string">&quot;Publishing event in &quot;</span> + <span class="keyword">this</span>.getDisplayName() + <span class="string">&quot;: &quot;</span> + event);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        Object applicationEvent;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationEvent) {</span><br><span class="line">            applicationEvent = (ApplicationEvent)event;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            applicationEvent = <span class="keyword">new</span> PayloadApplicationEvent(<span class="keyword">this</span>, event);</span><br><span class="line">            <span class="keyword">if</span> (eventType == <span class="keyword">null</span>) {</span><br><span class="line">                eventType = ((PayloadApplicationEvent)applicationEvent).getResolvableType();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">     <span class="comment">//&#x5982;&#x679C;&#x6709;&#x4E8B;&#x4EF6;&#x6CA1;&#x6709;&#x5904;&#x7406;&#x5B8C;&#xFF0C;&#x5C31;&#x52A0;&#x5165;earlyApplicationEvents&#x91CC;&#x9762;&#x7B49;&#x5F85;&#x88AB;&#x5904;&#x7406;</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.earlyApplicationEvents != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">this</span>.earlyApplicationEvents.add(applicationEvent);</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">           <span class="comment">//&#x771F;&#x6B63;&#x5F00;&#x59CB;&#x5904;&#x7406;&#x4E8B;&#x4EF6;</span></span><br><span class="line">           <span class="keyword">this</span>.getApplicationEventMulticaster().multicastEvent((ApplicationEvent)applicationEvent, eventType);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.parent != <span class="keyword">null</span>) {</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.parent <span class="keyword">instanceof</span> AbstractApplicationContext) {</span><br><span class="line">                ((AbstractApplicationContext)<span class="keyword">this</span>.parent).publishEvent(event, eventType);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">this</span>.parent.publishEvent(event);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"><span class="comment">//SimpleApplicationEventMulticaster</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">multicastEvent</span><span class="params">(ApplicationEvent event, @Nullable ResolvableType eventType)</span> </span>{</span><br><span class="line">        ResolvableType type = eventType != <span class="keyword">null</span> ? eventType : <span class="keyword">this</span>.resolveDefaultEventType(event);</span><br><span class="line">       <span class="comment">//&#x8FD9;&#x91CC;&#x53D6;&#x5F97;&#x4E86;&#x6240;&#x6709;&#x6CE8;&#x518C;&#x7684;&#x76F8;&#x5173;&#x7C7B;&#x578B;&#x7684;&#x4E8B;&#x4EF6;&#xFF0C;&#x81F3;&#x4E8E;&#x600E;&#x4E48;&#x5F97;&#x5230;&#x7684;&#xFF0C;&#x6211;&#x8FD9;&#x91CC;&#x7B80;&#x5355;&#x7684;&#x8BF4;&#x4E00;&#x4E0B;&#xFF1B;AbstractApplicationEventMulticaster.ListenerRetriever &#x8FD9;&#x4E2A;&#x7C7B;&#x5C31;&#x662F;&#x4E13;&#x95E8;&#x7528;&#x4E8E;&#x5B58;&#x50A8;&#x6240;&#x6709;&#x7684;&#x76D1;&#x542C;&#x5668;&#x7684;&#xFF0C;&#x800C;&#x4E14;&#x5728;AbstractApplicationEventMulticaster&#x8FD9;&#x4E2A;&#x7C7B;&#x4E0B;&#x4F1A;&#x7F13;&#x5B58;&#x6700;&#x8FD1;&#x53D6;&#x7684;&#x76F8;&#x5173;key&#x7684;&#x6240;&#x6709;&#x76D1;&#x542C;&#x5668;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x53EF;&#x4EE5;&#x4ECE;&#x8FD9;&#x4E2A;&#x7C7B;&#x91CC;&#x9762;&#x5F97;&#x5230;&#x76D1;&#x542C;&#x5668;&#x4E86;</span></span><br><span class="line">        Iterator var4 = <span class="keyword">this</span>.getApplicationListeners(event, type).iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var4.hasNext()) {</span><br><span class="line">            ApplicationListener&lt;?&gt; listener = (ApplicationListener)var4.next();</span><br><span class="line">            <span class="comment">//&#x5982;&#x679C;&#x6709;&#x7EBF;&#x7A0B;&#x6C60;&#xFF0C;&#x4F7F;&#x7528;&#x7EBF;&#x7A0B;&#x6C60;&#x5B8C;&#x6210;&#x6240;&#x6709;&#x7684;&#x76D1;&#x542C;&#x5668;&#x91CC;&#x9762;&#x7684;&#x5185;&#x5BB9;</span></span><br><span class="line">            Executor executor = <span class="keyword">this</span>.getTaskExecutor();</span><br><span class="line">            <span class="keyword">if</span> (executor != <span class="keyword">null</span>) {</span><br><span class="line">                executor.execute(() -&gt; {</span><br><span class="line">                    <span class="keyword">this</span>.invokeListener(listener, event);</span><br><span class="line">                });</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">this</span>.invokeListener(listener, event);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>
<h3 id="&#x76F8;&#x5173;&#x9762;&#x8BD5;&#x9898;"><a href="#&#x76F8;&#x5173;&#x9762;&#x8BD5;&#x9898;" class="headerlink" title="&#x76F8;&#x5173;&#x9762;&#x8BD5;&#x9898;"></a>&#x76F8;&#x5173;&#x9762;&#x8BD5;&#x9898;</h3><p><a href="http://www.importnew.com/15851.html#ioc_di" target="_blank" rel="noopener">http://www.importnew.com/15851.html#ioc_di</a></p>
<h4 id="&#x5176;&#x4E2D;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x7684;&#x7C7B;"><a href="#&#x5176;&#x4E2D;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x7684;&#x7C7B;" class="headerlink" title="&#x5176;&#x4E2D;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x7684;&#x7C7B;"></a>&#x5176;&#x4E2D;&#x503C;&#x5F97;&#x5B66;&#x4E60;&#x7684;&#x7C7B;</h4><ul>
<li><p>ResolveableType</p>
<p>&#x8FD9;&#x4E2A;&#x7C7B;&#x662F;&#x4E3A;&#x4E86;&#x89E3;&#x51B3;&#x83B7;&#x53D6;&#x6CDB;&#x578B;&#x5B9E;&#x9645;&#x7C7B;&#x578B;</p>
<p><a href="http://jinnianshilongnian.iteye.com/blog/1993608" target="_blank" rel="noopener">&#x8FD9;&#x91CC;&#x5177;&#x4F53;&#x4F7F;&#x7528;&#x65B9;&#x6CD5;</a></p>
</li>
</ul>
<h3 id="&#x76F8;&#x5173;&#x94FE;&#x63A5;"><a href="#&#x76F8;&#x5173;&#x94FE;&#x63A5;" class="headerlink" title="&#x76F8;&#x5173;&#x94FE;&#x63A5;"></a>&#x76F8;&#x5173;&#x94FE;&#x63A5;</h3><ul>
<li><p>Spring Boot&#x6E90;&#x7801;&#x5206;&#x6790;</p>
<p><a href="https://fangjian0423.github.io/2017/05/22/springboot-embedded-servlet-container/" target="_blank" rel="noopener">https://fangjian0423.github.io/2017/05/22/springboot-embedded-servlet-container/</a></p>
</li>
<li><p>Tomcat</p>
<p><a href="https://juejin.im/post/5af27c34f265da0b78687e14" target="_blank" rel="noopener">https://juejin.im/post/5af27c34f265da0b78687e14</a></p>
<p><a href="http://www.importnew.com/27309.html" target="_blank" rel="noopener">http://www.importnew.com/27309.html</a></p>
<p><a href="https://juejin.im/post/58eb5fdda0bb9f00692a78fc" target="_blank" rel="noopener">https://juejin.im/post/58eb5fdda0bb9f00692a78fc</a></p>
</li>
</ul>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/18/reading/关于java8 实战/" rel="next" title="">
                <i class="fa fa-chevron-left"></i> 
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/05/reading/高性能Mysql知识点总结/" rel="prev" title="">
                 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="May">
            
              <p class="site-author-name" itemprop="name">May</p>
              <p class="site-description motion-element" itemprop="description">既然选择了远方，便只顾风雨兼程。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-IOC"><span class="nav-number">1.</span> <span class="nav-text">Spring IOC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-IOC概述"><span class="nav-number">1.1.</span> <span class="nav-text">Spring IOC概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GenericApplicationContext的类图"><span class="nav-number">1.2.</span> <span class="nav-text">GenericApplicationContext的类图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IOC容器的初始化过程"><span class="nav-number">1.3.</span> <span class="nav-text">IOC容器的初始化过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#IOC容器的依赖注入"><span class="nav-number">1.4.</span> <span class="nav-text">IOC容器的依赖注入</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#容器相关特性的设计与实现"><span class="nav-number">1.5.</span> <span class="nav-text">容器相关特性的设计与实现</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ApplicationContext和Bean的初始化和销毁"><span class="nav-number">1.5.1.</span> <span class="nav-text">ApplicationContext和Bean的初始化和销毁</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#lazy-init属性和预实例化"><span class="nav-number">1.5.2.</span> <span class="nav-text">lazy-init属性和预实例化</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#FactoryBean的实现"><span class="nav-number">1.5.3.</span> <span class="nav-text">FactoryBean的实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#BeanPostProcessor的实现"><span class="nav-number">1.5.4.</span> <span class="nav-text">BeanPostProcessor的实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#autowiring-的实现"><span class="nav-number">1.5.5.</span> <span class="nav-text">autowiring 的实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Bean对IOC容器的感知"><span class="nav-number">1.5.6.</span> <span class="nav-text">Bean对IOC容器的感知</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-AOP"><span class="nav-number">2.</span> <span class="nav-text">Spring AOP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-AOP-概述"><span class="nav-number">2.1.</span> <span class="nav-text">Spring AOP 概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#增强对象功能的过程"><span class="nav-number">2.2.</span> <span class="nav-text">增强对象功能的过程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#大概讲述一个Spring-AOP实现的过程"><span class="nav-number">2.3.</span> <span class="nav-text">大概讲述一个Spring AOP实现的过程</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于Spring-MVC-源码详解"><span class="nav-number">3.</span> <span class="nav-text">关于Spring MVC 源码详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#关于web-xml"><span class="nav-number">3.1.</span> <span class="nav-text">关于web.xml</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于ContextLoaderListener"><span class="nav-number">3.2.</span> <span class="nav-text">关于ContextLoaderListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于DispatchServlet"><span class="nav-number">3.3.</span> <span class="nav-text">关于DispatchServlet</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分析Spring-Boot启动源码"><span class="nav-number">4.</span> <span class="nav-text">分析Spring Boot启动源码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-内置Tomcat启动源码解读"><span class="nav-number">4.1.</span> <span class="nav-text">Spring 内置Tomcat启动源码解读</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#关于Tomcat源码"><span class="nav-number">4.2.</span> <span class="nav-text">关于Tomcat源码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Spring-Boot源码之内置Servlet容器"><span class="nav-number">4.3.</span> <span class="nav-text">Spring Boot源码之内置Servlet容器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于Spring-AplicationContextEvent"><span class="nav-number">5.</span> <span class="nav-text">关于Spring AplicationContextEvent</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#相关面试题"><span class="nav-number">6.</span> <span class="nav-text">相关面试题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#其中值得学习的类"><span class="nav-number">6.1.</span> <span class="nav-text">其中值得学习的类</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#相关链接"><span class="nav-number">7.</span> <span class="nav-text">相关链接</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        	<div class="copyright"> &copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">May</span>

  

  
</div>












        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
