<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="&amp;#x56E0;&amp;#x4E3A;&amp;#x9700;&amp;#x8981;&amp;#x7528;&amp;#x5230;Java Nio&amp;#xFF0C;&amp;#x53C8;&amp;#x8BB0;&amp;#x5F97;&amp;#x81EA;&amp;#x5DF1;&amp;#x5199;&amp;#x8FC7;&amp;#x5173;&amp;#x4E8E;&amp;#x5176;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;">
<meta name="keywords" content="java">
<meta property="og:type" content="article">
<meta property="og:title" content="nio">
<meta property="og:url" content="https://github.com/MayYJ/hexo/2018/05/05/java/java nio/index.html">
<meta property="og:site_name" content="May&#39;s Blog">
<meta property="og:description" content="&amp;#x56E0;&amp;#x4E3A;&amp;#x9700;&amp;#x8981;&amp;#x7528;&amp;#x5230;Java Nio&amp;#xFF0C;&amp;#x53C8;&amp;#x8BB0;&amp;#x5F97;&amp;#x81EA;&amp;#x5DF1;&amp;#x5199;&amp;#x8FC7;&amp;#x5173;&amp;#x4E8E;&amp;#x5176;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj4idh0aj20fw0903zx.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj6q9kiqj20fc097t8n.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj8sj22xj20gr099aa4.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj7yfa1jj20gx092t8q.jpg">
<meta property="og:image" content="http://www.godpan.me/media/images/2017/11/java-nio.png">
<meta property="og:image" content="http://tutorials.jenkov.com/images/java-nio/buffers-modes.png">
<meta property="og:updated_time" content="2018-10-31T12:00:26.339Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nio">
<meta name="twitter:description" content="&amp;#x56E0;&amp;#x4E3A;&amp;#x9700;&amp;#x8981;&amp;#x7528;&amp;#x5230;Java Nio&amp;#xFF0C;&amp;#x53C8;&amp;#x8BB0;&amp;#x5F97;&amp;#x81EA;&amp;#x5DF1;&amp;#x5199;&amp;#x8FC7;&amp;#x5173;&amp;#x4E8E;&amp;#x5176;&amp;#x7684;&amp;#x535A;&amp;#x5BA2;&amp;#xFF0C;&amp;#x6240;&amp;#x4EE5;&amp;#x5C31;">
<meta name="twitter:image" content="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj4idh0aj20fw0903zx.jpg">






  <link rel="canonical" href="https://github.com/MayYJ/hexo/2018/05/05/java/java nio/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>nio | May's Blog</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">May's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">既然选择了远方，便只顾风雨兼程。</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://github.com/MayYJ/hexo/2018/05/05/java/java nio/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="May">
      <meta itemprop="description" content="既然选择了远方，便只顾风雨兼程。">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="May's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">nio
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-05 17:41:16" itemprop="dateCreated datePublished" datetime="2018-05-05T17:41:16+08:00">2018-05-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-10-31 20:00:26" itemprop="dateModified" datetime="2018-10-31T20:00:26+08:00">2018-10-31</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>&#x56E0;&#x4E3A;&#x9700;&#x8981;&#x7528;&#x5230;Java Nio&#xFF0C;&#x53C8;&#x8BB0;&#x5F97;&#x81EA;&#x5DF1;&#x5199;&#x8FC7;&#x5173;&#x4E8E;&#x5176;&#x7684;&#x535A;&#x5BA2;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x62FF;&#x51FA;&#x6765;&#x770B;&#x4E86;&#x4E00;&#x904D;&#xFF0C;&#x4F46;&#x662F;&#x53D1;&#x73B0;&#x5176;&#x5173;&#x4E8E;&#x5B9E;&#x73B0;&#x7EC6;&#x8282;&#x65B9;&#x9762;&#x6709;&#x4E00;&#x4E9B;&#x7B3C;&#x7EDF;&#xFF0C;&#x6240;&#x4EE5;&#x53C8;&#x5BF9;&#x5176;&#x8FDB;&#x884C;&#x6269;&#x5145;</p>
<h4 id="IO&#x6A21;&#x5F0F;"><a href="#IO&#x6A21;&#x5F0F;" class="headerlink" title="IO&#x6A21;&#x5F0F;"></a>IO&#x6A21;&#x5F0F;</h4><h5 id="&#x540C;&#x6B65;IO"><a href="#&#x540C;&#x6B65;IO" class="headerlink" title="&#x540C;&#x6B65;IO"></a>&#x540C;&#x6B65;IO</h5><p>&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x53D1;&#x8D77;read&#x64CD;&#x4F5C;&#x4E4B;&#x540E;&#xFF0C;&#x7ACB;&#x523B;&#x5C31;&#x53EF;&#x4EE5;&#x5F00;&#x59CB;&#x53BB;&#x505A;&#x5176;&#x5B83;&#x7684;&#x4E8B;&#x3002;&#x800C;&#x53E6;&#x4E00;&#x65B9;&#x9762;&#xFF0C;&#x4ECE;kernel&#x7684;&#x89D2;&#x5EA6;&#xFF0C;&#x5F53;&#x5B83;&#x53D7;&#x5230;&#x4E00;&#x4E2A;asynchronous read&#x4E4B;&#x540E;&#xFF0C;&#x9996;&#x5148;&#x5B83;&#x4F1A;&#x7ACB;&#x523B;&#x8FD4;&#x56DE;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x4F1A;&#x5BF9;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x4EA7;&#x751F;&#x4EFB;&#x4F55;block&#x3002;&#x7136;&#x540E;&#xFF0C;kernel&#x4F1A;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x51C6;&#x5907;&#x5B8C;&#x6210;&#xFF0C;&#x7136;&#x540E;&#x5C06;&#x6570;&#x636E;&#x62F7;&#x8D1D;&#x5230;&#x7528;&#x6237;&#x5185;&#x5B58;&#xFF0C;&#x5F53;&#x8FD9;&#x4E00;&#x5207;&#x90FD;&#x5B8C;&#x6210;&#x4E4B;&#x540E;&#xFF0C;kernel&#x4F1A;&#x7ED9;&#x7528;&#x6237;&#x8FDB;&#x7A0B;&#x53D1;&#x9001;&#x4E00;&#x4E2A;signal&#xFF0C;&#x544A;&#x8BC9;&#x5B83;read&#x64CD;&#x4F5C;&#x5B8C;&#x6210;&#x4E86;&#x3002; </p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj4idh0aj20fw0903zx.jpg" alt=""></p>
<h5 id="&#x963B;&#x585E;&#x548C;&#x975E;&#x963B;&#x585E;"><a href="#&#x963B;&#x585E;&#x548C;&#x975E;&#x963B;&#x585E;" class="headerlink" title="&#x963B;&#x585E;&#x548C;&#x975E;&#x963B;&#x585E;"></a>&#x963B;&#x585E;&#x548C;&#x975E;&#x963B;&#x585E;</h5><ul>
<li><p>&#x963B;&#x585E;</p>
<p>&#x5728;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x5C31;&#x7EEA;&#x548C;&#x590D;&#x5236;&#x6570;&#x636E;&#x9636;&#x6BB5;&#x5747;&#x963B;&#x585E;&#x3002; </p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj6q9kiqj20fc097t8n.jpg" alt=""></p>
</li>
<li><p>&#x975E;&#x963B;&#x585E;</p>
<p>&#x5728;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x5C31;&#x7EEA;&#x9636;&#x6BB5;&#xFF0C;&#x5982;&#x679C;&#x6570;&#x636E;&#x672A;&#x5C31;&#x7EEA; read &#x4F1A;&#x7ACB;&#x523B;&#x8FD4;&#x56DE; error&#xFF0C;&#x4E0D;&#x963B;&#x585E;&#xFF1B;&#x7528;&#x6237;&#x9700;&#x8981;&#x8F6E;&#x8BE2;&#x4EE5;&#x786E;&#x8BA4;&#x6570;&#x636E;&#x5C31;&#x7EEA;&#xFF1B;&#x5F53;&#x5C31;&#x7EEA;&#x540E;&#x5219;&#x590D;&#x5236;&#x6570;&#x636E;&#xFF0C;&#x8BE5;&#x8FC7;&#x7A0B;&#x963B;&#x585E;&#x3002; </p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj8sj22xj20gr099aa4.jpg" alt=""></p>
</li>
</ul>
<h5 id="&#x591A;&#x8DEF;&#x590D;&#x7528;"><a href="#&#x591A;&#x8DEF;&#x590D;&#x7528;" class="headerlink" title="&#x591A;&#x8DEF;&#x590D;&#x7528;"></a>&#x591A;&#x8DEF;&#x590D;&#x7528;</h5><p>&#x5B9E;&#x73B0;&#x975E;&#x963B;&#x585E;</p>
<p>&#x8FD9;&#x4E2A;&#x6982;&#x5FF5;&#x7A0D;&#x6709;&#x4E0D;&#x540C;&#xFF0C;&#x5B83;&#x662F;&#x5728;&#x6267;&#x884C; select() &#x7684;&#x65F6;&#x5019;&#xFF0C;&#x540C;&#x65F6;&#x963B;&#x585E;&#x591A;&#x4E2A; fd &#x7136;&#x540E;&#x7B49;&#x5230;&#x76D1;&#x6D4B;&#x5230;&#x67D0;&#x4E9B; fd &#x5C31;&#x7EEA;&#x65F6;&#x8FD4;&#x56DE;&#x3002;&#x6B64;&#x65F6;&#x8FDB;&#x7A0B;&#x4E24;&#x9636;&#x6BB5;&#x5747;&#x88AB;&#x963B;&#x585E;&#xFF0C;&#x4F46;&#x7B49;&#x5F85;&#x6570;&#x636E;&#x5C31;&#x7EEA;&#x9636;&#x6BB5;&#x7531; select() &#x963B;&#x585E;&#xFF0C;&#x590D;&#x5236;&#x6570;&#x636E;&#x9636;&#x6BB5;&#x7531; read() &#x963B;&#x585E;&#x3002; </p>
<p><img src="https://ws1.sinaimg.cn/large/a67bf22fgy1fupj7yfa1jj20gx092t8q.jpg" alt=""></p>
<p>&#x5728;BIO&#x6A21;&#x578B;&#x4E2D;&#xFF0C;&#x6211;&#x4EEC;&#x8981;&#x5B9E;&#x73B0;&#x975E;&#x963B;&#x585E;&#xFF0C;&#x7531;&#x4E8E;&#x4E0D;&#x80FD;&#x77E5;&#x9053;&#x4EC0;&#x4E48;&#x65F6;&#x5019;&#x53EF;&#x4EE5;&#x4ECE;&#x5185;&#x6838;&#x7F13;&#x51B2;&#x533A;&#x4E2D;&#x53D6;&#x6570;&#x636E;&#x53C8;&#x4E0D;&#x60F3;&#x53BB;&#x6D6A;&#x8D39;CPU&#x8D44;&#x6E90;&#xFF0C;&#x90A3;&#x4E48;&#x6211;&#x4EEC;&#x53EA;&#x80FD;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#xFF0C;&#x7136;&#x540E;&#x4F7F;&#x7528;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x53BB;&#x505A;&#x63A5;&#x4E0B;&#x6765;&#x7684;&#x4E8B;&#x4EF6;&#x7136;&#x540E;&#x7B49;&#x5230;&#x53EF;&#x4EE5;&#x53D6;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x6211;&#x4EEC;&#x518D;&#x53BB;&#x53D6;&#x3002;&#x4F46;&#x662F;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x4E5F;&#x662F;&#x5F88;&#x6D88;&#x8017;&#x8D44;&#x6E90;&#xFF0C;&#x800C;&#x4E14;&#x5F53;&#x7EBF;&#x7A0B;&#x591A;&#x4E86;&#x540E;&#x5207;&#x6362;&#x7EBF;&#x7A0B;&#x4E5F;&#x662F;&#x5F88;&#x8017;CPU&#x8D44;&#x6E90;&#x7684;&#x3002;&#x6240;&#x4EE5;&#x5728;&#x5355;&#x7EBF;&#x7A0B;&#x4E0B;&#x7684;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x7684;&#x4F18;&#x70B9;&#x5C31;&#x51F8;&#x663E;&#x6570;&#x6765;&#x4E86;&#xFF0C;&#x6CA1;&#x6709;&#x7EBF;&#x7A0B;&#x5207;&#x6362;&#xFF0C;&#x53EA;&#x6709;&#x62FC;&#x547D;&#x7684;&#x8BFB;&#x3001;&#x5199;&#x3001;&#x9009;&#x62E9;&#x4E8B;&#x4EF6;&#xFF0C;&#x5982;&#x679C;&#x518D;&#x5229;&#x7528;&#x597D;&#x591A;&#x6838;&#x5FC3;&#x8FDB;&#x884C;IO&#x90A3;&#x4E48;&#x6548;&#x7387;&#x8FD8;&#x4F1A;&#x6709;&#x66F4;&#x5927;&#x7684;&#x63D0;&#x5347;</p>
<h5 id="Unix&#x4E94;&#x79CD;IO&#x6A21;&#x578B;"><a href="#Unix&#x4E94;&#x79CD;IO&#x6A21;&#x578B;" class="headerlink" title="Unix&#x4E94;&#x79CD;IO&#x6A21;&#x578B;"></a>Unix&#x4E94;&#x79CD;IO&#x6A21;&#x578B;</h5><ul>
<li>&#x963B;&#x585E;IO</li>
<li>&#x975E;&#x963B;&#x585E;IO</li>
<li>IO&#x590D;&#x7528;&#xFF08;select&#x3001;poll&#x3001;epoll&#xFF09;</li>
<li>&#x4FE1;&#x53F7;&#x9A71;&#x52A8;IO</li>
<li>&#x5F02;&#x6B65;IO</li>
</ul>
<h5 id="Reactor&#x548C;Proactor&#x6A21;&#x5F0F;"><a href="#Reactor&#x548C;Proactor&#x6A21;&#x5F0F;" class="headerlink" title="Reactor&#x548C;Proactor&#x6A21;&#x5F0F;"></a>Reactor&#x548C;Proactor&#x6A21;&#x5F0F;</h5><p>&#x5176;&#x5B9E;java&#x4E2D;Selector&#x5C31;&#x662F;Reactor&#x6A21;&#x5F0F;&#x7684;&#x5B9E;&#x73B0;&#xFF0C;java&#x4E2D;&#x7684;AIO&#x5C31;&#x662F;Proactor&#x6A21;&#x5F0F;&#x7684;&#x5B9E;&#x73B0;&#xFF1B;&#x5B83;&#x4EEC;&#x90FD;&#x8981;&#x5B9E;&#x73B0;IO&#x7684;&#x591A;&#x8DEF;&#x590D;&#x7528;&#xFF0C;&#x4F46;&#x662F;&#x5728;&#x4E8B;&#x4EF6;&#x5206;&#x53D1;&#x8005;&#x5206;&#x53D1;&#x7ED9;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;&#x540E;&#xFF08;&#x5185;&#x6838;&#x7F13;&#x51B2;&#x533A;&#x6570;&#x636E;&#x51C6;&#x5907;&#x597D;&#x4E86;&#xFF09;&#x5904;&#x7406;&#x4E8B;&#x4EF6;&#x65B9;&#x5F0F;&#x4E0D;&#x4E00;&#x6837;&#xFF1B;&#x524D;&#x8005;&#x662F;&#x540C;&#x6B65;&#x7684;&#x5373;&#x5728;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x4E0B;&#x5904;&#x7406;IO&#x4EFB;&#x52A1;&#xFF08;&#x5C06;&#x5185;&#x6838;&#x7F13;&#x51B2;&#x533A;&#x6570;&#x636E;&#x590D;&#x5236;&#x5230;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x8FD9;&#x4E2A;IO&#x4EFB;&#x52A1;&#x6BD4;&#x8F83;&#x8017;&#x65F6;&#x5C31;&#x4F1A;&#x6BD4;&#x8F83;&#x6D6A;&#x8D39;CPU&#x8D44;&#x6E90;&#xFF1B;&#x540E;&#x8005;&#x91C7;&#x7528;&#x7684;&#x65B9;&#x5F0F;&#x7684;&#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x7ED9;&#x4E8B;&#x4EF6;&#x5904;&#x7406;&#x8005;</p>
<h4 id="NIO"><a href="#NIO" class="headerlink" title="NIO"></a>NIO</h4><h5 id="NIO&#x4E0E;&#x4F20;&#x7EDF;IO&#x7684;&#x533A;&#x522B;"><a href="#NIO&#x4E0E;&#x4F20;&#x7EDF;IO&#x7684;&#x533A;&#x522B;" class="headerlink" title="NIO&#x4E0E;&#x4F20;&#x7EDF;IO&#x7684;&#x533A;&#x522B;"></a>NIO&#x4E0E;&#x4F20;&#x7EDF;IO&#x7684;&#x533A;&#x522B;</h5><ol>
<li>NIO&#x9762;&#x5411;&#x7F13;&#x51B2;&#xFF0C;&#x800C;&#x4F20;&#x7EDF;IO&#x9762;&#x5411;&#x6D41;&#xFF1B;&#x4F20;&#x7EDF;IO&#x9762;&#x5411;&#x6D41;&#x610F;&#x5473;&#x7740;&#x6BCF;&#x6B21;&#x4ECE;&#x6D41;&#x4E2D;&#x8BFB;&#x4E00;&#x4E2A;&#x6216;&#x591A;&#x4E2A;&#x5B57;&#x8282;&#xFF0C;&#x76F4;&#x81F3;&#x8BFB;&#x53D6;&#x6240;&#x6709;&#x5B57;&#x8282;&#xFF0C;&#x5B83;&#x4EEC;&#x6CA1;&#x6709;&#x88AB;&#x7F13;&#x5B58;&#x5728;&#x4EFB;&#x4F55;&#x5730;&#x65B9; </li>
<li>NIO&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#xFF0C;&#x800C;&#x4F20;&#x7EDF;IO&#x662F;&#x963B;&#x585E;&#x7684;&#xFF1B;&#x5728;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x4F53;&#x73B0;&#x5728;&#x5F53;&#x4ECE;IO&#x8BBE;&#x5907;&#x63A5;&#x53D7;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5728;&#x4F20;&#x7EDF;IO&#x4E2D;&#x5F53;&#x524D;&#x7EBF;&#x7A0B;&#x9700;&#x8981;&#x7B49;&#x5F85;&#x8BBE;&#x5907;&#x63A7;&#x5236;&#x5668;&#x4ECE;IO&#x8BBE;&#x5907;&#x4E2D;&#x8BFB;&#x53D6;&#x6570;&#x636E;(&#x867D;&#x7136;&#x8FD9;&#x4E2A;&#x65F6;&#x5019;CPU&#x4E0E;&#x8BBE;&#x5907;&#x63A7;&#x5236;&#x5668;&#x662F;&#x5F02;&#x6B65;&#x7684;)&#x7136;&#x540E;CPU&#x518D;&#x8BFB;&#x53D6;&#x8BBE;&#x5907;&#x63A7;&#x5236;&#x5668;&#x4E2D;&#x7F13;&#x5B58;&#x7684;&#x6570;&#x636E;&#x5230;&#x5185;&#x6838;&#x5185;&#x5B58;&#x91CC;&#x9762;&#xFF1B;&#x4F46;&#x662F;NIO&#x4F1A;&#x5BF9;&#x524D;&#x9762;&#x8FD9;&#x4E2A;&#x8FC7;&#x7A0B;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#xFF0C;&#x53EA;&#x6709;&#x5F53;IO&#x8BBE;&#x5907;&#x91CC;&#x9762;&#x7684;&#x6570;&#x636E;&#x90FD;&#x5230;&#x8FBE;&#x4E86;&#x5185;&#x6838;&#x5185;&#x5B58;&#x518D;&#x901A;&#x77E5;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;(&#x8FD9;&#x91CC;&#x7684;&#x901A;&#x77E5;&#x7684;&#x8FC7;&#x7A0B;&#xFF0C;&#x6211;&#x4EEC;&#x5B8C;&#x5168;&#x53EF;&#x4EE5;&#x53C2;&#x8003;&#x540E;&#x9762;&#x5BF9;epoll&#x7684;&#x53C2;&#x8003;)</li>
</ol>
<h5 id="java-nio&#x57FA;&#x672C;&#x6982;&#x5FF5;"><a href="#java-nio&#x57FA;&#x672C;&#x6982;&#x5FF5;" class="headerlink" title="java nio&#x57FA;&#x672C;&#x6982;&#x5FF5;"></a>java nio&#x57FA;&#x672C;&#x6982;&#x5FF5;</h5><p>nio&#x5C31;&#x662F;new io&#xFF0C;&#x662F;&#x76F8;&#x5BF9;&#x4E8E;&#x4F20;&#x7EDF;&#x7684;io&#x6A21;&#x578B;&#x6765;&#x8BF4;&#x7684;&#xFF1B;java nio&#x662F;&#x4E00;&#x79CD;&#x57FA;&#x4E8E;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x6A21;&#x578B;&#x7684;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;&#x7684;io&#x6A21;&#x578B; &#x3002;&#x76F8;&#x5BF9;&#x4E8E;&#x4F20;&#x7EDF;&#x5C31;&#x4E00;&#x4E2A;io&#x6D41;&#x5C31;&#x9700;&#x8981;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x6765;&#x8FDB;&#x884C;&#x8FDE;&#x63A5;&#x5904;&#x7406;&#xFF0C;nio&#x7684;&#x5904;&#x7406;&#x65B9;&#x5F0F;&#x66F4;&#x52A0;&#x7684;&#x8282;&#x7EA6;&#x8D44;&#x6E90;&#xFF0C;&#x589E;&#x52A0;&#x7CFB;&#x7EDF;&#x7684;&#x541E;&#x5410;&#x91CF;&#x3002;</p>
<h5 id="java-nio&#x7684;&#x5B9E;&#x73B0;"><a href="#java-nio&#x7684;&#x5B9E;&#x73B0;" class="headerlink" title="java nio&#x7684;&#x5B9E;&#x73B0;"></a>java nio&#x7684;&#x5B9E;&#x73B0;</h5><p><img src="http://www.godpan.me/media/images/2017/11/java-nio.png" alt="java-nio"></p>
<p>&#x4E0A;&#x9762;&#x5C31;&#x662F;java nio&#x7684;&#x4E00;&#x79CD;&#x57FA;&#x672C;&#x6A21;&#x578B;&#xFF1B;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x5BF9;&#x5E94;&#x4E00;&#x4E2A;selector&#xFF0C;&#x4E00;&#x4E2A;selector&#x53EF;&#x4EE5;&#x7ED1;&#x5B9A;&#x591A;&#x4E2A;Channel&#xFF0C;&#x4E00;&#x4E2A;Channel&#x5BF9;&#x5E94;&#x7740;&#x4E00;&#x4E2A;Buffer&#x3002;&#x5F53;&#x7136;&#x8FD9;&#x53EA;&#x662F;&#x901A;&#x5E38;&#x7684;&#x505A;&#x6CD5;&#xFF0C;&#x4E00;&#x4E2A;Channel&#x4E5F;&#x53EF;&#x4EE5;&#x5BF9;&#x5E94;&#x591A;&#x4E2A;Selector&#xFF0C;&#x4E00;&#x4E2A;Channel&#x5BF9;&#x5E94;&#x7740;&#x591A;&#x4E2A;Buffer&#x3002;</p>
<h6 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h6><p>selector&#x5C31;&#x662F;java nio&#x5B9E;&#x73B0;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x7684;&#x5173;&#x952E;&#xFF1B;&#x5728;&#x4F20;&#x7EDF;io&#x4E2D;&#xFF0C;&#x4E00;&#x4E2A;socket&#x6211;&#x4EEC;&#x5FC5;&#x987B;&#x7528;&#x4E00;&#x4E2A;&#x7EBF;&#x7A0B;&#x53BB;&#x7BA1;&#x7406;&#xFF1B;&#x800C;&#x5728;&#x8FD9;&#x91CC;&#x6211;&#x4EEC;&#x5728;io&#x6D41;&#x548C;&#x7EBF;&#x7A0B;&#x4E2D;&#x95F4;&#x62BD;&#x8C61;&#x51FA;&#x4E00;&#x4E2A;selector&#x51FA;&#x6765;&#xFF0C;selector&#x5C31;&#x53EF;&#x4EE5;&#x53BB;&#x7BA1;&#x7406;&#x591A;&#x4E2A;io&#x6D41;&#x8FDE;&#x63A5;&#x4ECE;&#x800C;&#x5B9E;&#x73B0;&#x591A;&#x8DEF;&#x94FE;&#x63A5;    &#x3002;</p>
<ul>
<li><p>&#x521B;&#x5EFA;selector</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Selector selector = Selector.open();</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>&#x5728;selector&#x4E0A;&#x6CE8;&#x518C;channel</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">channel.configureBlocking(false);</span><br><span class="line">channel.register(selector, SelectionKey.OP_READ);</span><br></pre></td></tr></tbody></table></figure>
<p>&#x8FD9;&#x91CC;&#x7684;channel&#x5FC5;&#x987B;&#x662F;&#x975E;&#x963B;&#x585E;&#x7684;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x53C2;&#x6570;&#x662F;&#x8868;&#x793A;channel&#x5BF9;&#x4EC0;&#x4E48;&#x4E8B;&#x4EF6;&#x611F;&#x5174;&#x8DA3;&#xFF0C;&#x53EA;&#x6709;&#x5B83;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;selector&#x624D;&#x4F1A;&#x5206;&#x53D1;&#x7ED9;&#x5B83;&#xFF0C;&#x8FD9;&#x91CC;&#x7684;&#x4E8B;&#x4EF6;&#x6709;&#x56DB;&#x79CD;&#xFF1A;</p>
<ol>
<li>Connect&#xFF1A;&#x4E00;&#x4E2A;channel&#x6210;&#x529F;&#x8FDE;&#x63A5;&#x5230;&#x4E86;&#x5176;&#x5B83;&#x670D;&#x52A1;&#x5668;</li>
<li>Accept&#xFF1A; &#x4E00;&#x4E2A;ServerSocketChannel&#x63A5;&#x53D7;&#x5230;&#x4E86;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;</li>
<li>Read&#xFF1A; &#x4E00;&#x4E2A;channel&#x6709;&#x6570;&#x636E;&#x7B49;&#x5F85;&#x8BFB;</li>
<li>Write&#xFF1A;&#x4E00;&#x4E2A;channel&#x51C6;&#x5907;&#x597D;&#x4E86;&#x5199;&#x6570;&#x636E;</li>
</ol>
<p>&#x8FD9;&#x56DB;&#x4E2A;&#x4E8B;&#x4EF6;&#x5BF9;&#x5E94;SelectionKey&#x56DB;&#x4E2A;&#x5E38;&#x91CF;&#xFF1A;</p>
<ol>
<li>SelectionKey.OP_CONNECT</li>
<li>SelectionKey.OP_ACCEPT</li>
<li>SelectionKey.OP_READ</li>
<li>SelectionKey.OP_WRITE</li>
</ol>
<p>&#x5982;&#x679C;&#x60F3;&#x8868;&#x793A;&#x591A;&#x4E2A;&#x611F;&#x5174;&#x8DA3;&#x7684;&#x4E8B;&#x4EF6;&#x53EF;&#x4EE5;&#x50CF;&#x5982;&#x4E0B;&#xFF1A;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>SelectionKey</p>
<p>&#x5176;&#x5B9E;&#x6839;&#x636E;&#x6E90;&#x7801;&#x6211;&#x4EEC;&#x77E5;&#x9053;SelectionKey&#x7ED1;&#x5B9A;&#x4E86;&#x4E00;&#x4E2A;channel&#x548C;selector&#xFF0C;&#x5C31;&#x662F;&#x60F3;&#x8868;&#x793A;&#x4E00;&#x4E2A;&#x4E8B;&#x4EF6;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">final SelChImpl channel;</span><br><span class="line">public final SelectorImpl selector;</span><br><span class="line">private int index;</span><br><span class="line">private volatile int interestOps;</span><br><span class="line">private int readyOps;</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<ol>
<li><p>&#x627E;&#x5230;&#x5BF9;&#x5E94;&#x4E0A;&#x9762;&#x56DB;&#x79CD;&#x4E8B;&#x4EF6;&#x7684;SelectionKey</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.isAcceptable();</span><br><span class="line">selectionKey.isConnectable();</span><br><span class="line">selectionKey.isReadable();</span><br><span class="line">selectionKey.isWritable();</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>&#x901A;&#x8FC7;SelectionKey&#x4EA7;&#x751F;selector&#x548C;channel</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Channel  channel  = selectionKey.channel();</span><br><span class="line">Selector selector = selectionKey.selector();</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>&#x9644;&#x52A0;&#x6570;&#x636E;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">selectionKey.attach(theObject);</span><br><span class="line"></span><br><span class="line">Object attachedObj = selectionKey.attachment();</span><br></pre></td></tr></tbody></table></figure>
<p>&#x53C8;&#x6216;&#x8005;&#x5728;&#x6CE8;&#x518C;&#x7684;&#x65F6;&#x5019;&#x6DFB;&#x52A0;</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SelectionKey key = channel.register(selector, SelectionKey.OP_READ, theObject);</span><br></pre></td></tr></tbody></table></figure>
</li>
</ol>
<ul>
<li><p>&#x901A;&#x8FC7;selector&#x9009;&#x62E9;channel</p>
<ol>
<li>select() &#x963B;&#x585E;&#x5230;&#x81F3;&#x5C11;&#x6709;&#x4E00;&#x4E2A;channel&#x5DF2;&#x7ECF;&#x51C6;&#x5907;&#x597D;&#x4E86;&#x4F60;&#x6CE8;&#x518C;&#x7684;&#x4E8B;&#x4EF6;</li>
<li>int select(long timeout&#xFF09;&#x548C;select()&#x5DEE;&#x4E0D;&#x591A;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x6700;&#x591A;&#x963B;&#x585E;timeout milliseconds </li>
<li>selectNow() &#x4E0D;&#x963B;&#x585E;&#xFF0C;&#x5B83;&#x4F1A;&#x9A6C;&#x4E0A;&#x8FD4;&#x56DE;&#x4E0D;&#x7BA1;&#x6709;&#x6CA1;&#x6709;channel&#x51C6;&#x5907;&#x597D;&#x4E86;</li>
</ol>
</li>
<li><p>&#x5173;&#x4E8E;&#x6E90;&#x7801;</p>
<p><strong>selector &#x600E;&#x4E48;&#x8FC7;&#x6EE4;&#x4E8B;&#x4EF6;</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Set&lt;SelectionKey&gt; selectedKeys = <span class="keyword">new</span> HashSet();</span><br><span class="line"><span class="comment">//&#x8FD9;&#x4E2A;&#x662F;selector&#x6CE8;&#x518C;&#x7684;&#x5173;&#x6CE8;&#x7684;channel&#x7684;&#x4E8B;&#x4EF6;</span></span><br><span class="line"><span class="keyword">protected</span> HashSet&lt;SelectionKey&gt; keys = <span class="keyword">new</span> HashSet();</span><br><span class="line"><span class="keyword">private</span> Set&lt;SelectionKey&gt; publicKeys;</span><br><span class="line"><span class="keyword">private</span> Set&lt;SelectionKey&gt; publicSelectedKeys;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">SelectorImpl</span><span class="params">(SelectorProvider var1)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(var1);</span><br><span class="line">    <span class="keyword">if</span> (Util.atBugLevel(<span class="string">&quot;1.4&quot;</span>)) {</span><br><span class="line">        <span class="keyword">this</span>.publicKeys = <span class="keyword">this</span>.keys;</span><br><span class="line">        <span class="keyword">this</span>.publicSelectedKeys = <span class="keyword">this</span>.selectedKeys;</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">this</span>.publicKeys = Collections.unmodifiableSet(<span class="keyword">this</span>.keys);</span><br><span class="line">        <span class="keyword">this</span>.publicSelectedKeys = Util.ungrowableSet(<span class="keyword">this</span>.selectedKeys);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x867D;&#x7136;&#x6211;&#x6CA1;&#x6709;&#x770B;&#x5176;&#x5B9E;&#x73B0;&#xFF0C;&#x4F46;&#x662F;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x8FD9;&#x91CC;&#x7684;keys&#x5927;&#x6982;&#x77E5;&#x9053;&#xFF0C;&#x8FD9;&#x4E2A;keys&#x5C31;&#x662F;&#x4E3A;&#x4E86;&#x5F97;&#x5230;&#x6211;&#x4EEC;&#x6240;&#x5173;&#x6CE8;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;</p>
<p><strong>&#x6CE8;&#x518C;channel</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> SelectionKey <span class="title">register</span><span class="params">(AbstractSelectableChannel var1, <span class="keyword">int</span> var2, Object var3)</span> </span>{</span><br><span class="line">       <span class="keyword">if</span> (!(var1 <span class="keyword">instanceof</span> SelChImpl)) {</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalSelectorException();</span><br><span class="line">       } <span class="keyword">else</span> {</span><br><span class="line">           SelectionKeyImpl var4 = <span class="keyword">new</span> SelectionKeyImpl((SelChImpl)var1, <span class="keyword">this</span>);</span><br><span class="line">           var4.attach(var3);</span><br><span class="line">           Set var5 = <span class="keyword">this</span>.publicKeys;</span><br><span class="line">           <span class="keyword">synchronized</span>(<span class="keyword">this</span>.publicKeys) {</span><br><span class="line">               <span class="keyword">this</span>.implRegister(var4);</span><br><span class="line">           }</span><br><span class="line">  </span><br><span class="line">           var4.interestOps(var2);</span><br><span class="line">           <span class="keyword">return</span> var4;</span><br><span class="line">       }</span><br><span class="line">   }</span><br></pre></td></tr></tbody></table></figure>
<p>&#x4E0B;&#x9762;&#x7684;&#x4EE3;&#x7801;&#x4F1A;&#x8C03;&#x7528;selector&#x7684;&#x4EE5;&#x4E0A;&#x4EE3;&#x7801;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br></pre></td></tr></tbody></table></figure>
<p>&#x5927;&#x81F4;&#x5B8C;&#x6210;&#x4E86; &#x5B9E;&#x4F8B;&#x5316;&#x4E86;&#x4E00;&#x4E2A;SelectionKey&#x5E76;&#x7ED1;&#x5B9A;&#x4E86;selector&#x548C;channel&#xFF0C;&#x5E76;&#x4E14;&#x628A;&#x6B64;SelectionKey&#x52A0;&#x5165;&#x5230;&#x4E86;selector&#x4E2D;&#x7684;key&#x4E2D;</p>
</li>
</ul>
<h6 id="channel"><a href="#channel" class="headerlink" title="channel"></a>channel</h6><p>&#x901A;&#x9053;&#x662F;java nio&#x7684;&#x7B2C;&#x4E8C;&#x4E2A;&#x4E3B;&#x8981;&#x521B;&#x65B0;&#x3002;&#x5B83;&#x4EEC;&#x65E2;&#x4E0D;&#x662F;&#x4E00;&#x4E2A;&#x6269;&#x5C55;&#x4E5F;&#x4E0D;&#x662F;&#x4E00;&#x9879;&#x589E;&#x5F3A;,&#x800C;&#x662F;&#x5168;&#x65B0;&#x3001;&#x6781;&#x597D;&#x7684; Java I/O &#x793A;&#x4F8B;,&#x63D0;&#x4F9B;&#x4E0E; I/O &#x670D;&#x52A1;&#x7684;&#x76F4;&#x63A5;&#x8FDE;&#x63A5;&#x3002;Channel &#x7528;&#x4E8E;&#x5728;&#x5B57;&#x8282;&#x7F13;&#x51B2;&#x533A;&#x548C;&#x4F4D;&#x4E8E;&#x901A;&#x9053;&#x53E6;&#x4E00;&#x4FA7;&#x7684;&#x5B9E;&#x4F53;(&#x901A;&#x5E38;&#x662F;&#x4E00;&#x4E2A;&#x6587;&#x4EF6;&#x6216;&#x5957;&#x63A5;&#x5B57;)&#x4E4B;&#x95F4;&#x6709;&#x6548;&#x5730;&#x4F20;&#x8F93;&#x6570;&#x636E;&#x3002;&#x901A;&#x9053;&#x662F;&#x4E00;&#x79CD;&#x9014;&#x5F84;,&#x501F;&#x52A9;&#x8BE5;&#x9014;&#x5F84;,&#x53EF;&#x4EE5;&#x7528;&#x6700;&#x5C0F;&#x7684;&#x603B;&#x5F00;&#x9500;&#x6765;&#x8BBF;&#x95EE;&#x64CD;&#x4F5C;&#x7CFB;&#x7EDF;&#x672C;&#x8EAB;&#x7684; I/O &#x670D;&#x52A1;&#x3002;</p>
<p><strong>channel&#x6709;&#x56DB;&#x79CD;&#x5B9E;&#x73B0;</strong></p>
<ol>
<li>FileChannel&#xFF1A;&#x64CD;&#x4F5C;&#x6587;&#x4EF6;</li>
<li>DatagramChannel&#xFF1A;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x8BFB;&#x6216;&#x8005;&#x5199;&#x6570;&#x636E;&#x901A;&#x8FC7;UDP</li>
<li>SocketChannel&#xFF1A;&#x5728;&#x7F51;&#x7EDC;&#x4E0A;&#x8BFB;&#x6216;&#x8005;&#x5199;&#x6570;&#x636E;&#x901A;&#x8FC7;TCP</li>
<li>ServerSocketChannel&#xFF1A;&#x76D1;&#x542C;TCP&#x7684;&#x8FDE;&#x63A5;&#xFF0C;&#x5C31;&#x50CF;&#x4E00;&#x4E2A;web&#x670D;&#x52A1;&#x5668;&#xFF1B;&#x6BCF;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x5230;&#x6765;&#x90FD;&#x4F1A;&#x6709;&#x4E00;&#x4E2A;SocketChannel&#x751F;&#x6210;</li>
</ol>
<h6 id="Buffer"><a href="#Buffer" class="headerlink" title="Buffer"></a>Buffer</h6><p>&#x4E00;&#x4E2A;Buffer&#x5BF9;&#x8C61;&#x662F;&#x56FA;&#x5B9A;&#x6570;&#x91CF;&#x7684;&#x6570;&#x636E;&#x7684;&#x5BB9;&#x5668;&#x3002;&#x5176;&#x4F5C;&#x7528;&#x662F;&#x4E00;&#x4E2A;&#x5B58;&#x50A8;&#x5668;,&#x6216;&#x8005;&#x5206;&#x6BB5;&#x8FD0;&#x8F93;&#x533A;,&#x5728;&#x8FD9;&#x91CC;&#x6570;&#x636E;&#x53EF;&#x88AB;&#x5B58;&#x50A8;&#x5E76;&#x5728;&#x4E4B;&#x540E;&#x7528;&#x4E8E;&#x68C0;&#x7D22;&#x3002;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x5DE5;&#x4F5C;&#x4E0E;&#x901A;&#x9053;&#x7D27;&#x5BC6;&#x8054;&#x7CFB;&#x3002;&#x901A;&#x9053;&#x662F; I/O &#x4F20;&#x8F93;&#x53D1;&#x751F;&#x65F6;&#x901A;&#x8FC7;&#x7684;&#x5165;&#x53E3;,&#x800C;&#x7F13;&#x51B2;&#x533A;&#x662F;&#x8FD9;&#x4E9B;&#x6570;&#x636E;&#x4F20;&#x8F93;&#x7684;&#x6765;&#x6E90;&#x6216;&#x76EE;&#x6807;&#x3002;&#x5BF9;&#x4E8E;&#x79BB;&#x5F00;&#x7F13;&#x51B2;&#x533A;&#x7684;&#x4F20;&#x8F93;,&#x60A8;&#x60F3;&#x4F20;&#x9012;&#x51FA;&#x53BB;&#x7684;&#x6570;&#x636E;&#x88AB;&#x7F6E;&#x4E8E;&#x4E00;&#x4E2A;&#x7F13;&#x51B2;&#x533A;,&#x88AB;&#x4F20;&#x9001;&#x5230;&#x901A;&#x9053;&#x3002;</p>
<p><strong>buffer&#x7684;&#x57FA;&#x7840;&#x7528;&#x6CD5;</strong></p>
<ol>
<li>&#x5199;&#x6570;&#x636E;&#x5230;buffer</li>
<li>buffer.flip()</li>
<li>&#x4ECE;buffer&#x8BFB;&#x6570;&#x636E;</li>
<li>buffer.clear() &#x6216;&#x8005; buffer.compact()</li>
</ol>
<p><strong>capacity&#x3001;position&#x3001;limit</strong></p>
<p>position&#x3001;limit&#x7684;&#x542B;&#x4E49;&#x53D6;&#x51B3;&#x4E8E;buffer&#x662F;&#x51FA;&#x4E8E;&#x5199;&#x6A21;&#x5F0F;&#x8FD8;&#x662F;&#x8BFB;&#x6A21;&#x5F0F;&#xFF0C;capacity&#x7684;&#x542B;&#x4E49;&#x5728;&#x8FD9;&#x4E24;&#x79CD;&#x6A21;&#x5F0F;&#x4E0B;&#x7684;&#x610F;&#x4E49;&#x90FD;&#x662F;&#x4E00;&#x6837;&#x7684;</p>
<p><img src="http://tutorials.jenkov.com/images/java-nio/buffers-modes.png" alt=""></p>
<p>&#x5728;&#x5199;&#x6A21;&#x5F0F;&#x4E0B;&#xFF0C;position&#x9996;&#x5148;&#x88AB;&#x7F6E;&#x4E3A;0,limit&#x88AB;&#x7F6E;&#x4E3A;capacity&#xFF0C;&#x7136;&#x540E;&#x5199;&#x4E00;&#x4E2A;&#x6570;&#x636E;&#x7C7B;&#x578B;&#x7684;&#x6570;&#x636E;position&#x5C31;&#x589E;&#x52A0;1&#xFF0C;&#x6700;&#x5927;&#x4E3A;capacity-1</p>
<p>&#x5F53;&#x901A;&#x8FC7;flip()&#x53D8;&#x4E3A;&#x8BFB;&#x6A21;&#x5F0F;&#x65F6;&#xFF0C;position&#x53D8;&#x4E3A;0&#xFF0C;limit&#x53D8;&#x4E3A;&#x5199;&#x6570;&#x636E;&#x65F6;&#x5199;&#x5230;&#x6700;&#x5927;&#x7684;position&#x4F4D;&#x7F6E;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x53EA;&#x80FD;&#x4ECE;position&#x8BFB;&#x5230;limit</p>
<p><strong>Buffer&#x7C7B;&#x578B;</strong></p>
<ul>
<li>ByteBuffer</li>
<li>MappedByteBuffer</li>
<li>CharBuffer</li>
<li>DoubleBuffer</li>
<li>FloatBuffer</li>
<li>IntBuffer</li>
<li>LongBuffer</li>
<li>ShortBuffer</li>
</ul>
<p><strong>&#x5206;&#x914D;Buffer</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ByteBuffer buf = ByteBuffer.allocate(48);</span><br><span class="line">CharBuffer buf = CharBuffer.allocate(1024);</span><br></pre></td></tr></tbody></table></figure>
<p><strong>&#x901A;&#x8FC7;Buffer&#x4F20;&#x8F93;&#x6570;&#x636E;</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int bytesRead = inChannel.read(buf); //read into buffer.</span><br><span class="line"></span><br><span class="line">buf.put(127);</span><br></pre></td></tr></tbody></table></figure>
<p><strong>flip()</strong></p>
<p>&#x4ECE;&#x5199;&#x6A21;&#x5F0F;&#x6362;&#x5230;&#x8BFB;&#x6A21;&#x5F0F;&#xFF0C;&#x5177;&#x4F53;&#x7684;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;&#x5C31;&#x662F;&#xFF0C;&#x5C06;position&#x7F6E;&#x4E3A;0&#xFF0C;limit&#x8BBE;&#x7F6E;&#x4E3A;&#x4E0A;&#x4E00;&#x6B21;position&#x7684;&#x4F4D;&#x7F6E;</p>
<p>&#x4E0B;&#x9762;&#x662F;&#x4E00;&#x6BB5;&#x600E;&#x4E48;&#x5C06;ByteBuffer&#x91CC;&#x9762;&#x7684;&#x6570;&#x636E;&#x8F6C;&#x6362;&#x4E3A;utf-8&#x6570;&#x636E;</p>
<p><strong>clear() and compact()</strong></p>
<p>&#x8BFB;&#x5B8C;&#x6570;&#x636E;&#x540E;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;clear()&#x65B9;&#x6CD5;&#x91CD;&#x65B0;&#x52A0;&#x5165;&#x6570;&#x636E;</p>
<p>&#x5F53;&#x4F60;&#x4ECE;Buffer&#x4E2D;&#x6CA1;&#x6709;&#x8BFB;&#x5B8C;&#x6570;&#x636E;&#xFF0C;&#x4F46;&#x662F;&#x60F3;&#x8981;&#x5199;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x8BFB;&#x5269;&#x4E0B;&#x7684;&#x6570;&#x636E;&#x5C31;&#x7528;compact&#xFF0C;&#x5177;&#x4F53;&#x5B9E;&#x73B0;&#x5C31;&#x662F;&#x628A;&#x6240;&#x6709;&#x6CA1;&#x6709;&#x8BFB;&#x7684;&#x6570;&#x636E;&#x590D;&#x5236;&#x5230;buffer&#x5F00;&#x59CB;&#xFF0C;position&#x8BBE;&#x7F6E;&#x5230;&#x6CA1;&#x6709;&#x8BFB;&#x5B8C;&#x7684;&#x6570;&#x636E;&#x7684;&#x53F3;&#x8FB9;</p>
<p>mark() and reset()</p>
<p>&#x8BB0;&#x4F4F;position</p>
<p>&#x5C06;position &#x8BBE;&#x7F6E;&#x5230;&#x4E0A;&#x4E00;&#x6B21;mark&#x8BB0;&#x4F4F;position&#x7684;&#x4F4D;&#x7F6E;</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getBufferString</span><span class="params">(ByteBuffer buffer)</span></span>{</span><br><span class="line">    Charset charset = <span class="keyword">null</span>;</span><br><span class="line">    CharsetDecoder decoder = <span class="keyword">null</span>;</span><br><span class="line">    CharBuffer charBuffer = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    {</span><br><span class="line">        charset = Charset.forName(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        decoder = charset.newDecoder();</span><br><span class="line">        <span class="comment">// charBuffer = decoder.decode(buffer);//&#x7528;&#x8FD9;&#x4E2A;&#x7684;&#x8BDD;&#xFF0C;&#x53EA;&#x80FD;&#x8F93;&#x51FA;&#x6765;&#x4E00;&#x6B21;&#x7ED3;&#x679C;&#xFF0C;&#x7B2C;&#x4E8C;&#x6B21;&#x663E;&#x793A;&#x4E3A;&#x7A7A;</span></span><br><span class="line">        charBuffer = decoder.decode(buffer.asReadOnlyBuffer());</span><br><span class="line">        <span class="keyword">return</span> charBuffer.toString();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">    {</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="&#x5728;java-nio&#x4E2D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"><a href="#&#x5728;java-nio&#x4E2D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;" class="headerlink" title="&#x5728;java nio&#x4E2D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;"></a>&#x5728;java nio&#x4E2D;&#x540C;&#x6B65;&#x975E;&#x963B;&#x585E;&#x7684;&#x5B9E;&#x73B0;&#x65B9;&#x5F0F;</h5><p>&#x56E0;&#x4E3A;java nio&#x662F;&#x5728;&#x4F20;&#x7EDF;io&#x4E2D;&#x5305;&#x88C5;&#x8FC7;&#x6765;&#x7684;&#xFF0C;&#x6240;&#x4EE5;&#x5B83;&#x7684;&#x672C;&#x8D28;&#x8FD8;&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x800C;&#x5B83;&#x7684;&#x975E;&#x963B;&#x585E;&#x5C31;&#x662F;&#x901A;&#x8FC7;channel&#x662F;&#x5B9E;&#x73B0;&#x7684;&#x3002;&#x5728;&#x4EE3;&#x7801;&#x4E2D;&#x6211;&#x4EEC;&#x901A;&#x5E38;&#x901A;&#x8FC7; &#x5FAA;&#x73AF;selector.select()&#x6765;&#x5F97;&#x5230;&#x8FDE;&#x63A5;&#x6216;&#x8005;&#x5F85;&#x8BFB;&#x53D6;&#x7684;&#x901A;&#x9053;&#xFF0C;&#x8FD9;&#x91CC;&#x90FD;&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF1B;&#x5F53;&#x5F97;&#x5230;&#x4E00;&#x4E2A;&#x8FDE;&#x63A5;&#x51C6;&#x5907;&#x5199;&#x5165;&#x6216;&#x8005;&#x8BFB;&#x53D6;&#x6570;&#x636E;&#x7684;&#x65F6;&#x5019;&#x4E5F;&#x5C31;&#x662F;channel&#x7684;write&#x548C;read&#x65B9;&#x6CD5;&#x4F1A;&#x5F02;&#x6B65;&#x7684;&#x8FDB;&#x884C;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x5728;&#x6267;&#x884C;write&#x65B9;&#x6CD5;&#x65F6;&#x5728;&#x8FD8;&#x6CA1;&#x6709;&#x8FDB;&#x884C;&#x6570;&#x636E;&#x5199;&#x8FDB;buffer&#x4E4B;&#x524D;&#x5C31;&#x8FD4;&#x56DE;&#x4E86;&#xFF0C;read&#x540C;&#x7406;&#x5728;&#x6CA1;&#x6709;&#x8BFB;&#x6570;&#x636E;&#x5230;Buffer&#x7684;&#x65F6;&#x5019;&#x5C31;&#x5DF2;&#x7ECF;&#x8FD4;&#x56DE;&#xFF0C;&#x800C;&#x662F;&#x901A;&#x8FC7;&#x5F00;&#x542F;&#x4E00;&#x4E2A;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x6765;&#x5B8C;&#x6210;&#x5199;&#x5165;&#x548C;&#x8BFB;&#x53D6;&#x64CD;&#x4F5C;&#x3002;</p>
<h5 id="&#x7B80;&#x5355;&#x7684;nio&#x670D;&#x52A1;&#x5668;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"><a href="#&#x7B80;&#x5355;&#x7684;nio&#x670D;&#x52A1;&#x5668;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;" class="headerlink" title="&#x7B80;&#x5355;&#x7684;nio&#x670D;&#x52A1;&#x5668;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;"></a>&#x7B80;&#x5355;&#x7684;nio&#x670D;&#x52A1;&#x5668;&#x4EE3;&#x7801;&#x5B9E;&#x73B0;</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.net.InetSocketAddress;</span><br><span class="line"><span class="keyword">import</span> java.net.ServerSocket;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectableChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.Selector;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.ServerSocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> javax.swing.text.html.HTMLDocument.Iterator;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Simple echo-back server which listens for incoming stream connections and</span></span><br><span class="line"><span class="comment">* echoes back whatever it reads. A single Selector object is used to listen to</span></span><br><span class="line"><span class="comment">* the server socket (to accept new connections) and all the active socket</span></span><br><span class="line"><span class="comment">* channels.</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> zale (zalezone.cn)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectSockets</span> </span>{</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> PORT_NUMBER = <span class="number">1234</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">new</span> SelectSockets().go(argv);</span><br><span class="line">    }</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">go</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">int</span> port = PORT_NUMBER;</span><br><span class="line">        <span class="keyword">if</span> (argv.length &gt; <span class="number">0</span>) </span><br><span class="line">        { <span class="comment">// &#x8986;&#x76D6;&#x9ED8;&#x8BA4;&#x7684;&#x76D1;&#x542C;&#x7AEF;&#x53E3;</span></span><br><span class="line">            port = Integer.parseInt(argv[<span class="number">0</span>]);</span><br><span class="line">        }</span><br><span class="line">        System.out.println(<span class="string">&quot;Listening on port &quot;</span> + port);</span><br><span class="line">        ServerSocketChannel serverChannel = ServerSocketChannel.open();<span class="comment">// &#x6253;&#x5F00;&#x4E00;&#x4E2A;&#x672A;&#x7ED1;&#x5B9A;&#x7684;serversocketchannel</span></span><br><span class="line">        ServerSocket serverSocket = serverChannel.socket();<span class="comment">// &#x5F97;&#x5230;&#x4E00;&#x4E2A;ServerSocket&#x53BB;&#x548C;&#x5B83;&#x7ED1;&#x5B9A; </span></span><br><span class="line">        Selector selector = Selector.open();<span class="comment">// &#x521B;&#x5EFA;&#x4E00;&#x4E2A;Selector&#x4F9B;&#x4E0B;&#x9762;&#x4F7F;&#x7528;</span></span><br><span class="line">        serverSocket.bind(<span class="keyword">new</span> InetSocketAddress(port));<span class="comment">//&#x8BBE;&#x7F6E;server channel&#x5C06;&#x4F1A;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;</span></span><br><span class="line">        serverChannel.configureBlocking(<span class="keyword">false</span>);<span class="comment">//&#x8BBE;&#x7F6E;&#x975E;&#x963B;&#x585E;&#x6A21;&#x5F0F;</span></span><br><span class="line">        <span class="comment">//&#x8FD9;&#x6837;&#x505A;&#x7684;&#x76EE;&#x7684;&#x662F;&#x5E0C;&#x671B;&#x5728;&#x591A;&#x4E2A;serverChannel</span></span><br><span class="line">        serverChannel.register(selector, SelectionKey.OP_ACCEPT);<span class="comment">//&#x5C06;ServerSocketChannel&#x6CE8;&#x518C;&#x5230;Selector</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) </span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// This may block for a long time. Upon returning, the</span></span><br><span class="line">            <span class="comment">// selected set contains keys of the ready channels.</span></span><br><span class="line">            <span class="keyword">int</span> n = selector.select();</span><br><span class="line">            <span class="keyword">if</span> (n == <span class="number">0</span>) </span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">continue</span>; <span class="comment">// nothing to do</span></span><br><span class="line">            }           </span><br><span class="line">            java.util.Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();<span class="comment">// Get an iterator over the set of selected keys</span></span><br><span class="line">            <span class="comment">//&#x5728;&#x88AB;&#x9009;&#x62E9;&#x7684;set&#x4E2D;&#x904D;&#x5386;&#x5168;&#x90E8;&#x7684;key</span></span><br><span class="line">            <span class="keyword">while</span> (it.hasNext()) </span><br><span class="line">            {</span><br><span class="line">                SelectionKey key = (SelectionKey) it.next();</span><br><span class="line">                <span class="comment">// &#x5224;&#x65AD;key&#x6240;&#x7ED1;&#x5B9A;&#x7684;channel&#x662F;&#x4E0D;&#x662F;&#x6709;&#x8FDE;&#x63A5;&#x5230;&#x6765;</span></span><br><span class="line">                <span class="keyword">if</span> (key.isAcceptable()) </span><br><span class="line">                {	</span><br><span class="line">                    <span class="comment">// &#x53D6;&#x51FA;channel&#xFF0C; &#x6709;&#x8FDE;&#x63A5;&#x5230;&#x6765;&#x6240;&#x4EE5;&#x6211;&#x4EEC;&#x77E5;&#x9053;&#x662F;&#x4E00;&#x4E2A;ServerSocketChannel</span></span><br><span class="line">                    ServerSocketChannel server =(ServerSocketChannel) key.channel();</span><br><span class="line">                    SocketChannel channel = server.accept();</span><br><span class="line">                    registerChannel(selector, channel,SelectionKey.OP_READ);<span class="comment">//&#x6CE8;&#x518C;&#x8BFB;&#x4E8B;&#x4EF6;</span></span><br><span class="line">                    sayHello(channel);<span class="comment">//&#x5BF9;&#x8FDE;&#x63A5;&#x8FDB;&#x884C;&#x5904;&#x7406;</span></span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//&#x5224;&#x65AD;&#x8FD9;&#x4E2A;channel&#x4E0A;&#x662F;&#x5426;&#x6709;&#x6570;&#x636E;&#x8981;&#x8BFB;</span></span><br><span class="line">                <span class="keyword">if</span> (key.isReadable()) </span><br><span class="line">                {</span><br><span class="line">                    readDataFromSocket(key);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">//&#x4ECE;selected set&#x4E2D;&#x79FB;&#x9664;&#x8FD9;&#x4E2A;key&#xFF0C;&#x56E0;&#x4E3A;&#x5B83;&#x5DF2;&#x7ECF;&#x88AB;&#x5904;&#x7406;&#x8FC7;&#x4E86;</span></span><br><span class="line">                it.remove();</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Register the given channel with the given selector for the given</span></span><br><span class="line"><span class="comment">    * operations of interest</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">registerChannel</span><span class="params">(Selector selector,SelectableChannel channel, <span class="keyword">int</span> ops)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">if</span> (channel == <span class="keyword">null</span>) </span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// &#x53EF;&#x80FD;&#x4F1A;&#x53D1;&#x751F;</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// &#x8BBE;&#x7F6E;&#x901A;&#x9053;&#x4E3A;&#x975E;&#x963B;&#x585E;</span></span><br><span class="line">        channel.configureBlocking(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">// &#x5C06;&#x901A;&#x9053;&#x6CE8;&#x518C;&#x5230;&#x9009;&#x62E9;&#x5668;&#x4E0A;</span></span><br><span class="line">        channel.register(selector, ops);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ----------------------------------------------------------</span></span><br><span class="line">    <span class="comment">// Use the same byte buffer for all channels. A single thread is</span></span><br><span class="line">    <span class="comment">// servicing all the channels, so no danger of concurrent acccess.</span></span><br><span class="line">    <span class="comment">//&#x5BF9;&#x6240;&#x6709;&#x7684;&#x901A;&#x9053;&#x4F7F;&#x7528;&#x76F8;&#x540C;&#x7684;&#x7F13;&#x51B2;&#x533A;&#x3002;&#x5355;&#x7EBF;&#x7A0B;&#x4E3A;&#x6240;&#x6709;&#x7684;&#x901A;&#x9053;&#x8FDB;&#x884C;&#x670D;&#x52A1;&#xFF0C;&#x6240;&#x4EE5;&#x5E76;&#x53D1;&#x8BBF;&#x95EE;&#x6CA1;&#x6709;&#x98CE;&#x9669;</span></span><br><span class="line">    <span class="comment">// &#x5C31;&#x662F;&#x8BF4;&#x8FD9;&#x91CC;&#x56E0;&#x4E3A;&#x53EA;&#x6709;&#x4E00;&#x4E2A;selector &#x4E5F;&#x5C31;&#x662F;</span></span><br><span class="line">    <span class="keyword">private</span> ByteBuffer buffer = ByteBuffer.allocateDirect(<span class="number">1024</span>);</span><br><span class="line">    * Sample data handler method <span class="keyword">for</span> a channel with data ready to read.</span><br><span class="line">    * &#x5BF9;&#x4E8E;&#x4E00;&#x4E2A;&#x51C6;&#x5907;&#x8BFB;&#x5165;&#x6570;&#x636E;&#x7684;&#x901A;&#x9053;&#x7684;&#x7B80;&#x5355;&#x7684;&#x6570;&#x636E;&#x5904;&#x7406;&#x65B9;&#x6CD5;</span><br><span class="line">    * <span class="meta">@param</span> key</span><br><span class="line">    *</span><br><span class="line">    A SelectionKey object associated with a channel determined by</span><br><span class="line">    the selector to be ready <span class="keyword">for</span> reading. If the channel returns</span><br><span class="line">    an EOF condition, it is closed here, which automatically</span><br><span class="line">    invalidates the associated key. The selector will then</span><br><span class="line">    de-register the channel on the next select call.</span><br><span class="line"> </span><br><span class="line">    &#x4E00;&#x4E2A;&#x9009;&#x62E9;&#x5668;&#x51B3;&#x5B9A;&#x4E86;&#x548C;&#x901A;&#x9053;&#x5173;&#x8054;&#x7684;SelectionKey object&#x662F;&#x51C6;&#x5907;&#x8BFB;&#x72B6;&#x6001;&#x3002;&#x5982;&#x679C;&#x901A;&#x9053;&#x8FD4;&#x56DE;EOF&#xFF0C;&#x901A;&#x9053;&#x5C06;&#x88AB;&#x5173;&#x95ED;&#x3002;</span><br><span class="line">    &#x5E76;&#x4E14;&#x4F1A;&#x81EA;&#x52A8;&#x4F7F;&#x76F8;&#x5173;&#x7684;key&#x5931;&#x6548;&#xFF0C;&#x9009;&#x62E9;&#x5668;&#x7136;&#x540E;&#x4F1A;&#x5728;&#x4E0B;&#x4E00;&#x6B21;&#x7684;select call&#x65F6;&#x53D6;&#x6D88;&#x6389;&#x901A;&#x9053;&#x7684;&#x6CE8;&#x518C;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">readDataFromSocket</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        SocketChannel socketChannel = (SocketChannel) key.channel();</span><br><span class="line">        <span class="keyword">int</span> count;</span><br><span class="line">        buffer.clear(); <span class="comment">// &#x6E05;&#x7A7A;Buffer</span></span><br><span class="line">        <span class="comment">// Loop while data is available; channel is nonblocking</span></span><br><span class="line">        <span class="comment">//&#x5F53;&#x53EF;&#x4EE5;&#x8BFB;&#x5230;&#x6570;&#x636E;&#x65F6;&#x4E00;&#x76F4;&#x5FAA;&#x73AF;&#xFF0C;&#x901A;&#x9053;&#x4E3A;&#x975E;&#x963B;&#x585E;</span></span><br><span class="line">        <span class="keyword">while</span> ((count = socketChannel.read(buffer)) &gt; <span class="number">0</span>) </span><br><span class="line">        {</span><br><span class="line">            buffer.flip(); <span class="comment">// &#x5C06;&#x7F13;&#x51B2;&#x533A;&#x7F6E;&#x4E3A;&#x53EF;&#x8BFB;</span></span><br><span class="line">            <span class="comment">// Send the data; don&apos;t assume it goes all at once</span></span><br><span class="line">            <span class="comment">//&#x53D1;&#x9001;&#x6570;&#x636E;&#xFF0C;&#x4E0D;&#x8981;&#x671F;&#x671B;&#x80FD;&#x4E00;&#x6B21;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5B8C;</span></span><br><span class="line">            <span class="keyword">while</span> (buffer.hasRemaining()) </span><br><span class="line">            {</span><br><span class="line">                socketChannel.write(buffer);</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// WARNING: the above loop is evil. Because</span></span><br><span class="line">            <span class="comment">// it&apos;s writing back to the same nonblocking</span></span><br><span class="line">            <span class="comment">// channel it read the data from, this code can</span></span><br><span class="line">            <span class="comment">// potentially spin in a busy loop. In real life</span></span><br><span class="line">            <span class="comment">// you&apos;d do something more useful than this.</span></span><br><span class="line">            <span class="comment">//&#x8FD9;&#x91CC;&#x7684;&#x5FAA;&#x73AF;&#x662F;&#x65E0;&#x610F;&#x4E49;&#x7684;&#xFF0C;&#x5177;&#x4F53;&#x6309;&#x5B9E;&#x9645;&#x60C5;&#x51B5;&#x800C;&#x5B9A;</span></span><br><span class="line">            buffer.clear(); <span class="comment">// Empty buffer</span></span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">0</span>) </span><br><span class="line">                    {</span><br><span class="line">            <span class="comment">// Close channel on EOF, invalidates the key</span></span><br><span class="line">            <span class="comment">//&#x8BFB;&#x53D6;&#x7ED3;&#x675F;&#x540E;&#x5173;&#x95ED;&#x901A;&#x9053;&#xFF0C;&#x4F7F;key&#x5931;&#x6548;</span></span><br><span class="line">            socketChannel.close();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ----------------------------------------------------------</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Spew a greeting to the incoming client connection.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> channel</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    The newly connected SocketChannel to say hello to.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">(SocketChannel channel)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        buffer.clear();</span><br><span class="line">        buffer.put(<span class="string">&quot;Hi there!\r\n&quot;</span>.getBytes());</span><br><span class="line">        buffer.flip();</span><br><span class="line">        channel.write(buffer);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;"><a href="#&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;" class="headerlink" title="&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;"></a>&#x7EBF;&#x7A0B;&#x6C60;&#x7684;&#x901A;&#x9053;&#x5B9E;&#x73B0;&#x4EE3;&#x7801;</h5><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SelectionKey;</span><br><span class="line"><span class="keyword">import</span> java.nio.channels.SocketChannel;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"> </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Specialization of the SelectSockets class which uses a thread pool to service</span></span><br><span class="line"><span class="comment">* channels. The thread pool is an ad-hoc implementation quicky lashed togther</span></span><br><span class="line"><span class="comment">* in a few hours for demonstration purposes. It&apos;s definitely not production</span></span><br><span class="line"><span class="comment">* quality.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> Ron Hitchens (ron@ronsoft.com)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelectSocketsThreadPool</span> <span class="keyword">extends</span> <span class="title">SelectSockets</span> </span></span><br><span class="line"><span class="class"></span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_THREADS = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">private</span> ThreadPool pool = <span class="keyword">new</span> ThreadPool(MAX_THREADS);</span><br><span class="line">    <span class="comment">// -------------------------------------------------------------</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] argv)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        <span class="keyword">new</span> SelectSocketsThreadPool().go(argv);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// -------------------------------------------------------------</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Sample data handler method for a channel with data ready to read. This</span></span><br><span class="line"><span class="comment">    * method is invoked from(&#x88AB;&#x8C03;&#x7528;) the go( ) method in the parent class. This handler</span></span><br><span class="line"><span class="comment">    * delegates&#xFF08;&#x59D4;&#x6258;&#xFF09; to a worker thread in a thread pool to service the channel,</span></span><br><span class="line"><span class="comment">    * then returns immediately.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    A SelectionKey object representing a channel determined by the</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    selector to be ready for reading. If the channel returns an</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    EOF condition, it is closed here, which automatically</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    invalidates the associated key. The selector will then</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    de-register the channel on the next select call.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">readDataFromSocket</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">    </span>{</span><br><span class="line">        WorkerThread worker = pool.getWorker();</span><br><span class="line">        <span class="keyword">if</span> (worker == <span class="keyword">null</span>) </span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// No threads available. Do nothing. The selection</span></span><br><span class="line">            <span class="comment">// loop will keep calling this method until a</span></span><br><span class="line">            <span class="comment">// thread becomes available. This design could</span></span><br><span class="line">            <span class="comment">// be improved.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// Invoking this wakes up the worker thread, then returns</span></span><br><span class="line">        worker.serviceChannel(key);</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ---------------------------------------------------------------</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * A very simple thread pool class. The pool size is set at construction</span></span><br><span class="line"><span class="comment">    * time and remains fixed. Threads are cycled through a FIFO idle queue.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadPool</span></span></span><br><span class="line"><span class="class">    </span>{</span><br><span class="line">        List idle = <span class="keyword">new</span> LinkedList();</span><br><span class="line">        ThreadPool(<span class="keyword">int</span> poolSize) </span><br><span class="line">        {</span><br><span class="line">            <span class="comment">// Fill up the pool with worker threads</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; poolSize; i++)</span><br><span class="line">            {</span><br><span class="line">                WorkerThread thread = <span class="keyword">new</span> WorkerThread(<span class="keyword">this</span>);</span><br><span class="line">                <span class="comment">// Set thread name for debugging. Start it.</span></span><br><span class="line">                thread.setName(<span class="string">&quot;Worker&quot;</span> + (i + <span class="number">1</span>));</span><br><span class="line">                thread.start();</span><br><span class="line">                idle.add(thread);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Find an idle worker thread, if any. Could return null.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="function">WorkerThread <span class="title">getWorker</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            WorkerThread worker = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">synchronized</span> (idle) </span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">if</span> (idle.size() &gt; <span class="number">0</span>) </span><br><span class="line">                {</span><br><span class="line">                    worker = (WorkerThread) idle.remove(<span class="number">0</span>);</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">return</span> (worker);</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Called by the worker thread to return itself to the idle pool.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">returnWorker</span><span class="params">(WorkerThread worker)</span> </span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">synchronized</span> (idle) </span><br><span class="line">            {</span><br><span class="line">                idle.add(worker);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * A worker thread class which can drain&#xFF08;&#x6392;&#x7A7A;&#xFF09; channels and echo-back&#xFF08;&#x56DE;&#x663E;&#xFF09; the input.</span></span><br><span class="line"><span class="comment">    * Each instance is constructed with a reference&#xFF08;&#x53C2;&#x8003;&#xFF09; to the owning thread pool</span></span><br><span class="line"><span class="comment">    * object. When started, the thread loops forever waiting to be awakened to</span></span><br><span class="line"><span class="comment">    * service the channel associated with a SelectionKey object. The worker is</span></span><br><span class="line"><span class="comment">    * tasked by calling its serviceChannel( ) method with a SelectionKey</span></span><br><span class="line"><span class="comment">    * object. The serviceChannel( ) method stores the key reference in the</span></span><br><span class="line"><span class="comment">    * thread object then calls notify( ) to wake it up. When the channel has</span></span><br><span class="line"><span class="comment">    * been drained, the worker thread returns itself to its parent pool.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span></span><br><span class="line"><span class="class">    </span>{</span><br><span class="line">        <span class="keyword">private</span> ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">        <span class="keyword">private</span> ThreadPool pool;</span><br><span class="line">        <span class="keyword">private</span> SelectionKey key;</span><br><span class="line">        WorkerThread(ThreadPool pool) </span><br><span class="line">        {</span><br><span class="line">            <span class="keyword">this</span>.pool = pool;</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">// Loop forever waiting for work to do</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            System.out.println(<span class="keyword">this</span>.getName() + <span class="string">&quot; is ready&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (<span class="keyword">true</span>) </span><br><span class="line">            {</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                {</span><br><span class="line">                    <span class="comment">// Sleep and release object lock</span></span><br><span class="line">                    <span class="comment">//&#x4F11;&#x7720;&#x5E76;&#x4E14;&#x91CA;&#x653E;&#x6389;&#x5BF9;&#x8C61;&#x9501;</span></span><br><span class="line">                    <span class="keyword">this</span>.wait();</span><br><span class="line">                } </span><br><span class="line">                <span class="keyword">catch</span> (InterruptedException e) </span><br><span class="line">                {</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    <span class="comment">// Clear interrupt status</span></span><br><span class="line">                    <span class="keyword">this</span>.interrupted();</span><br><span class="line">                }</span><br><span class="line">                <span class="keyword">if</span> (key == <span class="keyword">null</span>) </span><br><span class="line">                {</span><br><span class="line">                    <span class="keyword">continue</span>; <span class="comment">// just in case</span></span><br><span class="line">                }</span><br><span class="line">                System.out.println(<span class="keyword">this</span>.getName() + <span class="string">&quot; has been awakened&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                {</span><br><span class="line">                    drainChannel(key);</span><br><span class="line">                } </span><br><span class="line">                <span class="keyword">catch</span> (Exception e) </span><br><span class="line">                {</span><br><span class="line">                    System.out.println(<span class="string">&quot;Caught &apos;&quot;</span> + e + <span class="string">&quot;&apos; closing channel&quot;</span>);</span><br><span class="line">                    <span class="comment">// Close channel and nudge selector</span></span><br><span class="line">                    <span class="keyword">try</span></span><br><span class="line">                    {</span><br><span class="line">                        key.channel().close();</span><br><span class="line">                    } </span><br><span class="line">                    <span class="keyword">catch</span> (IOException ex) </span><br><span class="line">                    {</span><br><span class="line">                        ex.printStackTrace();</span><br><span class="line">                    }</span><br><span class="line">                    key.selector().wakeup();</span><br><span class="line">                }</span><br><span class="line">                key = <span class="keyword">null</span>;</span><br><span class="line">                <span class="comment">// Done. Ready for more. Return to pool</span></span><br><span class="line">                <span class="keyword">this</span>.pool.returnWorker(<span class="keyword">this</span>);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * Called to initiate a unit of work by this worker thread on the</span></span><br><span class="line"><span class="comment">        * provided SelectionKey object. This method is synchronized, as is the</span></span><br><span class="line"><span class="comment">        * run( ) method, so only one key can be serviced at a given time.</span></span><br><span class="line"><span class="comment">        * Before waking the worker thread, and before returning to the main</span></span><br><span class="line"><span class="comment">        * selection loop, this key&apos;s interest set is updated to remove OP_READ.</span></span><br><span class="line"><span class="comment">        * This will cause the selector to ignore read-readiness for this</span></span><br><span class="line"><span class="comment">        * channel while the worker thread is servicing it.</span></span><br><span class="line"><span class="comment">        * &#x901A;&#x8FC7;&#x4E00;&#x4E2A;&#x88AB;&#x63D0;&#x4F9B;SelectionKey&#x5BF9;&#x8C61;&#x7684;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x6765;&#x521D;&#x59CB;&#x5316;&#x4E00;&#x4E2A;&#x5DE5;&#x4F5C;&#x96C6;&#x5408;&#xFF0C;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x662F;&#x540C;&#x6B65;&#x7684;&#xFF0C;&#x6240;&#x4EE5;</span></span><br><span class="line"><span class="comment">        * &#x91CC;&#x9762;&#x7684;run&#x65B9;&#x6CD5;&#x53EA;&#x6709;&#x4E00;&#x4E2A;key&#x80FD;&#x88AB;&#x670D;&#x52A1;&#x5728;&#x540C;&#x4E00;&#x4E2A;&#x65F6;&#x95F4;&#xFF0C;&#x5728;&#x5524;&#x9192;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x548C;&#x8FD4;&#x56DE;&#x5230;&#x4E3B;&#x5FAA;&#x73AF;&#x4E4B;&#x524D;&#xFF0C;&#x8FD9;&#x4E2A;key&#x7684;</span></span><br><span class="line"><span class="comment">        * &#x611F;&#x5174;&#x8DA3;&#x7684;&#x96C6;&#x5408;&#x88AB;&#x66F4;&#x65B0;&#x6765;&#x5220;&#x9664;OP_READ&#xFF0C;&#x8FD9;&#x5C06;&#x4F1A;&#x5F15;&#x8D77;&#x5DE5;&#x4F5C;&#x7EBF;&#x7A0B;&#x5728;&#x63D0;&#x4F9B;&#x670D;&#x52A1;&#x7684;&#x65F6;&#x5019;&#x9009;&#x62E9;&#x5668;&#x4F1A;&#x5FFD;&#x7565;&#x8BFB;&#x5C31;&#x7EEA;&#x7684;&#x901A;&#x9053;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">serviceChannel</span><span class="params">(SelectionKey key)</span> </span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            key.interestOps(key.interestOps() &amp; (~SelectionKey.OP_READ));</span><br><span class="line">            <span class="keyword">this</span>.notify(); <span class="comment">// Awaken the thread</span></span><br><span class="line">        }</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * The actual code which drains the channel associated with the given</span></span><br><span class="line"><span class="comment">        * key. This method assumes the key has been modified prior to</span></span><br><span class="line"><span class="comment">        * invocation to turn off selection interest in OP_READ. When this</span></span><br><span class="line"><span class="comment">        * method completes it re-enables OP_READ and calls wakeup( ) on the</span></span><br><span class="line"><span class="comment">        * selector so the selector will resume watching this channel.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">drainChannel</span><span class="params">(SelectionKey key)</span> <span class="keyword">throws</span> Exception </span></span><br><span class="line"><span class="function">        </span>{</span><br><span class="line">            SocketChannel channel = (SocketChannel) key.channel();</span><br><span class="line">            <span class="keyword">int</span> count;</span><br><span class="line">            buffer.clear(); <span class="comment">// &#x6E05;&#x7A7A;buffer</span></span><br><span class="line">            <span class="comment">// Loop while data is available; channel is nonblocking</span></span><br><span class="line">            <span class="keyword">while</span> ((count = channel.read(buffer)) &gt; <span class="number">0</span>)</span><br><span class="line">            {</span><br><span class="line">                buffer.flip(); <span class="comment">// make buffer readable</span></span><br><span class="line">                <span class="comment">// Send the data; may not go all at once</span></span><br><span class="line">                <span class="keyword">while</span> (buffer.hasRemaining()) </span><br><span class="line">                {</span><br><span class="line">                    channel.write(buffer);</span><br><span class="line">                }</span><br><span class="line">                <span class="comment">// WARNING: the above loop is evil.</span></span><br><span class="line">                <span class="comment">// See comments in superclass.</span></span><br><span class="line">                buffer.clear(); <span class="comment">// Empty buffer</span></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">if</span> (count &lt; <span class="number">0</span>) </span><br><span class="line">            {</span><br><span class="line">                <span class="comment">// Close channel on EOF; invalidates the key</span></span><br><span class="line">                channel.close();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            }</span><br><span class="line">            <span class="comment">// Resume interest in OP_READ</span></span><br><span class="line">            key.interestOps(key.interestOps() | SelectionKey.OP_READ);</span><br><span class="line">            <span class="comment">// Cycle the selector so this key is active again</span></span><br><span class="line">            key.selector().wakeup();</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h5 id="select&#x3001;poll&#x3001;epoll"><a href="#select&#x3001;poll&#x3001;epoll" class="headerlink" title="select&#x3001;poll&#x3001;epoll"></a>select&#x3001;poll&#x3001;epoll</h5><p>&#x8FD9;&#x4E09;&#x8005;&#x90FD;&#x662F;IO&#x591A;&#x8DEF;&#x590D;&#x7528;&#x7684;&#x673A;&#x5236;&#x3002;I/O&#x591A;&#x8DEF;&#x590D;&#x7528;&#x5C31;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x79CD;&#x673A;&#x5236;&#xFF0C;&#x4E00;&#x4E2A;&#x8FDB;&#x7A0B;&#x53EF;&#x4EE5;&#x76D1;&#x89C6;&#x591A;&#x4E2A;&#x63CF;&#x8FF0;&#x7B26;&#xFF0C;&#x4E00;&#x65E6;&#x67D0;&#x4E2A;&#x63CF;&#x8FF0;&#x7B26;&#x5C31;&#x7EEA;&#xFF08;&#x4E00;&#x822C;&#x662F;&#x8BFB;&#x5C31;&#x7EEA;&#x6216;&#x8005;&#x5199;&#x5C31;&#x7EEA;&#xFF09;&#xFF0C;&#x80FD;&#x591F;&#x901A;&#x77E5;&#x7A0B;&#x5E8F;&#x8FDB;&#x884C;&#x76F8;&#x5E94;&#x7684;&#x8BFB;&#x5199;&#x64CD;&#x4F5C;&#x3002;</p>
<p><strong>select</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int select (int n, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);</span><br></pre></td></tr></tbody></table></figure>
<p>select &#x51FD;&#x6570;&#x76D1;&#x89C6;&#x7684;&#x6587;&#x4EF6;&#x63CF;&#x8FF0;&#x7B26;&#x5206;3&#x7C7B;&#xFF0C;&#x5206;&#x522B;&#x662F;writefds&#x3001;readfds&#x3001;&#x548C;exceptfds&#x3002;&#x8C03;&#x7528;&#x540E;select&#x51FD;&#x6570;&#x4F1A;&#x963B;&#x585E;&#xFF0C;&#x76F4;&#x5230;&#x6709;&#x63CF;&#x8FF0;&#x526F;&#x5C31;&#x7EEA;&#xFF08;&#x6709;&#x6570;&#x636E; &#x53EF;&#x8BFB;&#x3001;&#x53EF;&#x5199;&#x3001;&#x6216;&#x8005;&#x6709;except&#xFF09;&#xFF0C;&#x6216;&#x8005;&#x8D85;&#x65F6;&#xFF08;timeout&#x6307;&#x5B9A;&#x7B49;&#x5F85;&#x65F6;&#x95F4;&#xFF0C;&#x5982;&#x679C;&#x7ACB;&#x5373;&#x8FD4;&#x56DE;&#x8BBE;&#x4E3A;null&#x5373;&#x53EF;&#xFF09;&#xFF0C;&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x3002;&#x5F53;select&#x51FD;&#x6570;&#x8FD4;&#x56DE;&#x540E;&#xFF0C;&#x53EF;&#x4EE5; &#x901A;&#x8FC7;&#x904D;&#x5386;fdset&#xFF0C;&#x6765;&#x627E;&#x5230;&#x5C31;&#x7EEA;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#x3002; </p>
<p><strong>poll</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int poll (struct pollfd *fds, unsigned int nfds, int timeout);</span><br></pre></td></tr></tbody></table></figure>
<p>&#x4E0D;&#x540C;&#x4E0E;select&#x4F7F;&#x7528;&#x4E09;&#x4E2A;&#x4F4D;&#x56FE;&#x6765;&#x8868;&#x793A;&#x4E09;&#x4E2A;fdset&#x7684;&#x65B9;&#x5F0F;&#xFF0C;poll&#x4F7F;&#x7528;&#x4E00;&#x4E2A; pollfd&#x7684;&#x6307;&#x9488;&#x5B9E;&#x73B0;&#x3002; </p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">struct pollfd {</span><br><span class="line">    int fd; /* file descriptor */</span><br><span class="line">    short events; /* requested events to watch */</span><br><span class="line">    short revents; /* returned events witnessed */</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>
<p>pollfd&#x7ED3;&#x6784;&#x5305;&#x542B;&#x4E86;&#x8981;&#x76D1;&#x89C6;&#x7684;event&#x548C;&#x53D1;&#x751F;&#x7684;event&#xFF0C;&#x4E0D;&#x518D;&#x4F7F;&#x7528;select&#x201C;&#x53C2;&#x6570;-&#x503C;&#x201D;&#x4F20;&#x9012;&#x7684;&#x65B9;&#x5F0F;&#x3002;&#x540C;&#x65F6;&#xFF0C;pollfd&#x5E76;&#x6CA1;&#x6709;&#x6700;&#x5927;&#x6570;&#x91CF;&#x9650;&#x5236;&#xFF08;&#x4F46;&#x662F;&#x6570;&#x91CF;&#x8FC7;&#x5927;&#x540E;&#x6027;&#x80FD;&#x4E5F;&#x662F;&#x4F1A;&#x4E0B;&#x964D;&#xFF09;&#x3002; &#x548C;select&#x51FD;&#x6570;&#x4E00;&#x6837;&#xFF0C;poll&#x8FD4;&#x56DE;&#x540E;&#xFF0C;&#x9700;&#x8981;&#x8F6E;&#x8BE2;pollfd&#x6765;&#x83B7;&#x53D6;&#x5C31;&#x7EEA;&#x7684;&#x63CF;&#x8FF0;&#x7B26;&#x3002; </p>
<p><strong>epoll</strong></p>
<figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">int epoll_create(int size)&#xFF1B;</span><br><span class="line"><span class="comment">//&#x521B;&#x5EFA;&#x4E00;&#x4E2A;epoll&#x7684;&#x53E5;&#x67C4;&#xFF0C;size&#x7528;&#x6765;&#x544A;&#x8BC9;&#x5185;&#x6838;&#x8FD9;&#x4E2A;&#x76D1;&#x542C;&#x7684;&#x6570;&#x76EE;&#x4E00;&#x5171;&#x6709;&#x591A;&#x5927;&#xFF0C;&#x8C03;&#x7528;&#x8FD9;&#x4E2A;&#x65B9;&#x6CD5;&#x5C31;&#x4F1A;&#x4EA7;&#x751F;&#x4E00;&#x4E2A;&#x5982;&#x4E0B;&#x7684;&#x7ED3;&#x6784;&#x4F53;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eventpoll</span>{</span></span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">/*&#x7EA2;&#x9ED1;&#x6811;&#x7684;&#x6839;&#x8282;&#x70B9;&#xFF0C;&#x8FD9;&#x9897;&#x6811;&#x4E2D;&#x5B58;&#x50A8;&#x7740;&#x6240;&#x6709;&#x6DFB;&#x52A0;&#x5230;epoll&#x4E2D;&#x7684;&#x9700;&#x8981;&#x76D1;&#x63A7;&#x7684;&#x4E8B;&#x4EF6;*/</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">rb_root</span>  <span class="title">rbr</span>;</span></span><br><span class="line">    <span class="comment">/*&#x53CC;&#x94FE;&#x8868;&#x4E2D;&#x5219;&#x5B58;&#x653E;&#x7740;&#x5C06;&#x8981;&#x901A;&#x8FC7;epoll_wait&#x8FD4;&#x56DE;&#x7ED9;&#x7528;&#x6237;&#x7684;&#x6EE1;&#x8DB3;&#x6761;&#x4EF6;&#x7684;&#x4E8B;&#x4EF6;*/</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">list_head</span> <span class="title">rdlist</span>;</span></span><br><span class="line">    ....</span><br><span class="line">};</span><br><span class="line"><span class="comment">//&#x6211;&#x89C9;&#x5F97;rbr&#x662F;&#x5728;&#x7528;&#x6237;&#x6CE8;&#x518C;&#x5B8C;&#x9700;&#x8981;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x540E;&#xFF0C;&#x7CFB;&#x7EDF;&#x5728;&#x63A5;&#x53D7;&#x5230;&#x4E00;&#x4E2A;&#x8BF7;&#x6C42;&#x540E;&#x5C31;&#x4F1A;&#x628A;&#x6B64;&#x4E8B;&#x4EF6;&#x4E0E;&#x8FD9;&#x4E2A;&#x7EA2;&#x9ED1;&#x6811;rbr&#x4E2D;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;&#x8FDB;&#x884C;&#x6BD4;&#x8F83;&#xFF0C;&#x5982;&#x679C;&#x6709;&#x7684;&#x8BDD;&#x5C31;&#x4F1A;&#x52A0;&#x5165;&#x5230;rdlist&#xFF0C;&#x6240;&#x4EE5;&#x5728;&#x7528;&#x6237;&#x4E0D;&#x7528;&#x904D;&#x5386;&#x6240;&#x6709;&#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x800C;&#x662F;&#x53EA;&#x7528;&#x904D;&#x5386;rdlist&#x5C31;&#x53EF;&#x4EE5;&#x5F97;&#x5230;&#x6240;&#x6709;&#x53EF;&#x4EE5;&#x8BFB;&#x53D6;&#x7684;&#x6D41;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_ctl</span><span class="params">(<span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, struct epoll_event *event)</span></span></span><br><span class="line"><span class="function"><span class="comment">//&#x521B;&#x5EFA;&#x9700;&#x8981;&#x76D1;&#x542C;&#x7684;&#x4E8B;&#x4EF6;</span></span></span><br><span class="line">epfd epoll&#x7684;&#x53E5;&#x67C4;id</span><br><span class="line">op &#x64CD;&#x4F5C;&#x5373;&#x662F;&#x8981;&#x5BF9;fd&#x5373;&#x7AEF;&#x53E3;&#x5220;&#x9664;&#x3001;&#x589E;&#x52A0;&#x8FD8;&#x662F;&#x4FEE;&#x6539;event&#xFF0C;&#x6240;&#x6709;op&#x5BF9;&#x5E94; &#x6DFB;&#x52A0;EPOLL_CTL_ADD&#xFF0C;&#x5220;&#x9664;EPOLL_CTL_DEL&#xFF0C;&#x4FEE;&#x6539;EPOLL_CTL_MOD</span><br><span class="line">fd &#x76D1;&#x542C;&#x7684;&#x7AEF;&#x53E3;&#x5BF9;&#x5E94;&#x7684;&#x53E5;&#x67C4;</span><br><span class="line">event &#x8FDB;&#x884C;op&#x64CD;&#x4F5C;&#x7684;&#x6240;&#x6709;&#x4E8B;&#x4EF6;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">epoll_wait</span><span class="params">(<span class="keyword">int</span> epfd, struct epoll_event * events, <span class="keyword">int</span> maxevents, <span class="keyword">int</span> timeout)</span></span>;</span><br><span class="line"><span class="comment">//&#x4ECE;&#x5185;&#x6838;&#x5F97;&#x5230;&#x4E8B;&#x4EF6;&#x96C6;&#x5408;&#xFF0C;&#x8FD4;&#x56DE;&#x9700;&#x8981;&#x5904;&#x7406;&#x7684;&#x4E8B;&#x4EF6;&#x6570;&#x76EE;</span></span><br></pre></td></tr></tbody></table></figure>
<p>&#x4EE5;&#x4E0A;&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5F97;&#x51FA;epoll&#x76F8;&#x5BF9;&#x4E8E;select&#x548C;poll&#x7684;&#x4F18;&#x70B9;&#xFF1A;</p>
<ol>
<li>&#x6CA1;&#x6709;&#x6CE8;&#x518C;&#x63CF;&#x8FF0;&#x7B26;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4E5F;&#x5C31;&#x662F;&#x6CA1;&#x6709;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x7684;&#x9650;&#x5236;&#xFF0C;&#x4E5F;&#x4E0D;&#x4F1A;&#x56E0;&#x4E3A;&#x76D1;&#x542C;&#x7AEF;&#x53E3;&#x7684;&#x589E;&#x52A0;&#x800C;&#x6027;&#x80FD;&#x964D;&#x4F4E;</li>
<li>&#x4E0D;&#x7528;&#x53BB;&#x904D;&#x5386;&#x6240;&#x6709;&#x6D41;&#x5F97;&#x5230;&#x80FD;&#x8BFB;&#x6216;&#x8005;&#x5199;&#x7684;&#x6D41;&#xFF0C;epoll&#x5DF2;&#x7ECF;&#x628A;&#x54EA;&#x4E2A;&#x6D41;&#x4EA7;&#x751F;&#x4E86;&#x600E;&#x6837;&#x7684;IO&#x4E8B;&#x4EF6;&#x901A;&#x77E5;&#x4E86;&#x6211;&#x4EEC;&#xFF0C;&#x6211;&#x4EEC;&#x76F4;&#x63A5;&#x53D6;&#x51FA;&#x6765;&#x5373;&#x53EF;</li>
</ol>
<h4 id="AIO"><a href="#AIO" class="headerlink" title="AIO"></a>AIO</h4><p>&#x5728;&#x6211;&#x770B;&#x6765;&#x4E00;&#x4E0B;&#x7684;&#x4E24;&#x79CD;&#x65B9;&#x5F0F;&#x5176;&#x5B9E;&#x90FD;&#x662F;&#x901A;&#x8FC7;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#x6765;&#x8FDB;&#x884C;&#x5F02;&#x6B65;&#x7684;&#xFF1A;&#x5148;&#x662F;&#x901A;&#x8FC7;&#x591A;&#x8DEF;&#x590D;&#x7528;&#x4E5F;&#x5C31;&#x662F;Nio&#x6765;&#x5B9E;&#x73B0;&#x975E;&#x963B;&#x585E;&#xFF0C;&#x7136;&#x540E;&#x518D;&#x901A;&#x8FC7;&#x521B;&#x5EFA;&#x7EBF;&#x7A0B;&#x505A;&#x5176;&#x5B83;&#x4E8B;&#x60C5;&#x7684;&#x65B9;&#x5F0F;&#x907F;&#x514D;&#x7B49;&#x5F85;&#x4ECE;&#x5185;&#x6838;&#x7F13;&#x51B2;&#x533A;&#x5411;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x590D;&#x5236;&#x6570;&#x636E;</p>
<p>&#x6240;&#x4EE5;&#x5B83;&#x4EEC;&#x6709;&#x4E00;&#x4E2A;&#x5171;&#x540C;&#x70B9;&#x5C31;&#x662F;&#x8981;&#x5148;&#x5728;&#x7528;&#x6237;&#x7A7A;&#x95F4;&#x521B;&#x5EFA;buffer</p>
<p><strong>Future&#x65B9;&#x5F0F;</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   </span><br><span class="line">    Path path =                                               Paths.get(<span class="string">&quot;/data/code/github/java_practice/src/main/resources/1log4j.properties&quot;</span>);</span><br><span class="line">    AsynchronousFileChannel channel = AsynchronousFileChannel.open(path);</span><br><span class="line">    ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    Future future = channel.read(buffer,<span class="number">0</span>);</span><br><span class="line"><span class="comment">//        while (!future.isDone()){</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;I&apos;m idle&quot;);</span></span><br><span class="line"><span class="comment">//        }</span></span><br><span class="line"><span class="comment">//&#x6211;&#x4EEC;&#x53EF;&#x4EE5;&#x5728;&#x8FD9;&#x91CC;&#x505A;&#x5176;&#x5B83;&#x4E8B;&#x60C5;</span></span><br><span class="line">    Integer readNumber = future.get();</span><br><span class="line"></span><br><span class="line">    buffer.flip();</span><br><span class="line">    CharBuffer charBuffer = CharBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">    CharsetDecoder decoder = Charset.defaultCharset().newDecoder();</span><br><span class="line">    decoder.decode(buffer,charBuffer,<span class="keyword">false</span>);</span><br><span class="line">    charBuffer.flip();</span><br><span class="line">    String data = <span class="keyword">new</span> String(charBuffer.array(),<span class="number">0</span>, charBuffer.limit());</span><br><span class="line">    System.out.println(<span class="string">&quot;read number:&quot;</span> + readNumber);</span><br><span class="line">    System.out.println(data);</span><br></pre></td></tr></tbody></table></figure>
<p>&#x56E0;&#x4E3A;Future&#x7684;&#x672C;&#x8D28;&#x5C31;&#x662F;&#x76F4;&#x63A5;&#x8FD4;&#x56DE;&#x800C;&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x8FD0;&#x7B97;&#x5F97;&#x5230;&#x7ED3;&#x679C;&#xFF0C;&#x8FD0;&#x7B97;&#x7ED3;&#x675F;&#x540E;&#x81EA;&#x5DF1;&#x53BB;&#x53D6;&#x7ED3;&#x679C;</p>
<p><strong>&#x56DE;&#x8C03;&#x65B9;&#x5F0F;</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Path path = Paths.get(<span class="string">&quot;/data/code/github/java_practice/src/main/resources/1log4j.properties&quot;</span>);</span><br><span class="line">AsynchronousFileChannel channel = AsynchronousFileChannel.open(path);</span><br><span class="line">ByteBuffer buffer = ByteBuffer.allocate(<span class="number">1024</span>);</span><br><span class="line">channel.read(buffer, <span class="number">0</span>, buffer, <span class="keyword">new</span> CompletionHandler() {</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">completed</span><span class="params">(Integer result, ByteBuffer attachment)</span> </span>{</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; read success!&quot;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">failed</span><span class="params">(Throwable exc, ByteBuffer attachment)</span> </span>{</span><br><span class="line">        System.out.println(<span class="string">&quot;read error&quot;</span>);</span><br><span class="line">    }</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>){</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; sleep&quot;</span>);</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>&#x521B;&#x5EFA;&#x65B0;&#x7684;&#x7EBF;&#x7A0B;&#x4ECE;&#x5185;&#x6838;&#x53D6;&#x6570;&#x636E;&#xFF0C;&#x6240;&#x4EE5;completed&#x65B9;&#x6CD5;&#x4E5F;&#x662F;&#x5728;&#x65B0;&#x7EBF;&#x7A0B;&#x4E0A;&#x5B8C;&#x6210;&#x7684;</p>
<h5 id="&#x53C2;&#x8003;"><a href="#&#x53C2;&#x8003;" class="headerlink" title="&#x53C2;&#x8003;"></a>&#x53C2;&#x8003;</h5><p>Linux io&#x6A21;&#x5F0F;&#x3001;select&#x3001;poll&#x3001;epoll</p>
<p><a href="https://segmentfault.com/a/1190000003063859" target="_blank" rel="noopener">https://segmentfault.com/a/1190000003063859</a></p>
<p><a href="https://blog.csdn.net/tianjing0805/article/details/76021440" target="_blank" rel="noopener">https://blog.csdn.net/tianjing0805/article/details/76021440</a></p>
<p>Aio</p>
<p><a href="https://juejin.im/entry/583ec2e3128fe1006bfa6c83" target="_blank" rel="noopener">https://juejin.im/entry/583ec2e3128fe1006bfa6c83</a></p>
<p>NIO</p>
<p><a href="http://tutorials.jenkov.com/java-nio/buffers.html" target="_blank" rel="noopener">http://tutorials.jenkov.com/java-nio/buffers.html</a></p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/java/" rel="tag"># java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/03/13/java/源码解析/ArrayList源码解析/" rel="next" title="ArrayList源码解析">
                <i class="fa fa-chevron-left"></i> ArrayList源码解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/05/12/java/java序列化/" rel="prev" title="java序列化">
                java序列化 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="May">
            
              <p class="site-author-name" itemprop="name">May</p>
              <p class="site-description motion-element" itemprop="description">既然选择了远方，便只顾风雨兼程。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#IO模式"><span class="nav-number">1.</span> <span class="nav-text">IO模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#同步IO"><span class="nav-number">1.1.</span> <span class="nav-text">同步IO</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#阻塞和非阻塞"><span class="nav-number">1.2.</span> <span class="nav-text">阻塞和非阻塞</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#多路复用"><span class="nav-number">1.3.</span> <span class="nav-text">多路复用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Unix五种IO模型"><span class="nav-number">1.4.</span> <span class="nav-text">Unix五种IO模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Reactor和Proactor模式"><span class="nav-number">1.5.</span> <span class="nav-text">Reactor和Proactor模式</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NIO"><span class="nav-number">2.</span> <span class="nav-text">NIO</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#NIO与传统IO的区别"><span class="nav-number">2.1.</span> <span class="nav-text">NIO与传统IO的区别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#java-nio基本概念"><span class="nav-number">2.2.</span> <span class="nav-text">java nio基本概念</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#java-nio的实现"><span class="nav-number">2.3.</span> <span class="nav-text">java nio的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#selector"><span class="nav-number">2.3.1.</span> <span class="nav-text">selector</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#channel"><span class="nav-number">2.3.2.</span> <span class="nav-text">channel</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Buffer"><span class="nav-number">2.3.3.</span> <span class="nav-text">Buffer</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#在java-nio中同步非阻塞的实现方式"><span class="nav-number">2.4.</span> <span class="nav-text">在java nio中同步非阻塞的实现方式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#简单的nio服务器代码实现"><span class="nav-number">2.5.</span> <span class="nav-text">简单的nio服务器代码实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#线程池的通道实现代码"><span class="nav-number">2.6.</span> <span class="nav-text">线程池的通道实现代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#select、poll、epoll"><span class="nav-number">2.7.</span> <span class="nav-text">select、poll、epoll</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#AIO"><span class="nav-number">3.</span> <span class="nav-text">AIO</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#参考"><span class="nav-number">3.1.</span> <span class="nav-text">参考</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        	<div class="copyright"> &copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">May</span>

  

  
</div>












        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  










  





  

  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
